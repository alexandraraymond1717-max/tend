<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tend â€” Intentional Living</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-main: #FAF8F5;
      --bg-card: #FFFFFF;
      --bg-elevated: #F0EBE4;
      --text: #2D2A26;
      --text-light: #6B6660;
      --text-muted: #9A9590;
      --border: #E8E2D9;
      --border-dark: #D4CCC0;
      --accent: #7D9B76;
      --accent-light: #E8F0E6;
      
      --winter: #7EB3E0;
      --winter-light: #F5F9FC;
      --spring: #8FD4A0;
      --spring-light: #F5FBF6;
      --summer: #F9D07A;
      --summer-light: #FFFDF7;
      --fall: #E8A090;
      --fall-light: #FDF7F5;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--bg-main);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    h1, h2, h3, h4 { font-family: 'Fraunces', serif; font-weight: 400; }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-dark); border-radius: 3px; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.7; } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    .slide-in { animation: slideIn 0.4s ease-out forwards; }

    input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent) !important; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ============ CONSTANTS ============
    const VLQ_DOMAINS = {
      family: { 
        name: 'Family', 
        description: 'Parents, siblings, children, extended family â€” feeling connected to and supported by your family.',
        icon: 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§',
        color: '#E8A090'
      },
      partner: { 
        name: 'Partner & Romance', 
        description: 'Romantic relationship, intimacy, partnership â€” feeling loved and loving fully.',
        icon: 'ðŸ’•',
        color: '#E88B9C'
      },
      friendships: { 
        name: 'Friendships', 
        description: 'Close friends, social connections â€” feeling known, supported, and part of a community.',
        icon: 'ðŸ‘¯',
        color: '#F9D07A'
      },
      career: { 
        name: 'Work & Career', 
        description: 'Professional growth, meaningful work, financial stability â€” feeling purposeful in your work.',
        icon: 'ðŸ’¼',
        color: '#7EB3E0'
      },
      education: { 
        name: 'Learning & Growth', 
        description: 'Knowledge, skills, intellectual curiosity â€” feeling like you\'re growing and developing.',
        icon: 'ðŸ“š',
        color: '#B8A9C9'
      },
      recreation: { 
        name: 'Recreation & Fun', 
        description: 'Hobbies, play, leisure, relaxation â€” feeling joy and lightness in life.',
        icon: 'ðŸŽ¨',
        color: '#8FD4A0'
      },
      spirituality: { 
        name: 'Spirituality & Meaning', 
        description: 'Purpose, faith, inner life, connection to something larger â€” feeling grounded in meaning.',
        icon: 'âœ¨',
        color: '#C4B5D4'
      },
      community: { 
        name: 'Community & Citizenship', 
        description: 'Giving back, volunteering, social responsibility â€” feeling like you contribute to the world.',
        icon: 'ðŸŒ',
        color: '#8BC4A0'
      },
      health: { 
        name: 'Physical Health', 
        description: 'Body, movement, sleep, nutrition â€” feeling strong, energized, and well.',
        icon: 'ðŸ’ª',
        color: '#6BBF59'
      },
      mentalHealth: { 
        name: 'Mental Health', 
        description: 'Emotional wellbeing, self-care, inner peace â€” feeling balanced and at ease with yourself.',
        icon: 'ðŸ§ ',
        color: '#7EB3E0'
      },
    };

    const VLQ_ORDER = ['family', 'partner', 'friendships', 'career', 'education', 'recreation', 'spirituality', 'community', 'health', 'mentalHealth'];

    const LIFE_AREAS = {
      health: { name: 'Health & Wellness', icon: 'â—', color: '#6BBF59' },
      relationships: { name: 'Relationships', icon: 'â™¡', color: '#E88B9C' },
      career: { name: 'Career & Work', icon: 'â—†', color: '#5B9BD5' },
      finances: { name: 'Finances', icon: 'â—‹', color: '#F4B942' },
      growth: { name: 'Personal Growth', icon: 'âœ¦', color: '#9B8AAE' },
      fun: { name: 'Fun & Adventure', icon: 'âœº', color: '#D66B4B' },
    };

    const VALUE_KEYWORDS = {
      'Freedom': ['freedom', 'free', 'autonomy', 'independent', 'flexible'],
      'Connection': ['connection', 'connected', 'together', 'relationship', 'partner', 'love', 'present', 'presence'],
      'Growth': ['growth', 'grow', 'learn', 'improve', 'better', 'develop'],
      'Peace': ['peace', 'calm', 'peaceful', 'stress', 'less stressed', 'relaxed', 'balance'],
      'Health': ['health', 'healthy', 'fit', 'strong', 'energy', 'wellness'],
      'Adventure': ['adventure', 'travel', 'explore', 'new', 'exciting', 'experience'],
      'Creativity': ['creative', 'creativity', 'create', 'art', 'make', 'build'],
      'Family': ['family', 'kids', 'children', 'parents', 'home'],
      'Joy': ['joy', 'happy', 'happiness', 'fun', 'laugh', 'enjoy'],
      'Security': ['security', 'secure', 'stable', 'stability', 'safe'],
    };

    const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const MONTH_FULL = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    const PHASES = { EXPLORE: 'explore', GROUND: 'ground', REVEAL: 'reveal', PLAN: 'plan' };
    const CENTER_VIEWS = { YEAR: 'year', SEASONS: 'seasons', MONTHLY: 'monthly', WEEKLY: 'weekly', DAILY: 'daily' };

    // ============ MAIN APP ============
    // ============ VLQ ASSESSMENT ============
    function VLQAssessment({ vlqScores, setVlqScores, vlqStep, setVlqStep, onComplete }) {
      
      // Calculate gaps for summary
      const getGaps = () => {
        return VLQ_ORDER.map(key => ({
          key,
          name: VLQ_DOMAINS[key].name,
          icon: VLQ_DOMAINS[key].icon,
          color: VLQ_DOMAINS[key].color,
          importance: vlqScores[key]?.importance || 5,
          consistency: vlqScores[key]?.consistency || 5,
          gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)
        })).sort((a, b) => b.gap - a.gap);
      };

      const vlqStyles = {
        container: {
          minHeight: '100vh',
          backgroundColor: 'var(--bg-main)',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '2rem',
          fontFamily: "'DM Sans', sans-serif",
        },
        card: {
          backgroundColor: 'var(--bg-card)',
          borderRadius: '24px',
          padding: '2.5rem',
          maxWidth: '700px',
          width: '100%',
          boxShadow: '0 4px 24px rgba(0,0,0,0.06)',
          border: '1px solid var(--border)',
        },
        header: {
          textAlign: 'center',
          marginBottom: '2rem',
        },
        stepIndicator: {
          fontSize: '0.75rem',
          color: 'var(--text-muted)',
          textTransform: 'uppercase',
          letterSpacing: '0.1em',
          marginBottom: '0.5rem',
        },
        title: {
          fontSize: '1.5rem',
          fontFamily: "'Fraunces', serif",
          color: 'var(--text)',
          marginBottom: '0.5rem',
        },
        subtitle: {
          fontSize: '0.9rem',
          color: 'var(--text-muted)',
          lineHeight: 1.5,
        },
        valuesGrid: {
          display: 'flex',
          flexDirection: 'column',
          gap: '0.75rem',
          marginBottom: '2rem',
        },
        valueRow: {
          display: 'grid',
          gridTemplateColumns: '140px 1fr 40px',
          alignItems: 'center',
          gap: '1rem',
          padding: '0.75rem 1rem',
          backgroundColor: 'var(--bg-elevated)',
          borderRadius: '12px',
        },
        valueInfo: {
          display: 'flex',
          alignItems: 'center',
          gap: '0.5rem',
        },
        valueIcon: {
          fontSize: '1.1rem',
        },
        valueName: {
          fontSize: '0.85rem',
          color: 'var(--text)',
          fontWeight: 500,
        },
        slider: {
          width: '100%',
          height: '6px',
          borderRadius: '3px',
          appearance: 'none',
          background: 'var(--border)',
          outline: 'none',
          cursor: 'pointer',
        },
        valueScore: {
          fontSize: '1.1rem',
          fontWeight: 600,
          textAlign: 'center',
          fontFamily: "'Fraunces', serif",
        },
        buttons: {
          display: 'flex',
          gap: '1rem',
          justifyContent: 'center',
        },
        backButton: {
          padding: '0.875rem 2rem',
          backgroundColor: 'transparent',
          border: '1px solid var(--border)',
          borderRadius: '12px',
          color: 'var(--text-muted)',
          fontSize: '0.95rem',
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
        },
        nextButton: {
          padding: '0.875rem 2.5rem',
          backgroundColor: 'var(--accent)',
          border: 'none',
          borderRadius: '12px',
          color: 'white',
          fontSize: '0.95rem',
          fontWeight: 500,
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
        },
        hint: {
          textAlign: 'center',
          fontSize: '0.8rem',
          color: 'var(--text-muted)',
          marginBottom: '1.5rem',
          fontStyle: 'italic',
        },
        // Summary styles
        summarySection: {
          marginBottom: '1.5rem',
        },
        summarySectionTitle: {
          fontSize: '0.75rem',
          fontWeight: 600,
          textTransform: 'uppercase',
          letterSpacing: '0.1em',
          color: 'var(--text-muted)',
          marginBottom: '0.75rem',
        },
        summaryItem: {
          display: 'flex',
          alignItems: 'center',
          gap: '0.75rem',
          padding: '0.75rem',
          backgroundColor: 'var(--bg-elevated)',
          borderRadius: '10px',
          marginBottom: '0.5rem',
        },
        summaryItemIcon: {
          fontSize: '1.25rem',
        },
        summaryItemName: {
          flex: 1,
          fontSize: '0.9rem',
          color: 'var(--text)',
        },
        summaryItemScores: {
          display: 'flex',
          alignItems: 'center',
          gap: '0.375rem',
          fontSize: '0.85rem',
        },
        summaryItemGap: {
          fontSize: '0.75rem',
          padding: '0.2rem 0.5rem',
          borderRadius: '8px',
          fontWeight: 500,
        },
        intro: {
          textAlign: 'center',
        },
        introTitle: {
          fontSize: '2rem',
          fontFamily: "'Fraunces', serif",
          color: 'var(--text)',
          marginBottom: '1rem',
        },
        introText: {
          fontSize: '1rem',
          color: 'var(--text-muted)',
          lineHeight: 1.7,
          marginBottom: '2rem',
        },
        startButton: {
          padding: '1rem 3rem',
          backgroundColor: 'var(--accent)',
          border: 'none',
          borderRadius: '12px',
          color: 'white',
          fontSize: '1rem',
          fontWeight: 500,
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
        },
      };

      const handleImportanceChange = (key, value) => {
        setVlqScores(prev => ({
          ...prev,
          [key]: { ...prev[key], importance: value }
        }));
      };

      const handleConsistencyChange = (key, value) => {
        setVlqScores(prev => ({
          ...prev,
          [key]: { ...prev[key], consistency: value }
        }));
      };

      // Intro screen
      if (vlqStep === -1) {
        return (
          <div style={vlqStyles.container}>
            <div style={{...vlqStyles.card, ...vlqStyles.intro, maxWidth: '500px'}}>
              <svg width="80" height="80" viewBox="0 0 80 80" fill="none" style={{marginBottom: '1.5rem', opacity: 0.8}}>
                <path d="M40 70 L40 45" stroke="var(--accent)" strokeWidth="1.5" strokeLinecap="round"/>
                <path d="M40 55 Q30 50 25 40 Q35 45 40 55" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <path d="M40 45 Q50 38 55 28 Q45 35 40 45" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <path d="M40 35 Q32 28 30 18 Q38 25 40 35" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <path d="M40 28 Q48 22 52 12 Q44 20 40 28" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <circle cx="40" cy="70" r="3" fill="none" stroke="var(--accent)" strokeWidth="1.5"/>
              </svg>
              <h1 style={vlqStyles.introTitle}>Welcome to Tend</h1>
              <p style={{...vlqStyles.introText, marginBottom: '1.5rem'}}>
                Tend helps you design a life aligned with your values â€” not just manage tasks, but actually live the way you want to live.
              </p>
              <p style={vlqStyles.introText}>
                To get started, you'll reflect on <strong>10 areas of life</strong>. For each one, you'll rate:
                <br /><br />
                <em>How important is this to you?</em>
                <br />
                <em>How consistently have you been living it?</em>
                <br /><br />
                Think deeply, but don't worry about perfection â€” you can reassess your values anytime.
              </p>
              <button style={vlqStyles.startButton} onClick={() => setVlqStep(0)}>
                Let's Begin
              </button>
            </div>
          </div>
        );
      }

      // Step 0: Importance ratings for all values
      if (vlqStep === 0) {
        return (
          <div style={vlqStyles.container}>
            <div style={vlqStyles.card}>
              <div style={vlqStyles.header}>
                <div style={vlqStyles.stepIndicator}>Step 1 of 2</div>
                <h2 style={vlqStyles.title}>How important is each area to you?</h2>
                <p style={vlqStyles.subtitle}>
                  Rate each value from 1 (not important) to 10 (extremely important).
                </p>
              </div>
              
              <p style={vlqStyles.hint}>
                Not everything can be a 10 â€” what truly matters most?
              </p>

              <div style={vlqStyles.valuesGrid}>
                {VLQ_ORDER.map(key => {
                  const domain = VLQ_DOMAINS[key];
                  const score = vlqScores[key]?.importance || 5;
                  return (
                    <div key={key} style={vlqStyles.valueRow}>
                      <div style={vlqStyles.valueInfo}>
                        <span style={vlqStyles.valueIcon}>{domain.icon}</span>
                        <span style={vlqStyles.valueName}>{domain.name}</span>
                      </div>
                      <input
                        type="range"
                        min="1"
                        max="10"
                        value={score}
                        onChange={(e) => handleImportanceChange(key, parseInt(e.target.value))}
                        style={{...vlqStyles.slider, accentColor: domain.color}}
                      />
                      <span style={{...vlqStyles.valueScore, color: domain.color}}>
                        {score}
                      </span>
                    </div>
                  );
                })}
              </div>

              <div style={vlqStyles.buttons}>
                <button style={vlqStyles.backButton} onClick={() => setVlqStep(-1)}>
                  Back
                </button>
                <button style={vlqStyles.nextButton} onClick={() => setVlqStep(1)}>
                  Next
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Step 1: Consistency ratings for all values
      if (vlqStep === 1) {
        return (
          <div style={vlqStyles.container}>
            <div style={vlqStyles.card}>
              <div style={vlqStyles.header}>
                <div style={vlqStyles.stepIndicator}>Step 2 of 2</div>
                <h2 style={vlqStyles.title}>How consistently have you been living each value?</h2>
                <p style={vlqStyles.subtitle}>
                  Rate from 1 (not at all) to 10 (fully living it).
                </p>
              </div>
              
              <p style={vlqStyles.hint}>
                Be honest with yourself â€” this is about where you are, not where you want to be.
              </p>

              <div style={vlqStyles.valuesGrid}>
                {VLQ_ORDER.map(key => {
                  const domain = VLQ_DOMAINS[key];
                  const score = vlqScores[key]?.consistency || 5;
                  const importance = vlqScores[key]?.importance || 5;
                  return (
                    <div key={key} style={vlqStyles.valueRow}>
                      <div style={vlqStyles.valueInfo}>
                        <span style={vlqStyles.valueIcon}>{domain.icon}</span>
                        <span style={vlqStyles.valueName}>{domain.name}</span>
                        <span style={{fontSize: '0.7rem', color: 'var(--text-muted)', marginLeft: '0.25rem'}}>
                          (imp: {importance})
                        </span>
                      </div>
                      <input
                        type="range"
                        min="1"
                        max="10"
                        value={score}
                        onChange={(e) => handleConsistencyChange(key, parseInt(e.target.value))}
                        style={{...vlqStyles.slider, accentColor: domain.color}}
                      />
                      <span style={{...vlqStyles.valueScore, color: domain.color}}>
                        {score}
                      </span>
                    </div>
                  );
                })}
              </div>

              <div style={vlqStyles.buttons}>
                <button style={vlqStyles.backButton} onClick={() => setVlqStep(0)}>
                  Back
                </button>
                <button style={vlqStyles.nextButton} onClick={() => setVlqStep(2)}>
                  See Results
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Step 2: Summary screen
      if (vlqStep === 2) {
        const gaps = getGaps();
        const growthAreas = gaps.filter(g => g.gap >= 3);
        const strengths = gaps.filter(g => g.importance >= 7 && g.consistency >= 7);
        const lowerPriority = gaps.filter(g => g.importance <= 5);

        return (
          <div style={vlqStyles.container}>
            <div style={vlqStyles.card}>
              <div style={vlqStyles.header}>
                <h2 style={vlqStyles.title}>Your Values Landscape</h2>
                <p style={vlqStyles.subtitle}>
                  Here's what you shared about what matters and where you are.
                </p>
              </div>

              {growthAreas.length > 0 && (
                <div style={vlqStyles.summarySection}>
                  <h3 style={vlqStyles.summarySectionTitle}>ðŸŒ± Growth Areas</h3>
                  <p style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginBottom: '0.75rem', fontStyle: 'italic'}}>
                    High importance, room to grow
                  </p>
                  {growthAreas.map(item => (
                    <div key={item.key} style={vlqStyles.summaryItem}>
                      <span style={vlqStyles.summaryItemIcon}>{item.icon}</span>
                      <span style={vlqStyles.summaryItemName}>{item.name}</span>
                      <div style={vlqStyles.summaryItemScores}>
                        <span style={{color: 'var(--text-muted)'}}>{item.consistency}</span>
                        <span style={{color: 'var(--text-muted)'}}>â†’</span>
                        <span style={{color: item.color, fontWeight: 600}}>{item.importance}</span>
                      </div>
                      <span style={{
                        ...vlqStyles.summaryItemGap,
                        backgroundColor: `${item.color}20`,
                        color: item.color
                      }}>
                        +{item.gap}
                      </span>
                    </div>
                  ))}
                </div>
              )}

              {strengths.length > 0 && (
                <div style={vlqStyles.summarySection}>
                  <h3 style={vlqStyles.summarySectionTitle}>ðŸ’ª Strengths</h3>
                  <p style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginBottom: '0.75rem', fontStyle: 'italic'}}>
                    Important and you're living it
                  </p>
                  {strengths.map(item => (
                    <div key={item.key} style={vlqStyles.summaryItem}>
                      <span style={vlqStyles.summaryItemIcon}>{item.icon}</span>
                      <span style={vlqStyles.summaryItemName}>{item.name}</span>
                      <div style={vlqStyles.summaryItemScores}>
                        <span style={{color: item.color, fontWeight: 600}}>{item.consistency}</span>
                        <span style={{color: 'var(--text-muted)'}}>/</span>
                        <span style={{color: item.color, fontWeight: 600}}>{item.importance}</span>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {lowerPriority.length > 0 && (
                <div style={vlqStyles.summarySection}>
                  <h3 style={vlqStyles.summarySectionTitle}>âšª Lower Priority Right Now</h3>
                  {lowerPriority.slice(0, 3).map(item => (
                    <div key={item.key} style={{...vlqStyles.summaryItem, opacity: 0.7}}>
                      <span style={vlqStyles.summaryItemIcon}>{item.icon}</span>
                      <span style={vlqStyles.summaryItemName}>{item.name}</span>
                      <span style={{fontSize: '0.8rem', color: 'var(--text-muted)'}}>{item.importance}/10</span>
                    </div>
                  ))}
                </div>
              )}

              <div style={vlqStyles.buttons}>
                <button style={vlqStyles.backButton} onClick={() => setVlqStep(1)}>
                  Back
                </button>
                <button style={vlqStyles.nextButton} onClick={onComplete}>
                  Continue to Planning â†’
                </button>
              </div>
            </div>
          </div>
        );
      }

      return null;
    }

    function TendApp() {
      const [phase, setPhase] = useState(PHASES.EXPLORE);
      const [vlqScores, setVlqScores] = useState({
        family: { importance: null, consistency: null },
        partner: { importance: null, consistency: null },
        friendships: { importance: null, consistency: null },
        career: { importance: null, consistency: null },
        education: { importance: null, consistency: null },
        recreation: { importance: null, consistency: null },
        spirituality: { importance: null, consistency: null },
        community: { importance: null, consistency: null },
        health: { importance: null, consistency: null },
        mentalHealth: { importance: null, consistency: null },
      });
      const [vlqCompleted, setVlqCompleted] = useState(false);
      const [vlqStep, setVlqStep] = useState(-1); // -1 for intro, 0-9 for domains, 10 for summary
      const [values, setValues] = useState([]);
      const [lifeAreaRatings, setLifeAreaRatings] = useState({
        health: { satisfaction: null, intention: null },
        relationships: { satisfaction: null, intention: null },
        career: { satisfaction: null, intention: null },
        finances: { satisfaction: null, intention: null },
        growth: { satisfaction: null, intention: null },
        fun: { satisfaction: null, intention: null }
      });
      const [lifeAreasCompleted, setLifeAreasCompleted] = useState(false);
      const [lifeAreasMode, setLifeAreasMode] = useState(false);
      const [currentLifeAreaIndex, setCurrentLifeAreaIndex] = useState(0);
      const [waitingForSatisfaction, setWaitingForSatisfaction] = useState(true);
      const [isLastLifeAreaResponse, setIsLastLifeAreaResponse] = useState(false);
      const lifeAreaOrder = ['health', 'relationships', 'career', 'finances', 'growth', 'fun'];
      const lifeAreaDescriptions = {
        health: 'physical energy, movement, sleep, how your body feels',
        relationships: 'partner, family, friendships, feeling connected',
        career: 'work satisfaction, growth, meaning in what you do',
        finances: 'financial security, freedom, relationship with money',
        growth: 'learning, self-improvement, becoming who you want to be',
        fun: 'play, adventure, hobbies, things that bring you joy'
      };
      const [events, setEvents] = useState([]);
      const [goals, setGoals] = useState([]);
      const [notes, setNotes] = useState('');
      const [seasonIntentions, setSeasonIntentions] = useState({
        winter: '', spring: '', summer: '', fall: ''
      });
      const [yearTheme, setYearTheme] = useState('');
      const [weeklyHabits, setWeeklyHabits] = useState([]);
      const [dailyHabits, setDailyHabits] = useState([]);
      
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [exchangeCount, setExchangeCount] = useState(0);
      const messagesEndRef = useRef(null);

      const [revealed, setRevealed] = useState(false);
      const [activeTab, setActiveTab] = useState('events');
      const [centerView, setCenterView] = useState(CENTER_VIEWS.YEAR);
      const [expandedEvent, setExpandedEvent] = useState(null);
      const [showEventModal, setShowEventModal] = useState(false);
      const [showGoalModal, setShowGoalModal] = useState(false);
      const [showSettingsModal, setShowSettingsModal] = useState(false);
      const [apiKey, setApiKey] = useState(() => localStorage.getItem('tend_api_key') || '');
      const [chatWidth, setChatWidth] = useState(320);
      const [isResizing, setIsResizing] = useState(false);
      const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());

      useEffect(() => {
        // Only set initial message after VLQ is complete
        if (vlqCompleted && messages.length === 0) {
          // Find top growth areas
          const gaps = VLQ_ORDER.map(key => ({
            name: VLQ_DOMAINS[key].name,
            gap: (vlqScores[key]?.importance || 0) - (vlqScores[key]?.consistency || 0)
          })).filter(g => g.gap >= 3).sort((a, b) => b.gap - a.gap);
          
          const growthMention = gaps.length > 0
            ? `I can see <em>${gaps[0].name}</em>${gaps.length > 1 ? ` and <em>${gaps[1].name}</em>` : ''} are areas where you want to grow.`
            : '';

          setMessages([{
            role: 'assistant',
            content: `Thank you for sharing what matters to you. ${growthMention}

Now let's give your year some shape. <strong>If you could choose one word to guide 2026, what would it be?</strong>

Not a resolution or goal â€” a compass. A word that captures how you want to feel, who you want to become, or what you want to prioritize.

Some examples: <em>ease, courage, presence, joy, depth, adventure, roots, flow</em>

What word comes to mind?`
          }]);
        }
      }, [vlqCompleted]);

      // Track view/tab for system prompt context (no auto-messages)

      // Chat resize handlers
      const handleMouseDown = (e) => {
        setIsResizing(true);
        e.preventDefault();
      };

      useEffect(() => {
        const handleMouseMove = (e) => {
          if (!isResizing) return;
          const newWidth = window.innerWidth - e.clientX;
          setChatWidth(Math.min(Math.max(280, newWidth), 600));
        };

        const handleMouseUp = () => {
          setIsResizing(false);
        };

        if (isResizing) {
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);
        }

        return () => {
          document.removeEventListener('mousemove', handleMouseMove);
          document.removeEventListener('mouseup', handleMouseUp);
        };
      }, [isResizing]);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const analyzeText = (text) => {
        const lower = text.toLowerCase();
        const detected = { values: [] };
        Object.entries(VALUE_KEYWORDS).forEach(([value, keywords]) => {
          if (keywords.some(kw => lower.includes(kw)) && !values.includes(value)) {
            detected.values.push(value);
          }
        });
        return detected;
      };

      const processAnalysis = (detected) => {
        if (detected.values.length > 0) {
          setValues(prev => [...new Set([...prev, ...detected.values])].slice(0, 4));
        }
      };

      const parseEvents = (text) => {
        const lower = text.toLowerCase();
        const foundEvents = [];
        MONTH_FULL.forEach((month, idx) => {
          if (lower.includes(month.toLowerCase())) {
            foundEvents.push({ month: idx });
          }
        });
        return foundEvents;
      };

      const generateResponse = (userMessage, currentPhase, exchangeNum) => {
        const detected = analyzeText(userMessage);
        processAnalysis(detected);
        const lower = userMessage.toLowerCase();

        if (currentPhase === PHASES.EXPLORE) {
          if (exchangeNum === 1) {
            // Try to extract a theme word from their response
            const words = userMessage.split(/\s+/).filter(w => w.length > 2 && w.length < 15);
            const potentialTheme = words.find(w => 
              /^[a-zA-Z]+$/.test(w) && 
              !['the', 'and', 'but', 'for', 'that', 'this', 'with', 'would', 'could', 'think', 'want', 'like', 'year', 'maybe', 'something'].includes(w.toLowerCase())
            );
            
            if (potentialTheme && words.length <= 5) {
              // They likely gave a single word or short phrase
              setYearTheme(potentialTheme.toLowerCase());
              return `<em>${potentialTheme.charAt(0).toUpperCase() + potentialTheme.slice(1).toLowerCase()}</em> â€” I love that.

What does ${potentialTheme.toLowerCase()} mean to you? What would it look like if this year actually embodied that word?`;
            }
            
            const hasFeeling = ['feel', 'feeling', 'want to be', 'less', 'more'].some(w => lower.includes(w));
            if (hasFeeling) {
              return `That's about <em>how</em> you want to feel â€” which is often more important than what you achieve.

If you had to distill that into one word, what would it be? And what's getting in the way of that right now?`;
            }
            return `Tell me more. If you could capture that in a single word â€” a theme for the year â€” what might it be?`;
          }
          
          if (exchangeNum === 2) {
            // Check if they gave a theme word this time
            const words = userMessage.split(/\s+/).filter(w => w.length > 2 && w.length < 15);
            const potentialTheme = words.find(w => 
              /^[a-zA-Z]+$/.test(w) && 
              !['the', 'and', 'but', 'for', 'that', 'this', 'with', 'would', 'could', 'think', 'want', 'like', 'year', 'maybe', 'something'].includes(w.toLowerCase())
            );
            
            if (potentialTheme && !yearTheme) {
              setYearTheme(potentialTheme.toLowerCase());
            }
            
            return `I'm starting to see what matters to you.

If nothing changed this year, how would that feel?`;
          }

          if (exchangeNum >= 3) {
            setPhase(PHASES.GROUND);
            return `Before I share what I'm hearing, help me understand what's already planned.

What's committed this year â€” trips, big events, deadlines? Just mention the month and what it is.`;
          }
        }

        if (currentPhase === PHASES.GROUND) {
          const foundEvents = parseEvents(userMessage);
          
          if (foundEvents.length > 0) {
            const newEvents = foundEvents.map((e, i) => ({
              id: Date.now() + i,
              title: `Event in ${MONTHS[e.month]}`,
              month: e.month,
              lifeArea: 'fun',
              details: { flights: '', stays: '', activities: '', notes: '' },
            }));
            setEvents(prev => [...prev, ...newEvents]);
          }

          setTimeout(() => {
            setPhase(PHASES.REVEAL);
            setRevealed(true);
          }, 500);

          const valuesSummary = values.length > 0 
            ? values.slice(0, 3).join(', ')
            : 'intention and presence';

          return `<strong>Here's what I'm hearing:</strong>

Your values center around <em>${valuesSummary}</em>.

${foundEvents.length > 0 
  ? `You have ${foundEvents.length} thing${foundEvents.length > 1 ? 's' : ''} anchoring the year.`
  : `Your calendar is open â€” that's space to be intentional.`}

Your year is taking shape. Switch between Year, Seasons, and Monthly views to explore different perspectives.

What's missing?`;
        }

        if (currentPhase === PHASES.REVEAL || currentPhase === PHASES.PLAN) {
          setPhase(PHASES.PLAN);

          // Sidebar tabs - Events
          if (activeTab === 'events') {
            if (lower.includes('trip') || lower.includes('travel') || lower.includes('vacation') || lower.includes('visit')) {
              return `A trip! Let's plan it.

Tell me:
â€¢ <em>Where</em> are you thinking?
â€¢ <em>When</em> â€” which month?
â€¢ <em>Who's going</em> â€” solo, partner, friends, family?

Once you add it, I can help with activities, stays, and logistics.`;
            }

            if (lower.includes('birthday') || lower.includes('anniversary') || lower.includes('celebration')) {
              return `Celebrations deserve planning too.

What would make this one special? Think about:
â€¢ The <em>experience</em> you want to create
â€¢ Who needs to be involved
â€¢ What you want to remember about it

Add it to your events and we can flesh out the details.`;
            }

            if (lower.includes('deadline') || lower.includes('work') || lower.includes('project') || lower.includes('launch')) {
              return `Work events anchor the year too.

For this deadline or project:
â€¢ What needs to happen <em>before</em> it?
â€¢ Do you need to protect time leading up to it?
â€¢ What would make it feel successful, not just done?`;
            }

            const eventCount = events.length;
            if (eventCount > 0) {
              return `You have ${eventCount} event${eventCount > 1 ? 's' : ''} planned. Want to add another, or dive deeper into one of these?

I can help with:
â€¢ Activity ideas for any trip
â€¢ Logistics and planning
â€¢ Making sure you're not over-scheduling`;
            }

            return `What's on the horizon? Trips, celebrations, deadlines, milestones?

Even tentative plans are worth capturing â€” they help you see the shape of your year.`;
          }

          // Sidebar tabs - Notes
          if (activeTab === 'notes') {
            return `This is your space to think out loud.

You can use it for:
â€¢ Brain dumps when your head is full
â€¢ Ideas you're not ready to act on
â€¢ Reflections on how things are going
â€¢ Anything that doesn't fit elsewhere

What's taking up mental space right now?`;
          }

          // Sidebar tabs - Goals
          if (activeTab === 'goals') {
            if (lower.includes('fitness') || lower.includes('health') || lower.includes('weight') || lower.includes('run') || lower.includes('exercise')) {
              return `Health goals are foundational.

Make them specific and achievable:
â€¢ <em>"Run a 5K"</em> beats "get in shape"
â€¢ <em>"Workout 3x/week for 3 months"</em> beats "exercise more"
â€¢ <em>"Lose 10 pounds by June"</em> beats "lose weight"

What's your real target?`;
            }

            if (lower.includes('read') || lower.includes('book') || lower.includes('learn')) {
              return `Learning goals expand your world.

Some ways to frame them:
â€¢ <em>"Read 12 books"</em> â€” one a month
â€¢ <em>"Finish one online course"</em>
â€¢ <em>"Learn conversational Spanish"</em>

What do you want to know by year's end?`;
            }

            if (lower.includes('save') || lower.includes('money') || lower.includes('financial') || lower.includes('invest')) {
              return `Financial goals create options.

Be specific:
â€¢ <em>"Save $10K for emergency fund"</em>
â€¢ <em>"Max out retirement contribution"</em>
â€¢ <em>"Pay off credit card by August"</em>

What number would make you feel more secure?`;
            }

            const goalCount = goals.length;
            if (goalCount > 0) {
              return `You have ${goalCount} goal${goalCount > 1 ? 's' : ''} set. Want to add another, or talk through how to make progress on one?

Goals work best when they're:
â€¢ Specific enough to know when you've hit them
â€¢ Connected to what actually matters to you`;
            }

            return `What do you want to be true by the end of this year that isn't true now?

Don't overthink it â€” you can always refine. Start with what comes to mind.`;
          }
          
          // Seasons view - help with season intentions
          if (centerView === CENTER_VIEWS.SEASONS) {
            const seasonWords = {
              winter: ['cozy', 'rest', 'reflect', 'hibernate', 'slow', 'quiet', 'warm'],
              spring: ['renew', 'fresh', 'start', 'bloom', 'energy', 'clean', 'grow'],
              summer: ['adventure', 'explore', 'freedom', 'play', 'travel', 'sun', 'joy'],
              fall: ['harvest', 'gather', 'prepare', 'focus', 'transition', 'gratitude', 'settle']
            };
            
            const currentSeasonName = (() => {
              const month = new Date().getMonth();
              if ([11, 0, 1].includes(month)) return 'winter';
              if ([2, 3, 4].includes(month)) return 'spring';
              if ([5, 6, 7].includes(month)) return 'summer';
              return 'fall';
            })();

            if (lower.includes('winter') || lower.includes('cold') || lower.includes('december') || lower.includes('january') || lower.includes('february')) {
              return `Winter is a time for slowing down.

Some intentions to consider:
â€¢ <em>"Rest without guilt"</em>
â€¢ <em>"Protect my mornings"</em>  
â€¢ <em>"Less doing, more being"</em>

What would make your winter feel nourishing rather than just something to get through?`;
            }
            
            if (lower.includes('spring') || lower.includes('march') || lower.includes('april') || lower.includes('may')) {
              return `Spring is about emergence and new energy.

Some intentions to consider:
â€¢ <em>"Start one thing I've been putting off"</em>
â€¢ <em>"Clear what's not serving me"</em>
â€¢ <em>"Say yes to something new"</em>

What wants to bloom in your life this spring?`;
            }

            if (lower.includes('summer') || lower.includes('june') || lower.includes('july') || lower.includes('august')) {
              return `Summer holds space for expansion and joy.

Some intentions to consider:
â€¢ <em>"Prioritize experiences over tasks"</em>
â€¢ <em>"Protect time for spontaneity"</em>
â€¢ <em>"Be present in the long days"</em>

What would a summer well-lived look like for you?`;
            }

            if (lower.includes('fall') || lower.includes('autumn') || lower.includes('september') || lower.includes('october') || lower.includes('november')) {
              return `Fall is a season of gathering and grounding.

Some intentions to consider:
â€¢ <em>"Harvest what I've built"</em>
â€¢ <em>"Simplify before winter"</em>
â€¢ <em>"Celebrate progress, not just goals"</em>

What do you want to carry into the darker months?`;
            }

            return `Think about what each season needs from you â€” and what you need from it.

You're in <em>${currentSeasonName}</em> right now. How's it going? What would help this season feel more aligned with what you want?`;
          }

          // Monthly view - help with specific month planning
          if (centerView === CENTER_VIEWS.MONTHLY) {
            const monthName = MONTH_FULL[selectedMonth];
            
            if (lower.includes('plan') || lower.includes('suggest') || lower.includes('ideas') || lower.includes('what should')) {
              return `For <em>${monthName}</em>, let's think about:

<strong>What's already anchored?</strong>
Work commitments, birthdays, holidays, travel

<strong>What do you want to protect?</strong>
Rest days, date nights, creative time, nothing-days

<strong>What's one thing that would make this month feel successful?</strong>

Tell me what's on your mind for ${monthName}.`;
            }

            const monthEvents = events.filter(e => e.month === selectedMonth);
            if (monthEvents.length > 0) {
              return `You have <em>${monthEvents.length}</em> thing${monthEvents.length > 1 ? 's' : ''} in ${monthName}: ${monthEvents.map(e => e.title).join(', ')}.

Want me to help you think through any of these? I can suggest activities, help with logistics, or just think through what would make it great.`;
            }

            return `${monthName} is open â€” that's possibility.

What would make this month feel intentional rather than just busy? Any trips, goals, or moments you want to create?`;
          }

          // Weekly view - help with weekly habits
          if (centerView === CENTER_VIEWS.WEEKLY) {
            if (lower.includes('exercise') || lower.includes('workout') || lower.includes('gym') || lower.includes('run') || lower.includes('movement')) {
              return `Movement is foundational. Some weekly rhythms to consider:

â€¢ <em>3x strength, 2x cardio</em> â€” classic balance
â€¢ <em>Daily walks + 2x intense sessions</em> â€” gentler approach
â€¢ <em>1 long active adventure</em> â€” hiking, biking, swimming

What feels sustainable for you? The best routine is one you'll actually do.`;
            }

            if (lower.includes('date') || lower.includes('partner') || lower.includes('relationship') || lower.includes('connect')) {
              return `Protecting time for relationships is one of the most important things you can do.

Ideas for weekly connection:
â€¢ <em>Weekly date night</em> â€” same night each week makes it automatic
â€¢ <em>Morning coffee together</em> â€” 15 minutes of presence
â€¢ <em>Phone-free dinner</em> â€” simple but powerful

What would help your relationships thrive?`;
            }

            if (lower.includes('creative') || lower.includes('hobby') || lower.includes('learn') || lower.includes('read')) {
              return `Making space for creativity and growth:

â€¢ <em>2 hours of creative time</em> â€” protect it like a meeting
â€¢ <em>One chapter a day</em> â€” books add up
â€¢ <em>Weekly learning session</em> â€” courses, podcasts, practice

What do you want to make more time for?`;
            }

            return `Think about the activities that, when you do them regularly, make everything else feel better.

What would you put on your <em>ideal week</em>? Start with just one or two â€” you can always add more.`;
          }

          // Daily view - help with daily habits  
          if (centerView === CENTER_VIEWS.DAILY) {
            if (lower.includes('morning') || lower.includes('wake') || lower.includes('routine')) {
              return `Mornings set the tone for everything.

Some daily morning practices:
â€¢ <em>No phone for first 30 minutes</em>
â€¢ <em>10 minutes of movement</em>
â€¢ <em>Write 3 things you're grateful for</em>
â€¢ <em>One intentional deep breath</em>

What would your ideal morning include?`;
            }

            if (lower.includes('water') || lower.includes('hydrat') || lower.includes('drink')) {
              return `Hydration is one of those small things with outsized impact.

Simple targets:
â€¢ <em>8 glasses / 2 liters</em> â€” the classic
â€¢ <em>Glass before each meal</em> â€” easy to remember
â€¢ <em>Water bottle always visible</em> â€” environment design

What would help you drink more water?`;
            }

            if (lower.includes('walk') || lower.includes('step') || lower.includes('move')) {
              return `Daily movement doesn't have to be intense to be transformative.

Ideas:
â€¢ <em>10,000 steps</em> â€” the gold standard
â€¢ <em>Walk after each meal</em> â€” aids digestion too
â€¢ <em>Standing desk + hourly movement breaks</em>

What level of daily movement feels right for you?`;
            }

            if (lower.includes('phone') || lower.includes('screen') || lower.includes('social media')) {
              return `Our relationship with technology shapes our days more than we realize.

Boundaries to consider:
â€¢ <em>No phone in bedroom</em>
â€¢ <em>App limits on social media</em>
â€¢ <em>Phone-free first and last hour</em>
â€¢ <em>Grayscale mode</em>

What boundary would give you the most peace?`;
            }

            return `Daily habits are about becoming the person you want to be, one small action at a time.

Start tiny â€” what's one thing you could do <em>every single day</em> that would compound over a year?`;
          }
          
          // Default planning responses
          if (lower.includes('plan') || lower.includes('suggest') || lower.includes('ideas') || lower.includes('activities') || lower.includes('where to stay')) {
            const eventMention = events.find(e => lower.includes(MONTHS[e.month].toLowerCase()) || lower.includes(e.title.toLowerCase()));
            if (eventMention) {
              return `For your ${MONTHS[eventMention.month]} event:

<strong>Activities:</strong>
â€¢ Explore the local neighborhood on foot
â€¢ Find one "must-do" and leave room for spontaneity
â€¢ Schedule downtime â€” rest is part of the trip

<strong>Stays:</strong>
â€¢ Look for somewhere with a kitchen for flexibility
â€¢ Consider location vs. price

Click on the event in the sidebar to add details.`;
            }
            return `What event would you like to plan? I can suggest activities, places to stay, and things to consider.`;
          }

          const prompts = [
            `What's one thing you've been wanting to plan but haven't?`,
            `Looking at the seasons â€” where do you need to protect space?`,
            `Is there a trip or experience you keep pushing off?`,
          ];
          return prompts[Math.floor(Math.random() * prompts.length)];
        }

        return `Tell me more about that.`;
      };

      // System prompt for Tend AI
      const getTendSystemPrompt = (pendingState = {}) => {
        const { 
          pendingLifeAreaUpdate, 
          pendingNextAreaIndex, 
          pendingWaitingForSatisfaction,
          pendingIsLastResponse 
        } = pendingState;
        
        // Use pending values if provided, otherwise use current state
        const effectiveAreaIndex = pendingNextAreaIndex !== undefined ? pendingNextAreaIndex : currentLifeAreaIndex;
        const effectiveWaitingFor = pendingWaitingForSatisfaction !== undefined ? pendingWaitingForSatisfaction : waitingForSatisfaction;
        const effectiveIsLast = pendingIsLastResponse || isLastLifeAreaResponse;
        
        // Build updated life area ratings including any pending update
        const effectiveRatings = pendingLifeAreaUpdate 
          ? {
              ...lifeAreaRatings,
              [pendingLifeAreaUpdate.area]: {
                ...lifeAreaRatings[pendingLifeAreaUpdate.area],
                [pendingLifeAreaUpdate.field]: pendingLifeAreaUpdate.score
              }
            }
          : lifeAreaRatings;

        const currentSeason = (() => {
          const month = new Date().getMonth();
          if ([11, 0, 1].includes(month)) return 'winter';
          if ([2, 3, 4].includes(month)) return 'spring';
          if ([5, 6, 7].includes(month)) return 'summer';
          return 'fall';
        })();

        const lifeAreasContext = vlqCompleted 
          ? VLQ_ORDER.map(key => {
              const scores = vlqScores[key];
              const gap = (scores?.importance || 0) - (scores?.consistency || 0);
              return `${VLQ_DOMAINS[key].name}: importance ${scores?.importance}/10, consistency ${scores?.consistency}/10${gap >= 3 ? ' (GROWTH AREA)' : ''}`;
            }).join('; ')
          : 'not assessed yet';

        // Check for misalignments between intentions and actual plans
        const getMisalignments = () => {
          if (!lifeAreasCompleted && !effectiveIsLast) return '';
          const ratingsToCheck = effectiveIsLast ? effectiveRatings : lifeAreaRatings;
          const misalignments = [];
          
          // High intention areas with low activity
          Object.entries(ratingsToCheck).forEach(([key, val]) => {
            if (val.intention >= 7) {
              const relatedHabits = weeklyHabits.filter(h => 
                h.text.toLowerCase().includes(key) || 
                (key === 'health' && /exercise|workout|gym|run|walk|yoga/i.test(h.text)) ||
                (key === 'relationships' && /date|partner|friend|family|call/i.test(h.text)) ||
                (key === 'fun' && /hobby|play|adventure|trip/i.test(h.text))
              );
              const relatedEvents = events.filter(e => e.lifeArea === key);
              
              if (relatedHabits.length === 0 && relatedEvents.length === 0) {
                misalignments.push(`${LIFE_AREAS[key].name} has high intention (${val.intention}) but no related habits or events`);
              }
            }
          });
          
          return misalignments.length > 0 
            ? `\n\nPotential misalignments to gently explore: ${misalignments.join('; ')}`
            : '';
        };

        return `You are Tend, a thoughtful AI companion for intentional living and life design. You help people design their year with intention â€” not just manage tasks, but create a life aligned with their values.

Your personality:
- Warm, calm, and grounded â€” like a wise friend
- You ask thoughtful questions rather than give prescriptive advice
- You're concise â€” 2-4 sentences is often enough, occasionally more for important moments
- You use gentle emphasis with italics for key words
- You avoid bullet points in conversation â€” speak naturally

Current context:
- The user is designing their 2026
- Current view: ${centerView}
- Current sidebar tab: ${activeTab}
- Current season: ${currentSeason}
- Their year theme: ${yearTheme || 'not set yet'}
- Their values: ${values.length > 0 ? values.join(', ') : 'not identified yet'}
- Life areas (from VLQ): ${lifeAreasContext}
- Their events: ${events.length > 0 ? events.map(e => `${MONTHS[e.month]}: ${e.title}`).join(', ') : 'none yet'}
- Weekly habits: ${weeklyHabits.length > 0 ? weeklyHabits.map(h => `${h.text} (${h.frequency}x/week)`).join(', ') : 'none yet'}
- Daily habits: ${dailyHabits.length > 0 ? dailyHabits.map(h => h.text).join(', ') : 'none yet'}
- Phase: ${phase} (explore = getting to know them, ground = understanding commitments, reveal = unlocking the app, plan = ongoing planning)
${getMisalignments()}

The user has already completed the VLQ (Valued Living Questionnaire) assessment before this chat. You know their values - use this knowledge to personalize your guidance. Reference their growth areas when relevant.

View-specific guidance:
- Year view: Help them find their theme word and see the big picture
- Seasons view: Help them set intentions for each season's feeling and focus
- Monthly view: Help them plan specific months, events, and time allocation
- Weekly view: Help them establish weekly rhythms (exercise, date nights, creative time)
- Daily view: Help them identify small daily habits that compound

If they're in the EXPLORE phase, focus on understanding what they want from the year and helping them find their theme word.
If they mention specific months or events, acknowledge those.
If they seem stuck, offer a gentle prompt or example.
If you notice a misalignment between their VLQ values (high importance areas) and their actual plans, gently bring it up.

Keep responses focused and conversational. You're not a productivity app â€” you're helping them live with more intention.`;
      };

      // Call Claude API
      const callClaudeAPI = async (userMessage, pendingState = {}) => {
        if (!apiKey) {
          return "I'd love to help you plan, but I need an API key to think deeply. Click the âš™ settings icon to add your Anthropic API key.";
        }

        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': apiKey,
              'anthropic-version': '2023-06-01',
              'anthropic-dangerous-direct-browser-access': 'true'
            },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 500,
              system: getTendSystemPrompt(pendingState),
              messages: [
                ...messages.map(m => ({
                  role: m.role === 'assistant' ? 'assistant' : 'user',
                  content: m.content.replace(/<[^>]*>/g, '') // Strip HTML for API
                })),
                { role: 'user', content: userMessage }
              ]
            })
          });

          if (!response.ok) {
            const error = await response.json();
            console.error('API Error:', error);
            if (response.status === 401) {
              return "That API key doesn't seem to be working. Check your key in settings (âš™).";
            }
            return "Something went wrong connecting to Claude. Try again?";
          }

          const data = await response.json();
          return data.content[0].text;
        } catch (error) {
          console.error('Fetch error:', error);
          return "I couldn't connect to Claude. Check your internet connection and try again.";
        }
      };

      const handleSendMessage = async () => {
        if (!inputValue.trim()) return;
        
        const userMessage = inputValue.trim();
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setInputValue('');
        setIsTyping(true);
        setExchangeCount(prev => prev + 1);

        // Handle life areas mode - parse numbers
        let pendingLifeAreaUpdate = null;
        let pendingNextAreaIndex = currentLifeAreaIndex;
        let pendingWaitingForSatisfaction = waitingForSatisfaction;
        let pendingIsLastResponse = false;
        
        if (lifeAreasMode) {
          const numbers = userMessage.match(/\b([1-9]|10)\b/g);
          if (numbers && numbers.length > 0) {
            const score = parseInt(numbers[0]);
            const currentArea = lifeAreaOrder[currentLifeAreaIndex];
            
            if (waitingForSatisfaction) {
              pendingLifeAreaUpdate = { area: currentArea, field: 'satisfaction', score };
              setLifeAreaRatings(prev => ({
                ...prev,
                [currentArea]: { ...prev[currentArea], satisfaction: score }
              }));
              setWaitingForSatisfaction(false);
              pendingWaitingForSatisfaction = false;
            } else {
              pendingLifeAreaUpdate = { area: currentArea, field: 'intention', score };
              setLifeAreaRatings(prev => ({
                ...prev,
                [currentArea]: { ...prev[currentArea], intention: score }
              }));
              
              // Move to next area
              if (currentLifeAreaIndex < lifeAreaOrder.length - 1) {
                setCurrentLifeAreaIndex(prev => prev + 1);
                setWaitingForSatisfaction(true);
                pendingNextAreaIndex = currentLifeAreaIndex + 1;
                pendingWaitingForSatisfaction = true;
              } else {
                // This is the final area - flag for summary, then complete
                setIsLastLifeAreaResponse(true);
                pendingIsLastResponse = true;
              }
            }
          }
        }

        // Analyze for values/events even with API
        const detected = analyzeText(userMessage);
        processAnalysis(detected);
        
        // Parse events from message
        const foundEvents = parseEvents(userMessage);
        if (foundEvents.length > 0 && phase === PHASES.GROUND) {
          const newEvents = foundEvents.map((e, i) => ({
            id: Date.now() + i,
            title: `Event in ${MONTHS[e.month]}`,
            month: e.month,
            lifeArea: 'fun',
            details: { flights: '', stays: '', activities: '', notes: '' },
          }));
          setEvents(prev => [...prev, ...newEvents]);
        }

        // Check for theme word in early exchanges
        if (phase === PHASES.EXPLORE && exchangeCount < 3) {
          const words = userMessage.split(/\s+/).filter(w => w.length > 2 && w.length < 15);
          const potentialTheme = words.find(w => 
            /^[a-zA-Z]+$/.test(w) && 
            !['the', 'and', 'but', 'for', 'that', 'this', 'with', 'would', 'could', 'think', 'want', 'like', 'year', 'maybe', 'something'].includes(w.toLowerCase())
          );
          if (potentialTheme && words.length <= 5 && !yearTheme) {
            setYearTheme(potentialTheme.toLowerCase());
          }
        }

        // Progress phases based on exchange count
        if (phase === PHASES.EXPLORE && exchangeCount >= 2) {
          setPhase(PHASES.GROUND);
        }
        if (phase === PHASES.GROUND && exchangeCount >= 3 && !revealed) {
          setPhase(PHASES.REVEAL);
          setRevealed(true);
          // Start life areas mode - Claude will handle the transition naturally via system prompt
          if (!lifeAreasCompleted) {
            setLifeAreasMode(true);
          }
        }

        // Get response from Claude API
        const response = await callClaudeAPI(userMessage, {
          pendingLifeAreaUpdate,
          pendingNextAreaIndex,
          pendingWaitingForSatisfaction,
          pendingIsLastResponse
        });
        setMessages(prev => [...prev, { role: 'assistant', content: response }]);
        setIsTyping(false);
        
        // Complete life areas after the summary response
        if (isLastLifeAreaResponse || pendingIsLastResponse) {
          setLifeAreasCompleted(true);
          setLifeAreasMode(false);
          setIsLastLifeAreaResponse(false);
        }
      };

      const handleSkip = () => {
        setPhase(PHASES.PLAN);
        setRevealed(true);
        setMessages(prev => [...prev, {
          role: 'assistant',
          content: `No problem â€” let's dive in.

Use the view switcher to explore your year. Add events, set season intentions, and plan the details.

I'm here to help with any planning.`
        }]);
      };

      const handleAddEvent = (eventData) => {
        setEvents(prev => [...prev, { 
          ...eventData, 
          id: Date.now(),
          details: { flights: '', stays: '', activities: '', notes: '' },
        }]);
        setShowEventModal(false);
      };

      const handleUpdateEventDetails = (eventId, field, value) => {
        setEvents(prev => prev.map(e => 
          e.id === eventId ? { ...e, details: { ...e.details, [field]: value } } : e
        ));
      };

      const handleAddGoal = (goalData) => {
        setGoals(prev => [...prev, { ...goalData, id: Date.now(), completed: false }]);
        setShowGoalModal(false);
      };

      const handleVlqComplete = () => {
        setVlqCompleted(true);
        // Pre-fill values based on high-importance domains
        const highImportance = VLQ_ORDER
          .filter(key => vlqScores[key]?.importance >= 7)
          .map(key => VLQ_DOMAINS[key].name.split(' ')[0]);
        if (highImportance.length > 0) {
          setValues(highImportance.slice(0, 3));
        }
      };

      // Show VLQ assessment first
      if (!vlqCompleted) {
        return (
          <VLQAssessment
            vlqScores={vlqScores}
            setVlqScores={setVlqScores}
            vlqStep={vlqStep}
            setVlqStep={setVlqStep}
            onComplete={handleVlqComplete}
          />
        );
      }

      return (
        <div style={styles.container}>
          <header style={styles.header}>
            <div style={styles.logoContainer}>
              <svg width="28" height="28" viewBox="0 0 32 32" fill="none" style={{ marginRight: '8px' }}>
                <path d="M16 26 Q16 18 16 14" stroke="var(--accent)" strokeWidth="2" strokeLinecap="round" fill="none"/>
                <path d="M16 18 Q10 16 8 10 Q14 12 16 18" fill="var(--accent)" opacity="0.5"/>
                <path d="M16 14 Q22 10 24 4 Q18 8 16 14" fill="var(--accent)"/>
                <path d="M16 10 Q14 6 16 2 Q18 6 16 10" fill="var(--accent)" opacity="0.7"/>
              </svg>
              <h1 style={styles.logoText}>tend</h1>
            </div>
            <p style={styles.tagline}>a space for designing your life with intention</p>
            <button 
              style={styles.settingsButton} 
              onClick={() => setShowSettingsModal(true)}
              title="Settings"
            >
              âš™
            </button>
          </header>

          <main style={{...styles.main, gridTemplateColumns: `240px 1fr ${chatWidth}px`}}>
            <aside style={styles.sidebar}>
              <div style={styles.tabs}>
                {['events', 'notes', 'goals'].map(tab => (
                  <button
                    key={tab}
                    style={{...styles.tab, ...(activeTab === tab && styles.tabActive)}}
                    onClick={() => setActiveTab(tab)}
                  >
                    {tab.charAt(0).toUpperCase() + tab.slice(1)}
                  </button>
                ))}
              </div>

              <div style={styles.tabContent}>
                {activeTab === 'events' && (
                  <EventsTab
                    events={events}
                    expandedEvent={expandedEvent}
                    setExpandedEvent={setExpandedEvent}
                    onUpdateDetails={handleUpdateEventDetails}
                    onDelete={(id) => setEvents(events.filter(e => e.id !== id))}
                    onAdd={() => setShowEventModal(true)}
                    revealed={revealed}
                  />
                )}
                {activeTab === 'notes' && (
                  <NotesTab notes={notes} setNotes={setNotes} revealed={revealed} />
                )}
                {activeTab === 'goals' && (
                  <GoalsTab
                    goals={goals}
                    setGoals={setGoals}
                    onAdd={() => setShowGoalModal(true)}
                    revealed={revealed}
                  />
                )}
              </div>
            </aside>

            <div style={styles.centerPanel}>
              <div style={styles.viewSwitcher}>
                {[
                  { id: CENTER_VIEWS.YEAR, label: 'Year' },
                  { id: CENTER_VIEWS.SEASONS, label: 'Seasons' },
                  { id: CENTER_VIEWS.MONTHLY, label: 'Monthly' },
                  { id: CENTER_VIEWS.WEEKLY, label: 'Weekly' },
                  { id: CENTER_VIEWS.DAILY, label: 'Daily' },
                ].map(view => (
                  <button
                    key={view.id}
                    style={{...styles.viewButton, ...(centerView === view.id && styles.viewButtonActive)}}
                    onClick={() => setCenterView(view.id)}
                  >
                    {view.label}
                  </button>
                ))}
              </div>

              {centerView === CENTER_VIEWS.YEAR && (
                <YearCircleView 
                  events={events}
                  revealed={revealed}
                  onAddEvent={() => setShowEventModal(true)}
                  yearTheme={yearTheme}
                  setYearTheme={setYearTheme}
                />
              )}
              {centerView === CENTER_VIEWS.SEASONS && (
                <SeasonsView 
                  seasonIntentions={seasonIntentions}
                  setSeasonIntentions={setSeasonIntentions}
                  revealed={revealed}
                />
              )}
              {centerView === CENTER_VIEWS.MONTHLY && (
                <MonthlyView 
                  events={events}
                  selectedMonth={selectedMonth}
                  setSelectedMonth={setSelectedMonth}
                  revealed={revealed}
                  onAddEvent={() => setShowEventModal(true)}
                />
              )}
              {centerView === CENTER_VIEWS.WEEKLY && (
                <WeeklyView 
                  weeklyHabits={weeklyHabits}
                  setWeeklyHabits={setWeeklyHabits}
                  revealed={revealed}
                />
              )}
              {centerView === CENTER_VIEWS.DAILY && (
                <DailyView 
                  dailyHabits={dailyHabits}
                  setDailyHabits={setDailyHabits}
                  revealed={revealed}
                />
              )}

              <div style={{...styles.bottomSection, opacity: revealed ? 1 : 0.4}}>
                <div style={styles.valuesSection}>
                  <h3 style={styles.sectionLabel}>Values</h3>
                  <div style={styles.valuesTags}>
                    {values.map(v => (
                      <span key={v} style={styles.valueTag} className="fade-in">
                        {v}
                        {revealed && (
                          <button style={styles.valueRemove} onClick={() => setValues(values.filter(x => x !== v))}>Ã—</button>
                        )}
                      </span>
                    ))}
                    {revealed && values.length < 4 && (
                      <button style={styles.addValueButton} onClick={() => {
                        const v = prompt('Add a value:');
                        if (v && !values.includes(v)) setValues([...values, v]);
                      }}>+ Add</button>
                    )}
                    {values.length === 0 && (
                      <span style={styles.placeholderText}>Values appear as you share...</span>
                    )}
                  </div>
                </div>
                
                <div style={styles.lifeAreasSection}>
                  <h3 style={styles.sectionLabel}>Values (VLQ)</h3>
                  <div style={styles.vlqGrid}>
                    {VLQ_ORDER.slice(0, 5).map(key => {
                      const domain = VLQ_DOMAINS[key];
                      const scores = vlqScores[key];
                      const gap = (scores?.importance || 0) - (scores?.consistency || 0);
                      return (
                        <div key={key} style={styles.vlqItem}>
                          <div style={styles.vlqItemHeader}>
                            <span style={{fontSize: '0.9rem'}}>{domain.icon}</span>
                            <span style={styles.vlqItemName}>{domain.name.split(' ')[0]}</span>
                          </div>
                          <div style={styles.vlqItemScores}>
                            <span style={{color: 'var(--text-muted)', fontSize: '0.75rem'}}>
                              {scores?.consistency || 0}
                            </span>
                            <span style={{color: 'var(--text-muted)', fontSize: '0.6rem'}}>â†’</span>
                            <span style={{color: domain.color, fontSize: '0.75rem', fontWeight: 600}}>
                              {scores?.importance || 0}
                            </span>
                            {gap >= 3 && (
                              <span style={{
                                fontSize: '0.6rem',
                                color: domain.color,
                                backgroundColor: `${domain.color}20`,
                                padding: '0.1rem 0.3rem',
                                borderRadius: '4px',
                                marginLeft: '0.25rem'
                              }}>+{gap}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  <button 
                    style={styles.reassessButton}
                    onClick={() => { setVlqStep(-1); setVlqCompleted(false); }}
                  >
                    Reassess Values
                  </button>
                </div>
              </div>
            </div>

            <div style={styles.chatPanel}>
              <div 
                style={styles.resizeHandle} 
                onMouseDown={handleMouseDown}
                title="Drag to resize"
              />
              <div style={styles.chatMessages}>
                {messages.map((msg, idx) => (
                  <ChatMessage key={idx} message={msg} />
                ))}
                {isTyping && <TypingIndicator />}
                <div ref={messagesEndRef} />
              </div>
              
              <div style={styles.chatInputArea}>
                {!revealed && phase === PHASES.EXPLORE && (
                  <button style={styles.skipButton} onClick={handleSkip}>Skip to planning â†’</button>
                )}
                <div style={styles.inputRow}>
                  <textarea
                    style={styles.chatInput}
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleSendMessage();
                      }
                    }}
                    placeholder="Say whatever comes to mind..."
                    rows={2}
                  />
                  <button 
                    style={{...styles.sendButton, ...(inputValue.trim() ? {} : styles.sendButtonDisabled)}}
                    onClick={handleSendMessage}
                    disabled={!inputValue.trim()}
                  >â†‘</button>
                </div>
              </div>
            </div>
          </main>

          {showEventModal && <EventModal onClose={() => setShowEventModal(false)} onAdd={handleAddEvent} />}
          {showGoalModal && <GoalModal onClose={() => setShowGoalModal(false)} onAdd={handleAddGoal} />}
          {showSettingsModal && (
            <SettingsModal 
              apiKey={apiKey} 
              setApiKey={(key) => {
                setApiKey(key);
                localStorage.setItem('tend_api_key', key);
              }} 
              onClose={() => setShowSettingsModal(false)} 
            />
          )}
        </div>
      );
    }

    // ============ YEAR CIRCLE VIEW ============
    function YearCircleView({ events, revealed, onAddEvent, yearTheme, setYearTheme }) {
      const size = 400;
      const center = size / 2;
      const outerRadius = 175;
      const innerRadius = 75;
      const monthRadius = 145;
      const currentMonth = new Date().getMonth();

      const getMonthPosition = (monthIndex) => {
        const angle = ((monthIndex - 2) / 12) * 2 * Math.PI - Math.PI / 2;
        return { x: center + Math.cos(angle) * monthRadius, y: center + Math.sin(angle) * monthRadius };
      };

      const getEventPosition = (monthIndex, eventIndex = 0) => {
        const angle = ((monthIndex - 2) / 12) * 2 * Math.PI - Math.PI / 2;
        const radius = innerRadius + 18 + (eventIndex * 12);
        return { x: center + Math.cos(angle) * radius, y: center + Math.sin(angle) * radius };
      };

      const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {
        const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
        return { x: centerX + radius * Math.cos(angleInRadians), y: centerY + radius * Math.sin(angleInRadians) };
      };

      const describeArc = (startAngle, endAngle, radius) => {
        const start = polarToCartesian(center, center, radius, endAngle);
        const end = polarToCartesian(center, center, radius, startAngle);
        const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
        return `M ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 0 ${end.x} ${end.y} L ${center} ${center} Z`;
      };

      const seasonArcs = [
        { id: 'winter', start: -60, end: 30, color: '#7EB3E0' },
        { id: 'spring', start: 30, end: 120, color: '#8FD4A0' },
        { id: 'summer', start: 120, end: 210, color: '#F9D07A' },
        { id: 'fall', start: 210, end: 300, color: '#E8A090' },
      ];

      return (
        <div style={styles.circleContainer}>
          <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
            {seasonArcs.map(season => (
              <path key={season.id} d={describeArc(season.start, season.end, outerRadius)} fill={season.color} opacity={0.35} />
            ))}

            <circle cx={center} cy={center} r={innerRadius} fill="var(--bg-card)" stroke="var(--border)" strokeWidth="1" />

            <text x={center} y={center - 12} textAnchor="middle" dominantBaseline="middle" fill="var(--text)"
              style={{ fontFamily: "'Fraunces', serif", fontSize: '1.75rem' }}>
              2026
            </text>

            {/* Theme word or placeholder */}
            <foreignObject x={center - 50} y={center + 4} width="100" height="30">
              <input
                type="text"
                value={yearTheme}
                onChange={(e) => setYearTheme(e.target.value.toLowerCase())}
                placeholder="theme"
                style={{
                  width: '100%',
                  textAlign: 'center',
                  border: 'none',
                  background: 'transparent',
                  fontFamily: "'Fraunces', serif",
                  fontSize: '0.85rem',
                  color: yearTheme ? 'var(--accent)' : 'var(--text-muted)',
                  fontStyle: yearTheme ? 'normal' : 'italic',
                  outline: 'none',
                }}
              />
            </foreignObject>

            {MONTHS.map((month, idx) => {
              const pos = getMonthPosition(idx);
              const isCurrent = idx === currentMonth;
              return (
                <g key={month}>
                  <text x={pos.x} y={pos.y} textAnchor="middle" dominantBaseline="middle"
                    fill={isCurrent ? 'var(--text)' : 'var(--text-light)'}
                    style={{ fontFamily: "'DM Sans', sans-serif", fontSize: '0.7rem', fontWeight: isCurrent ? 600 : 400 }}>
                    {month}
                  </text>
                  {isCurrent && <circle cx={pos.x} cy={pos.y + 10} r="2" fill="var(--accent)" />}
                </g>
              );
            })}

            {events.map((event) => {
              const monthEvents = events.filter(e => e.month === event.month);
              const eventIndex = monthEvents.indexOf(event);
              const pos = getEventPosition(event.month, eventIndex);
              const color = LIFE_AREAS[event.lifeArea]?.color || 'var(--accent)';
              return (
                <g key={event.id} className="fade-in">
                  <circle cx={pos.x} cy={pos.y} r="6" fill={color} />
                  <circle cx={pos.x} cy={pos.y} r="2.5" fill="white" opacity="0.5" />
                </g>
              );
            })}
          </svg>

          {revealed && <button style={styles.circleAddButton} onClick={onAddEvent}>+ Add Event</button>}
        </div>
      );
    }

    // ============ SEASONS VIEW ============
    function SeasonsView({ seasonIntentions, setSeasonIntentions, revealed }) {
      const seasons = [
        { id: 'winter', name: 'Winter', months: 'Dec â€“ Feb', color: '#7EB3E0', lightColor: '#F5F9FC', elements: ['â„', 'Â·', 'â„', 'Â·', 'â„'] },
        { id: 'spring', name: 'Spring', months: 'Mar â€“ May', color: '#8FD4A0', lightColor: '#F5FBF6', elements: ['âœ¿', 'Â·', 'â€', 'Â·', 'âœ¿'] },
        { id: 'summer', name: 'Summer', months: 'Jun â€“ Aug', color: '#F9D07A', lightColor: '#FFFDF7', elements: ['â˜€', '~', 'â˜€', '~', 'â˜€'] },
        { id: 'fall', name: 'Fall', months: 'Sep â€“ Nov', color: '#E8A090', lightColor: '#FDF7F5', elements: ['ðŸ‚', 'Â·', 'ðŸ', 'Â·', 'ðŸ‚'] },
      ];

      const currentSeason = (() => {
        const month = new Date().getMonth();
        if ([11, 0, 1].includes(month)) return 'winter';
        if ([2, 3, 4].includes(month)) return 'spring';
        if ([5, 6, 7].includes(month)) return 'summer';
        return 'fall';
      })();

      return (
        <div style={styles.seasonsContainer}>
          <div style={styles.seasonsGrid}>
            {seasons.map(season => (
              <div 
                key={season.id} 
                style={{
                  ...styles.seasonCard,
                  backgroundColor: season.lightColor,
                  borderColor: season.id === currentSeason ? season.color : 'transparent',
                  borderWidth: '2px',
                }}
              >
                {/* Decorative top */}
                <div style={{...styles.seasonDecorative, color: season.color}}>
                  {season.elements.map((el, i) => (
                    <span key={i} style={{opacity: i % 2 === 0 ? 1 : 0.5}}>{el}</span>
                  ))}
                </div>

                <div style={styles.seasonCardContent}>
                  <div style={styles.seasonCardHeader}>
                    <h3 style={{...styles.seasonName, color: season.color}}>{season.name}</h3>
                    <span style={styles.seasonMonths}>{season.months}</span>
                    {season.id === currentSeason && (
                      <span style={{...styles.currentBadge, backgroundColor: `${season.color}90`}}>Now</span>
                    )}
                  </div>
                  
                  <div style={styles.seasonIntentionBox}>
                    <label style={{...styles.seasonLabel, color: season.color}}>How do you want this season to feel?</label>
                    <textarea
                      style={{
                        ...styles.seasonTextarea,
                        borderColor: revealed ? season.color : 'var(--border)',
                        opacity: revealed ? 1 : 0.6,
                      }}
                      value={seasonIntentions[season.id] || ''}
                      onChange={(e) => setSeasonIntentions({...seasonIntentions, [season.id]: e.target.value})}
                      placeholder={revealed ? 'Set your intention...' : 'Complete conversation to unlock'}
                      disabled={!revealed}
                      rows={2}
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ============ MONTHLY VIEW ============
    function MonthlyView({ events, selectedMonth, setSelectedMonth, revealed, onAddEvent }) {
      const year = 2026;
      const daysInMonth = new Date(year, selectedMonth + 1, 0).getDate();
      const firstDayOfMonth = new Date(year, selectedMonth, 1).getDay();
      const monthEvents = events.filter(e => e.month === selectedMonth);
      const currentMonth = new Date().getMonth();
      const today = new Date().getDate();

      const getSeasonColor = (monthIdx) => {
        if ([11, 0, 1].includes(monthIdx)) return '#7EB3E0';
        if ([2, 3, 4].includes(monthIdx)) return '#8FD4A0';
        if ([5, 6, 7].includes(monthIdx)) return '#F9D07A';
        return '#E8A090';
      };

      const seasonColor = getSeasonColor(selectedMonth);

      return (
        <div style={styles.monthlyContainer}>
          {/* Month selector strip */}
          <div style={styles.monthStrip}>
            {MONTHS.map((month, idx) => (
              <button
                key={idx}
                style={{
                  ...styles.monthStripButton,
                  backgroundColor: selectedMonth === idx ? `${getSeasonColor(idx)}40` : 'transparent',
                  color: selectedMonth === idx ? getSeasonColor(idx) : 'var(--text-muted)',
                  fontWeight: selectedMonth === idx ? 600 : 400,
                }}
                onClick={() => setSelectedMonth(idx)}
              >
                {month}
              </button>
            ))}
          </div>

          {/* Calendar */}
          <div style={{...styles.calendarWrapper, borderColor: seasonColor}}>
            <div style={{...styles.calendarHeader, backgroundColor: `${seasonColor}90`}}>
              <button style={styles.calendarNav} onClick={() => setSelectedMonth(selectedMonth === 0 ? 11 : selectedMonth - 1)}>â€¹</button>
              <h2 style={styles.calendarTitle}>{MONTH_FULL[selectedMonth]} 2026</h2>
              <button style={styles.calendarNav} onClick={() => setSelectedMonth(selectedMonth === 11 ? 0 : selectedMonth + 1)}>â€º</button>
            </div>

            <div style={styles.calendarBody}>
              <div style={styles.calendarGrid}>
                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, i) => (
                  <div key={i} style={styles.calendarDayHeader}>{day}</div>
                ))}
                {Array.from({ length: firstDayOfMonth }, (_, i) => (
                  <div key={`empty-${i}`} style={styles.calendarDayEmpty}></div>
                ))}
                {Array.from({ length: daysInMonth }, (_, i) => {
                  const day = i + 1;
                  const isToday = selectedMonth === currentMonth && day === today;
                  return (
                    <div key={day} style={{
                      ...styles.calendarDay, 
                      ...(isToday && {...styles.calendarDayToday, backgroundColor: `${seasonColor}70`})
                    }}>
                      {day}
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Events for this month */}
          <div style={styles.monthEventsSection}>
            {monthEvents.length > 0 ? (
              <div style={styles.monthEventsList}>
                {monthEvents.map(event => (
                  <div key={event.id} style={styles.monthEventItem}>
                    <span style={{...styles.eventDot, backgroundColor: LIFE_AREAS[event.lifeArea]?.color}}></span>
                    <span>{event.title}</span>
                  </div>
                ))}
              </div>
            ) : (
              <p style={styles.noEventsText}>No events in {MONTH_FULL[selectedMonth]}</p>
            )}
            {revealed && <button style={{...styles.addEventSmall, borderColor: seasonColor, color: seasonColor}} onClick={onAddEvent}>+ Add Event</button>}
          </div>
        </div>
      );
    }

    // ============ WEEKLY VIEW ============
    function WeeklyView({ weeklyHabits, setWeeklyHabits, revealed }) {
      const [newHabit, setNewHabit] = useState('');
      const [newFrequency, setNewFrequency] = useState(3);

      const addHabit = () => {
        if (!newHabit.trim()) return;
        setWeeklyHabits([...weeklyHabits, {
          id: Date.now(),
          text: newHabit,
          frequency: newFrequency,
          color: ['#7EB3E0', '#8FD4A0', '#F9D07A', '#E8A090', '#B8A9C9'][weeklyHabits.length % 5]
        }]);
        setNewHabit('');
        setNewFrequency(3);
      };

      const daysOfWeek = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];

      return (
        <div style={styles.weeklyContainer}>
          <div style={styles.weeklyHeader}>
            <h2 style={styles.weeklyTitle}>Weekly Rhythms</h2>
            <p style={styles.weeklySubtitle}>What do you want to do each week?</p>
          </div>

          {weeklyHabits.length > 0 ? (
            <div style={styles.weeklyHabitsList}>
              {weeklyHabits.map(habit => (
                <div key={habit.id} style={styles.weeklyHabitRow}>
                  <div style={styles.weeklyHabitInfo}>
                    <span style={{...styles.weeklyHabitDot, backgroundColor: habit.color}}></span>
                    <span style={styles.weeklyHabitText}>{habit.text}</span>
                    <span style={styles.weeklyHabitFreq}>{habit.frequency}x/week</span>
                    <button 
                      style={styles.weeklyHabitDelete}
                      onClick={() => setWeeklyHabits(weeklyHabits.filter(h => h.id !== habit.id))}
                    >Ã—</button>
                  </div>
                  <div style={styles.weeklyHabitDays}>
                    {daysOfWeek.map((day, i) => (
                      <div 
                        key={i} 
                        style={{
                          ...styles.weeklyDayCircle,
                          backgroundColor: i < habit.frequency ? `${habit.color}30` : 'transparent',
                          borderColor: i < habit.frequency ? habit.color : 'var(--border)',
                        }}
                      >
                        <span style={{ fontSize: '0.65rem', color: i < habit.frequency ? habit.color : 'var(--text-muted)' }}>{day}</span>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div style={styles.weeklyEmpty}>
              <p style={styles.weeklyEmptyText}>No weekly habits yet.</p>
              <p style={{...styles.weeklyEmptyText, fontStyle: 'normal', color: 'var(--text-light)'}}>What rhythm do you want to create?</p>
            </div>
          )}

          {revealed ? (
            <div style={styles.addHabitSection}>
              <input
                type="text"
                value={newHabit}
                onChange={(e) => setNewHabit(e.target.value)}
                placeholder="Exercise, read, date night..."
                style={styles.addHabitInput}
                onKeyDown={(e) => e.key === 'Enter' && addHabit()}
              />
              <select 
                value={newFrequency} 
                onChange={(e) => setNewFrequency(parseInt(e.target.value))}
                style={styles.addHabitSelect}
              >
                {[1,2,3,4,5,6,7].map(n => (
                  <option key={n} value={n}>{n}x/week</option>
                ))}
              </select>
              <button onClick={addHabit} style={styles.addHabitButton}>+ Add</button>
            </div>
          ) : (
            <p style={styles.lockedText}>Complete the conversation to add weekly habits</p>
          )}
        </div>
      );
    }

    // ============ DAILY VIEW ============
    function DailyView({ dailyHabits, setDailyHabits, revealed }) {
      const [newHabit, setNewHabit] = useState('');

      const addHabit = () => {
        if (!newHabit.trim()) return;
        setDailyHabits([...dailyHabits, {
          id: Date.now(),
          text: newHabit,
          color: ['#7EB3E0', '#8FD4A0', '#F9D07A', '#E8A090', '#B8A9C9'][dailyHabits.length % 5]
        }]);
        setNewHabit('');
      };

      return (
        <div style={styles.dailyContainer}>
          <div style={styles.dailyHeader}>
            <h2 style={styles.dailyTitle}>Daily Intentions</h2>
            <p style={styles.dailySubtitle}>Small things that add up to a life well-lived</p>
          </div>

          {dailyHabits.length > 0 ? (
            <div style={styles.dailyList}>
              {dailyHabits.map(habit => (
                <div key={habit.id} style={styles.dailyHabitCard}>
                  <div style={{...styles.dailyHabitAccent, backgroundColor: habit.color}}></div>
                  <div style={styles.dailyHabitContent}>
                    <span style={styles.dailyHabitText}>{habit.text}</span>
                    <span style={styles.dailyHabitLabel}>every day</span>
                  </div>
                  <button 
                    style={styles.dailyHabitDelete}
                    onClick={() => setDailyHabits(dailyHabits.filter(h => h.id !== habit.id))}
                  >Ã—</button>
                </div>
              ))}
            </div>
          ) : (
            <div style={styles.dailyEmpty}>
              <p style={styles.dailyEmptyText}>What small daily practices would change your life?</p>
              <p style={styles.dailyEmptyExamples}>
                <em>10k steps Â· Morning pages Â· 8 glasses of water Â· Gratitude Â· Phone-free meals</em>
              </p>
            </div>
          )}

          {revealed ? (
            <div style={styles.addDailySection}>
              <input
                type="text"
                value={newHabit}
                onChange={(e) => setNewHabit(e.target.value)}
                placeholder="Walk 10k steps, drink water, journal..."
                style={styles.addDailyInput}
                onKeyDown={(e) => e.key === 'Enter' && addHabit()}
              />
              <button onClick={addHabit} style={styles.addDailyButton}>+ Add Daily Habit</button>
            </div>
          ) : (
            <p style={styles.lockedText}>Complete the conversation to add daily habits</p>
          )}
        </div>
      );
    }

    // ============ EVENTS TAB ============
    function EventsTab({ events, expandedEvent, setExpandedEvent, onUpdateDetails, onDelete, onAdd, revealed }) {
      if (!revealed) {
        return <div style={styles.tabPlaceholder}><p style={styles.placeholderText}>Your events will appear here.</p></div>;
      }

      return (
        <div style={styles.eventsTab}>
          <button style={styles.addItemButton} onClick={onAdd}>+ Add Event</button>
          
          {events.length === 0 ? (
            <p style={styles.emptyText}>No events yet.</p>
          ) : (
            <div style={styles.eventsList}>
              {events.map(event => (
                <div key={event.id} style={styles.eventCard}>
                  <div style={styles.eventHeader} onClick={() => setExpandedEvent(expandedEvent === event.id ? null : event.id)}>
                    <div style={styles.eventHeaderLeft}>
                      <span style={{...styles.eventDot, backgroundColor: LIFE_AREAS[event.lifeArea]?.color}}></span>
                      <span style={styles.eventMonth}>{MONTHS[event.month]}</span>
                      <span style={styles.eventTitle}>{event.title}</span>
                    </div>
                    <span style={styles.expandIcon}>{expandedEvent === event.id ? 'âˆ’' : '+'}</span>
                  </div>
                  
                  {expandedEvent === event.id && (
                    <div style={styles.eventDetails} className="slide-in">
                      {['flights', 'stays', 'activities', 'notes'].map(field => (
                        <div key={field} style={styles.detailField}>
                          <label style={styles.detailLabel}>
                            {field === 'flights' ? 'âœˆ' : field === 'stays' ? 'ðŸ ' : field === 'activities' ? 'â­' : 'ðŸ“'} {field.charAt(0).toUpperCase() + field.slice(1)}
                          </label>
                          <textarea
                            style={styles.detailInput}
                            value={event.details?.[field] || ''}
                            onChange={(e) => onUpdateDetails(event.id, field, e.target.value)}
                            placeholder={`Add ${field}...`}
                            rows={2}
                          />
                        </div>
                      ))}
                      <button style={styles.deleteEventButton} onClick={() => onDelete(event.id)}>Delete</button>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
          
          <p style={styles.tipText}>ðŸ’¡ Ask AI to suggest activities</p>
        </div>
      );
    }

    function NotesTab({ notes, setNotes, revealed }) {
      if (!revealed) {
        return <div style={styles.tabPlaceholder}><p style={styles.placeholderText}>A space for your thoughts.</p></div>;
      }
      return (
        <div style={styles.notesTab}>
          <textarea style={styles.notesTextarea} value={notes} onChange={(e) => setNotes(e.target.value)} placeholder="Brain dumps, reflections, ideas..." />
        </div>
      );
    }

    function GoalsTab({ goals, setGoals, onAdd, revealed }) {
      if (!revealed) {
        return <div style={styles.tabPlaceholder}><p style={styles.placeholderText}>Your goals will live here.</p></div>;
      }

      return (
        <div style={styles.goalsTab}>
          <button style={styles.addItemButton} onClick={onAdd}>+ Add Goal</button>
          {goals.length === 0 ? (
            <p style={styles.emptyText}>No goals yet.</p>
          ) : (
            <div style={styles.goalsList}>
              {goals.map(goal => (
                <div key={goal.id} style={{...styles.goalCard, opacity: goal.completed ? 0.6 : 1}}>
                  <button
                    style={{...styles.goalCheck, backgroundColor: goal.completed ? 'var(--accent)' : 'transparent'}}
                    onClick={() => setGoals(goals.map(g => g.id === goal.id ? {...g, completed: !g.completed} : g))}
                  >{goal.completed && 'âœ“'}</button>
                  <span style={{...styles.goalText, textDecoration: goal.completed ? 'line-through' : 'none'}}>{goal.text}</span>
                  <button style={styles.goalDelete} onClick={() => setGoals(goals.filter(g => g.id !== goal.id))}>Ã—</button>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    function ChatMessage({ message }) {
      const isAssistant = message.role === 'assistant';
      return (
        <div style={{...styles.chatMessage, justifyContent: isAssistant ? 'flex-start' : 'flex-end'}} className="fade-in">
          {isAssistant && <div style={styles.chatAvatar}><span style={styles.chatAvatarText}>T</span></div>}
          <div style={{...styles.chatBubble, ...(isAssistant ? styles.chatBubbleAssistant : styles.chatBubbleUser)}}>
            <div dangerouslySetInnerHTML={{ __html: message.content.replace(/\n/g, '<br/>') }} />
          </div>
        </div>
      );
    }

    function TypingIndicator() {
      return (
        <div style={styles.chatMessage} className="fade-in">
          <div style={styles.chatAvatar}><span style={styles.chatAvatarText}>T</span></div>
          <div style={styles.typingBubble}>
            <span style={{...styles.typingDot, animationDelay: '0s'}}>â€¢</span>
            <span style={{...styles.typingDot, animationDelay: '0.15s'}}>â€¢</span>
            <span style={{...styles.typingDot, animationDelay: '0.3s'}}>â€¢</span>
          </div>
        </div>
      );
    }

    function EventModal({ onClose, onAdd }) {
      const [title, setTitle] = useState('');
      const [month, setMonth] = useState(new Date().getMonth());
      const [lifeArea, setLifeArea] = useState('fun');

      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={styles.modal} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Add an event</h3>
              <button style={styles.modalClose} onClick={onClose}>Ã—</button>
            </div>
            <form onSubmit={(e) => { e.preventDefault(); if (title) onAdd({ title, month, lifeArea }); }} style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>What is it?</label>
                <input type="text" style={styles.textInput} value={title} onChange={(e) => setTitle(e.target.value)} placeholder="Trip, birthday, deadline..." autoFocus />
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>When?</label>
                <select style={styles.selectInput} value={month} onChange={(e) => setMonth(parseInt(e.target.value))}>
                  {MONTHS.map((m, i) => <option key={i} value={i}>{m} 2026</option>)}
                </select>
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>Life Area</label>
                <select style={styles.selectInput} value={lifeArea} onChange={(e) => setLifeArea(e.target.value)}>
                  {Object.entries(LIFE_AREAS).map(([key, area]) => (
                    <option key={key} value={key}>{area.icon} {area.name}</option>
                  ))}
                </select>
              </div>
              <button type="submit" style={{...styles.submitButton, ...(!title ? styles.submitButtonDisabled : {})}} disabled={!title}>Add to year</button>
            </form>
          </div>
        </div>
      );
    }

    function GoalModal({ onClose, onAdd }) {
      const [text, setText] = useState('');
      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={styles.modal} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Add a goal</h3>
              <button style={styles.modalClose} onClick={onClose}>Ã—</button>
            </div>
            <form onSubmit={(e) => { e.preventDefault(); if (text) onAdd({ text }); }} style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>What do you want to achieve?</label>
                <input type="text" style={styles.textInput} value={text} onChange={(e) => setText(e.target.value)} placeholder="Run a 5K, read 12 books..." autoFocus />
              </div>
              <button type="submit" style={{...styles.submitButton, ...(!text ? styles.submitButtonDisabled : {})}} disabled={!text}>Add goal</button>
            </form>
          </div>
        </div>
      );
    }

    function SettingsModal({ apiKey, setApiKey, onClose }) {
      const [key, setKey] = useState(apiKey);
      
      const handleSave = () => {
        setApiKey(key);
        onClose();
      };

      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={{...styles.modal, maxWidth: '420px'}} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Settings</h3>
              <button style={styles.modalClose} onClick={onClose}>Ã—</button>
            </div>
            <div style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>Anthropic API Key</label>
                <input 
                  type="password" 
                  style={styles.textInput} 
                  value={key} 
                  onChange={(e) => setKey(e.target.value)} 
                  placeholder="sk-ant-..." 
                  autoFocus 
                />
                <p style={styles.settingsHint}>
                  Your key is stored locally in your browser only. Get one at{' '}
                  <a href="https://console.anthropic.com/api-keys" target="_blank" rel="noopener noreferrer" style={styles.settingsLink}>
                    console.anthropic.com
                  </a>
                </p>
              </div>
              <button onClick={handleSave} style={styles.submitButton}>Save</button>
              {apiKey && (
                <p style={styles.settingsStatus}>âœ“ API key is set</p>
              )}
            </div>
          </div>
        </div>
      );
    }

    const styles = {
      container: { height: '100vh', maxHeight: '100vh', display: 'flex', flexDirection: 'column', backgroundColor: 'var(--bg-main)', overflow: 'hidden' },
      header: { padding: '0.875rem 2rem', borderBottom: '1px solid var(--border)', backgroundColor: 'var(--bg-card)', display: 'flex', alignItems: 'baseline', gap: '1rem' },
      logoContainer: { display: 'flex', alignItems: 'center' },
      logoText: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", fontWeight: 400, color: 'var(--text)' },
      tagline: { fontSize: '0.85rem', color: 'var(--text-muted)', fontStyle: 'italic', flex: 1 },
      settingsButton: { background: 'none', border: 'none', fontSize: '1.25rem', color: 'var(--text-muted)', cursor: 'pointer', padding: '0.25rem', opacity: 0.7, transition: 'opacity 0.2s' },

      main: { display: 'grid', gridTemplateColumns: '240px 1fr 320px', flex: 1, height: 'calc(100vh - 56px)', overflow: 'hidden' },

      sidebar: { backgroundColor: 'var(--bg-card)', borderRight: '1px solid var(--border)', display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden' },
      tabs: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', borderBottom: '1px solid var(--border)' },
      tab: { padding: '0.875rem 0.5rem', backgroundColor: 'transparent', border: 'none', borderBottom: '2px solid transparent', color: 'var(--text-muted)', fontSize: '0.75rem', fontWeight: 500, cursor: 'pointer' },
      tabActive: { color: 'var(--text)', borderBottomColor: 'var(--accent)' },
      tabContent: { flex: 1, overflow: 'auto', padding: '1rem', minHeight: 0 },
      tabPlaceholder: { display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%', padding: '2rem' },
      placeholderText: { color: 'var(--text-muted)', fontSize: '0.85rem', textAlign: 'center', fontStyle: 'italic' },

      eventsTab: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      addItemButton: { padding: '0.625rem 1rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '8px', color: 'white', fontSize: '0.8rem', cursor: 'pointer', alignSelf: 'flex-start' },
      eventsList: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
      eventCard: { backgroundColor: 'var(--bg-elevated)', borderRadius: '10px', overflow: 'hidden' },
      eventHeader: { padding: '0.875rem 1rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', cursor: 'pointer' },
      eventHeaderLeft: { display: 'flex', alignItems: 'center', gap: '0.625rem' },
      eventDot: { width: '8px', height: '8px', borderRadius: '50%', flexShrink: 0 },
      eventMonth: { fontSize: '0.7rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' },
      eventTitle: { fontSize: '0.875rem', color: 'var(--text)' },
      expandIcon: { color: 'var(--text-muted)', fontSize: '1rem' },
      eventDetails: { padding: '0 1rem 1rem', display: 'flex', flexDirection: 'column', gap: '0.75rem', borderTop: '1px solid var(--border)', paddingTop: '0.875rem' },
      detailField: { display: 'flex', flexDirection: 'column', gap: '0.25rem' },
      detailLabel: { fontSize: '0.7rem', color: 'var(--text-muted)' },
      detailInput: { padding: '0.5rem 0.75rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '6px', fontSize: '0.8rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", resize: 'none' },
      deleteEventButton: { padding: '0.5rem', backgroundColor: 'transparent', border: '1px solid var(--border)', borderRadius: '6px', color: 'var(--text-muted)', fontSize: '0.75rem', cursor: 'pointer', marginTop: '0.25rem' },
      emptyText: { color: 'var(--text-muted)', fontSize: '0.85rem', fontStyle: 'italic' },
      tipText: { color: 'var(--text-muted)', fontSize: '0.75rem', marginTop: 'auto', paddingTop: '1rem' },

      notesTab: { height: '100%' },
      notesTextarea: { width: '100%', height: '100%', minHeight: '300px', padding: '1rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '10px', fontSize: '0.875rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", resize: 'none', lineHeight: 1.7 },

      goalsTab: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      goalsList: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
      goalCard: { display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.75rem 1rem', backgroundColor: 'var(--bg-elevated)', borderRadius: '8px' },
      goalCheck: { width: '20px', height: '20px', borderRadius: '50%', border: '2px solid var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', color: 'white', fontSize: '0.7rem', flexShrink: 0 },
      goalText: { flex: 1, fontSize: '0.875rem', color: 'var(--text)' },
      goalDelete: { background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '1rem', opacity: 0.5 },

      centerPanel: { display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '1.5rem 1.25rem', backgroundColor: 'var(--bg-main)', gap: '1.5rem', overflow: 'auto', height: '100%', minHeight: 0 },
      viewSwitcher: { display: 'flex', gap: '2px', backgroundColor: 'var(--bg-card)', padding: '4px', borderRadius: '12px', border: '1px solid var(--border)' },
      viewButton: { padding: '0.5rem 1rem', backgroundColor: 'transparent', border: 'none', borderRadius: '10px', color: 'var(--text-muted)', fontSize: '0.8rem', fontWeight: 500, cursor: 'pointer', transition: 'all 0.2s ease' },
      viewButtonActive: { backgroundColor: 'var(--accent)', color: 'white' },

      circleContainer: { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem' },
      circleAddButton: { padding: '0.5rem 1.25rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '20px', color: 'white', fontSize: '0.8rem', cursor: 'pointer' },

      // Seasons
      seasonsContainer: { width: '100%', maxWidth: '580px' },
      seasonsGrid: { display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem' },
      seasonCard: { borderRadius: '16px', overflow: 'hidden', border: '2px solid transparent' },
      seasonDecorative: { padding: '0.75rem', display: 'flex', justifyContent: 'center', gap: '0.75rem', fontSize: '1rem', opacity: 0.7 },
      seasonCardContent: { padding: '1rem', backgroundColor: 'var(--bg-card)', borderBottomLeftRadius: '14px', borderBottomRightRadius: '14px' },
      seasonCardHeader: { marginBottom: '0.75rem', position: 'relative' },
      seasonName: { fontSize: '1.125rem', fontFamily: "'Fraunces', serif", marginBottom: '0.125rem' },
      seasonMonths: { fontSize: '0.75rem', color: 'var(--text-muted)' },
      currentBadge: { position: 'absolute', top: 0, right: 0, fontSize: '0.6rem', color: 'white', padding: '0.2rem 0.5rem', borderRadius: '8px' },
      seasonIntentionBox: { },
      seasonLabel: { fontSize: '0.7rem', fontWeight: 500, display: 'block', marginBottom: '0.375rem' },
      seasonTextarea: { width: '100%', padding: '0.625rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', fontSize: '0.8rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", resize: 'none', lineHeight: 1.5 },

      // Monthly
      monthlyContainer: { width: '100%', maxWidth: '500px', display: 'flex', flexDirection: 'column', gap: '1rem' },
      monthStrip: { display: 'flex', gap: '2px', backgroundColor: 'var(--bg-card)', padding: '4px', borderRadius: '10px', border: '1px solid var(--border)' },
      monthStripButton: { flex: 1, padding: '0.5rem 0.25rem', border: 'none', borderRadius: '6px', fontSize: '0.65rem', fontWeight: 500, cursor: 'pointer', transition: 'all 0.2s ease' },
      calendarWrapper: { backgroundColor: 'var(--bg-card)', borderRadius: '16px', overflow: 'hidden', border: '1px solid var(--border)' },
      calendarHeader: { padding: '0.875rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', opacity: 0.85 },
      calendarNav: { background: 'none', border: 'none', color: 'white', fontSize: '1.25rem', cursor: 'pointer', padding: '0 0.5rem', opacity: 0.9 },
      calendarTitle: { color: 'white', fontSize: '1rem', fontFamily: "'Fraunces', serif" },
      calendarBody: { padding: '1rem' },
      calendarGrid: { display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px' },
      calendarDayHeader: { padding: '0.5rem', textAlign: 'center', fontSize: '0.65rem', color: 'var(--text-muted)', fontWeight: 500 },
      calendarDayEmpty: { aspectRatio: '1' },
      calendarDay: { aspectRatio: '1', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.8rem', color: 'var(--text-light)', backgroundColor: 'var(--bg-elevated)', borderRadius: '8px' },
      calendarDayToday: { color: 'white', fontWeight: 600 },
      monthEventsSection: { display: 'flex', flexDirection: 'column', gap: '0.5rem', alignItems: 'center' },
      monthEventsList: { width: '100%', display: 'flex', flexDirection: 'column', gap: '0.375rem' },
      monthEventItem: { display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.625rem 0.875rem', backgroundColor: 'var(--bg-card)', borderRadius: '8px', fontSize: '0.85rem', border: '1px solid var(--border)' },
      noEventsText: { color: 'var(--text-muted)', fontSize: '0.85rem', fontStyle: 'italic' },
      addEventSmall: { padding: '0.5rem 1rem', backgroundColor: 'transparent', border: '1px solid', borderRadius: '20px', fontSize: '0.8rem', cursor: 'pointer' },

      // Weekly
      weeklyContainer: { width: '100%', maxWidth: '650px', display: 'flex', flexDirection: 'column', gap: '1.5rem', padding: '1rem' },
      weeklyHeader: { textAlign: 'center', marginBottom: '0.5rem' },
      weeklyTitle: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", color: 'var(--text)', marginBottom: '0.375rem' },
      weeklySubtitle: { fontSize: '0.9rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      weeklyGrid: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      weeklyDaysHeader: { display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', maxWidth: '350px', margin: '0 auto' },
      weeklyDayLabel: { fontSize: '0.7rem', color: 'var(--text-muted)', textAlign: 'center', fontWeight: 500 },
      weeklyHabitsList: { display: 'flex', flexDirection: 'column', gap: '0.75rem' },
      weeklyHabitRow: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: '1.5rem', padding: '1rem 1.25rem', backgroundColor: 'var(--bg-card)', borderRadius: '12px', border: '1px solid var(--border)' },
      weeklyHabitInfo: { display: 'flex', alignItems: 'center', gap: '0.625rem', flex: '1' },
      weeklyHabitDot: { width: '10px', height: '10px', borderRadius: '50%', flexShrink: 0 },
      weeklyHabitText: { fontSize: '0.95rem', color: 'var(--text)', fontWeight: 500 },
      weeklyHabitFreq: { fontSize: '0.75rem', color: 'var(--text-muted)', backgroundColor: 'var(--bg-elevated)', padding: '0.25rem 0.625rem', borderRadius: '12px', marginLeft: '0.5rem' },
      weeklyHabitDelete: { background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '1.125rem', opacity: 0.5, marginLeft: '0.5rem' },
      weeklyHabitDays: { display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', width: '280px', flexShrink: 0 },
      weeklyDayCircle: { width: '32px', height: '32px', borderRadius: '50%', border: '2px solid', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto' },
      weeklyEmpty: { textAlign: 'center', padding: '3rem 2rem', backgroundColor: 'var(--bg-card)', borderRadius: '16px', border: '1px dashed var(--border)' },
      weeklyEmptyText: { fontSize: '1rem', color: 'var(--text-muted)', fontStyle: 'italic', marginBottom: '0.25rem' },
      addHabitSection: { display: 'flex', gap: '0.625rem', alignItems: 'center', justifyContent: 'center', flexWrap: 'wrap' },
      addHabitInput: { flex: '1', minWidth: '200px', maxWidth: '280px', padding: '0.75rem 1rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '10px', fontSize: '0.9rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif" },
      addHabitSelect: { padding: '0.75rem 1rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '10px', fontSize: '0.85rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif" },
      addHabitButton: { padding: '0.75rem 1.5rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '10px', color: 'white', fontSize: '0.85rem', cursor: 'pointer', fontWeight: 500 },
      lockedText: { textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.9rem', fontStyle: 'italic', padding: '1rem' },

      // Daily
      dailyContainer: { width: '100%', maxWidth: '550px', display: 'flex', flexDirection: 'column', gap: '1.5rem', padding: '1rem' },
      dailyHeader: { textAlign: 'center', marginBottom: '0.5rem' },
      dailyTitle: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", color: 'var(--text)', marginBottom: '0.375rem' },
      dailySubtitle: { fontSize: '0.9rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      dailyList: { display: 'flex', flexDirection: 'column', gap: '0.75rem' },
      dailyHabitCard: { display: 'flex', alignItems: 'center', backgroundColor: 'var(--bg-card)', borderRadius: '14px', border: '1px solid var(--border)', overflow: 'hidden' },
      dailyHabitAccent: { width: '5px', height: '100%', minHeight: '70px', flexShrink: 0 },
      dailyHabitContent: { flex: 1, padding: '1rem 1.25rem', display: 'flex', flexDirection: 'column', gap: '0.2rem' },
      dailyHabitText: { fontSize: '1rem', color: 'var(--text)', fontWeight: 500 },
      dailyHabitLabel: { fontSize: '0.75rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      dailyHabitDelete: { background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '1.25rem', padding: '1rem', opacity: 0.5 },
      dailyEmpty: { textAlign: 'center', padding: '3rem 2rem', backgroundColor: 'var(--bg-card)', borderRadius: '16px', border: '1px dashed var(--border)' },
      dailyEmptyText: { fontSize: '1rem', color: 'var(--text-muted)', marginBottom: '0.75rem' },
      dailyEmptyExamples: { fontSize: '0.85rem', color: 'var(--text-muted)' },
      addDailySection: { display: 'flex', flexDirection: 'column', gap: '0.625rem', alignItems: 'center' },
      addDailyInput: { width: '100%', maxWidth: '400px', padding: '0.875rem 1.125rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', fontSize: '0.95rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", textAlign: 'center' },
      addDailyButton: { padding: '0.75rem 1.5rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '12px', color: 'white', fontSize: '0.9rem', cursor: 'pointer', fontWeight: 500 },

      // Bottom section
      bottomSection: { display: 'grid', gridTemplateColumns: '140px 1fr', gap: '1.5rem', width: '100%', maxWidth: '500px', padding: '1rem 1.25rem', backgroundColor: 'var(--bg-card)', borderRadius: '14px', border: '1px solid var(--border)', transition: 'opacity 0.5s ease', marginTop: 'auto' },
      valuesSection: {},
      sectionLabel: { fontSize: '0.65rem', textTransform: 'uppercase', letterSpacing: '0.1em', color: 'var(--text-muted)', marginBottom: '0.5rem', fontFamily: "'DM Sans', sans-serif", fontWeight: 600 },
      valuesTags: { display: 'flex', flexWrap: 'wrap', gap: '0.3rem' },
      valueTag: { display: 'inline-flex', alignItems: 'center', gap: '0.3rem', padding: '0.3rem 0.6rem', backgroundColor: 'var(--accent)', color: 'white', borderRadius: '12px', fontSize: '0.7rem' },
      valueRemove: { background: 'none', border: 'none', color: 'white', opacity: 0.7, cursor: 'pointer', fontSize: '0.8rem', padding: 0, lineHeight: 1 },
      addValueButton: { padding: '0.3rem 0.6rem', backgroundColor: 'transparent', border: '1px dashed var(--border-dark)', borderRadius: '12px', color: 'var(--text-muted)', fontSize: '0.7rem', cursor: 'pointer' },
      lifeAreasSection: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
      vlqGrid: { display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: '0.375rem' },
      vlqItem: { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '0.2rem' },
      vlqItemHeader: { display: 'flex', alignItems: 'center', gap: '0.25rem' },
      vlqItemName: { fontSize: '0.6rem', color: 'var(--text-muted)' },
      vlqItemScores: { display: 'flex', alignItems: 'center', gap: '0.2rem' },
      reassessButton: { 
        marginTop: '0.5rem', 
        padding: '0.4rem 0.75rem', 
        backgroundColor: 'transparent', 
        border: '1px dashed var(--border)', 
        borderRadius: '8px', 
        color: 'var(--text-muted)', 
        fontSize: '0.65rem', 
        cursor: 'pointer',
        alignSelf: 'center'
      },
      lifeAreasGrid: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '0.625rem' },
      lifeAreaItem: { display: 'flex', flexDirection: 'column', gap: '0.25rem', alignItems: 'center' },
      lifeAreaHeader: { display: 'flex', alignItems: 'center', gap: '0.3rem', fontSize: '0.65rem' },
      lifeAreaName: { color: 'var(--text-light)', fontSize: '0.65rem' },
      lifeAreaScores: { display: 'flex', alignItems: 'center', gap: '0.25rem' },
      lifeAreaScore: { fontSize: '0.8rem', color: 'var(--text-muted)' },
      lifeAreaArrow: { fontSize: '0.6rem', color: 'var(--text-muted)' },
      lifeAreasPlaceholder: { padding: '1rem', backgroundColor: 'var(--bg-elevated)', borderRadius: '8px', textAlign: 'center' },
      lifeAreasPlaceholderText: { fontSize: '0.75rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      slider: { width: '100%', height: '3px', cursor: 'pointer' },

      // Chat
      chatPanel: { backgroundColor: 'var(--bg-card)', borderLeft: '1px solid var(--border)', display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden', position: 'relative' },
      resizeHandle: { position: 'absolute', left: 0, top: 0, bottom: 0, width: '6px', cursor: 'ew-resize', backgroundColor: 'transparent', zIndex: 10, transition: 'background-color 0.2s' },
      chatMessages: { flex: 1, padding: '1.25rem', overflowY: 'auto', display: 'flex', flexDirection: 'column', gap: '0.875rem', minHeight: 0 },
      chatInputArea: { padding: '1rem 1.25rem 1.25rem', borderTop: '1px solid var(--border)' },
      skipButton: { width: '100%', padding: '0.5rem', marginBottom: '0.75rem', backgroundColor: 'transparent', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text-muted)', fontSize: '0.8rem', cursor: 'pointer' },
      inputRow: { display: 'flex', gap: '0.625rem', alignItems: 'flex-end' },
      chatInput: { flex: 1, padding: '0.75rem 1rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '12px', color: 'var(--text)', fontSize: '0.875rem', fontFamily: "'DM Sans', sans-serif", resize: 'none' },
      sendButton: { width: '40px', height: '40px', borderRadius: '50%', backgroundColor: 'var(--accent)', border: 'none', color: 'white', fontSize: '1rem', cursor: 'pointer', flexShrink: 0 },
      sendButtonDisabled: { backgroundColor: 'var(--border)', cursor: 'not-allowed' },
      chatMessage: { display: 'flex', gap: '0.625rem', alignItems: 'flex-start' },
      chatAvatar: { width: '28px', height: '28px', borderRadius: '50%', backgroundColor: 'var(--accent-light)', border: '1px solid var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 },
      chatAvatarText: { fontFamily: "'Fraunces', serif", fontSize: '0.75rem', color: 'var(--accent)' },
      chatBubble: { padding: '0.75rem 1rem', borderRadius: '14px', maxWidth: '88%', fontSize: '0.875rem', lineHeight: 1.55 },
      chatBubbleAssistant: { backgroundColor: 'var(--bg-elevated)', borderTopLeftRadius: '4px', color: 'var(--text)' },
      chatBubbleUser: { backgroundColor: 'var(--accent)', borderTopRightRadius: '4px', color: 'white' },
      typingBubble: { padding: '0.75rem 1rem', backgroundColor: 'var(--bg-elevated)', borderRadius: '14px', borderTopLeftRadius: '4px', display: 'flex', gap: '4px' },
      typingDot: { color: 'var(--accent)', fontSize: '1.125rem', lineHeight: 1, animation: 'pulse 1s infinite' },

      modalOverlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0,0,0,0.4)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 },
      modal: { backgroundColor: 'var(--bg-card)', borderRadius: '16px', padding: '1.5rem', width: '90%', maxWidth: '360px', border: '1px solid var(--border)' },
      modalHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.25rem' },
      modalTitle: { fontSize: '1.125rem', fontFamily: "'Fraunces', serif", color: 'var(--text)' },
      modalClose: { width: '28px', height: '28px', borderRadius: '50%', backgroundColor: 'var(--bg-elevated)', border: 'none', color: 'var(--text-muted)', fontSize: '1rem', cursor: 'pointer' },
      modalForm: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      formField: { display: 'flex', flexDirection: 'column', gap: '0.375rem' },
      formLabel: { fontSize: '0.7rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em', fontWeight: 500 },
      textInput: { padding: '0.625rem 0.875rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text)', fontSize: '0.875rem', fontFamily: "'DM Sans', sans-serif" },
      selectInput: { padding: '0.625rem 0.875rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text)', fontSize: '0.875rem', fontFamily: "'DM Sans', sans-serif" },
      submitButton: { padding: '0.75rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '10px', color: 'white', fontSize: '0.875rem', fontWeight: 500, cursor: 'pointer', marginTop: '0.5rem' },
      submitButtonDisabled: { backgroundColor: 'var(--border-dark)', cursor: 'not-allowed' },
      settingsHint: { fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.5rem', lineHeight: 1.5 },
      settingsLink: { color: 'var(--accent)', textDecoration: 'none' },
      settingsStatus: { fontSize: '0.8rem', color: 'var(--accent)', textAlign: 'center', marginTop: '0.5rem' },
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TendApp />);
  </script>
</body>
</html>
