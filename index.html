<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tend — Intentional Living</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-main: #FAF8F5;
      --bg-card: #FFFFFF;
      --bg-elevated: #F0EBE4;
      --text: #2D2A26;
      --text-light: #6B6660;
      --text-muted: #9A9590;
      --border: #E8E2D9;
      --border-dark: #D4CCC0;
      --accent: #7D9B76;
      --accent-light: #E8F0E6;
      --ghost: #E8E2D9;
    }

    [data-theme="dark"] {
      --bg-main: #1a1916;
      --bg-card: #252320;
      --bg-elevated: #2d2a26;
      --text: #F5F0E8;
      --text-light: #B8B2A8;
      --text-muted: #8A857C;
      --border: #3d3a36;
      --border-dark: #4a4640;
      --accent: #A8C4A2;
      --accent-light: #2d332c;
      --ghost: #3d3a36;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--bg-main);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    h1, h2, h3, h4 {
      font-family: 'Fraunces', serif;
      font-weight: 400;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-dark); border-radius: 4px; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.7; }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes revealSection {
      from { opacity: 0.3; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
    .fade-up { animation: fadeUp 0.6s ease-out forwards; }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    .slide-in { animation: slideIn 0.4s ease-out forwards; }
    .reveal { animation: revealSection 0.6s ease-out forwards; }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent) !important;
    }

    /* Ghosted state */
    .ghosted {
      opacity: 0.3;
      pointer-events: none;
    }
    .ghosted-soft {
      opacity: 0.5;
    }
    .emerging {
      opacity: 0.7;
      transition: opacity 0.5s ease;
    }
    .revealed {
      opacity: 1;
      transition: opacity 0.5s ease;
    }
  </style>
</head>
<body data-theme="light">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // ============ CONSTANTS ============
    const LIFE_AREAS = {
      health: { name: 'Health & Wellness', icon: '◐', color: '#7D9B76', keywords: ['health', 'fitness', 'exercise', 'gym', 'sleep', 'energy', 'body', 'weight', 'diet', 'mental health', 'stress', 'anxiety', 'tired', 'exhausted'] },
      relationships: { name: 'Relationships', icon: '♡', color: '#C48B8B', keywords: ['partner', 'relationship', 'marriage', 'spouse', 'husband', 'wife', 'boyfriend', 'girlfriend', 'family', 'friends', 'kids', 'children', 'parents', 'dating', 'connection', 'lonely', 'love'] },
      career: { name: 'Career & Work', icon: '◆', color: '#7A9CAD', keywords: ['work', 'job', 'career', 'promotion', 'boss', 'office', 'business', 'project', 'deadline', 'meeting', 'professional', 'salary', 'coworkers', 'manager', 'burnout'] },
      finances: { name: 'Finances', icon: '○', color: '#C9A66B', keywords: ['money', 'financial', 'savings', 'debt', 'budget', 'invest', 'retirement', 'income', 'expenses', 'afford', 'bills', 'salary', 'wealth'] },
      growth: { name: 'Personal Growth', icon: '✦', color: '#9B8AAE', keywords: ['learn', 'grow', 'growth', 'read', 'book', 'course', 'skill', 'hobby', 'creative', 'creativity', 'develop', 'improve', 'therapy', 'meditation', 'mindful'] },
      fun: { name: 'Fun & Adventure', icon: '✺', color: '#C4836A', keywords: ['fun', 'adventure', 'travel', 'trip', 'vacation', 'explore', 'experience', 'play', 'enjoy', 'hobby', 'entertainment', 'relax', 'weekend'] },
    };

    const VALUE_KEYWORDS = {
      'Freedom': ['freedom', 'free', 'autonomy', 'independent', 'flexible', 'flexibility', 'control', 'choice'],
      'Connection': ['connection', 'connected', 'together', 'relationship', 'partner', 'love', 'intimacy', 'close', 'present', 'presence'],
      'Growth': ['growth', 'grow', 'learn', 'improve', 'better', 'develop', 'progress', 'evolve'],
      'Peace': ['peace', 'calm', 'peaceful', 'stress', 'less stressed', 'relaxed', 'quiet', 'stillness', 'balance', 'balanced'],
      'Health': ['health', 'healthy', 'fit', 'strong', 'energy', 'energized', 'well', 'wellness'],
      'Adventure': ['adventure', 'travel', 'explore', 'new', 'exciting', 'experience', 'spontaneous'],
      'Creativity': ['creative', 'creativity', 'create', 'art', 'make', 'build', 'design', 'write', 'music'],
      'Family': ['family', 'kids', 'children', 'parents', 'mom', 'dad', 'siblings', 'home'],
      'Success': ['success', 'achieve', 'accomplish', 'goal', 'ambitious', 'career', 'promotion'],
      'Joy': ['joy', 'happy', 'happiness', 'fun', 'laugh', 'enjoy', 'pleasure', 'delight'],
      'Authenticity': ['authentic', 'real', 'true', 'honest', 'genuine', 'myself', 'who I am'],
      'Security': ['security', 'secure', 'stable', 'stability', 'safe', 'reliable', 'consistent'],
    };

    const PHASES = {
      EXPLORE: 'explore',
      GROUND: 'ground',
      REVEAL: 'reveal',
      PLAN: 'plan',
    };

    const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    // ============ MAIN APP ============
    function TendApp() {
      // Core state
      const [phase, setPhase] = useState(PHASES.EXPLORE);
      const [values, setValues] = useState([]);
      const [lifeAreaFocus, setLifeAreaFocus] = useState({}); // { health: 'needs-attention', career: 'overloaded' }
      const [events, setEvents] = useState([]);
      const [goals, setGoals] = useState([]);
      const [seasonFocus, setSeasonFocus] = useState({});
      
      // Chat state
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [exchangeCount, setExchangeCount] = useState(0);
      const messagesEndRef = useRef(null);

      // UI state
      const [revealed, setRevealed] = useState(false);
      const [showEventModal, setShowEventModal] = useState(false);
      const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());

      // Initialize
      useEffect(() => {
        setMessages([{
          role: 'assistant',
          content: `Welcome to Tend.

Before we get into calendars and planning, I want to understand what you actually want from this year.

What would make 2026 feel like a success? It could be a concrete achievement, a feeling you want to have, a change in how you're living — whatever comes to mind first.`
        }]);
      }, []);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      // ============ TEXT ANALYSIS ============
      const analyzeText = (text) => {
        const lower = text.toLowerCase();
        const detected = { values: [], lifeAreas: [], events: [] };

        // Detect values
        Object.entries(VALUE_KEYWORDS).forEach(([value, keywords]) => {
          if (keywords.some(kw => lower.includes(kw)) && !values.includes(value)) {
            detected.values.push(value);
          }
        });

        // Detect life area mentions
        Object.entries(LIFE_AREAS).forEach(([key, area]) => {
          if (area.keywords.some(kw => lower.includes(kw))) {
            detected.lifeAreas.push(key);
          }
        });

        // Detect events (simple month detection)
        const monthPatterns = [
          /(?:in|during|around)\s+(january|february|march|april|may|june|july|august|september|october|november|december)/gi,
          /(january|february|march|april|may|june|july|august|september|october|november|december)\s+\d+/gi,
        ];
        
        const monthMap = { january: 0, february: 1, march: 2, april: 3, may: 4, june: 5, 
                          july: 6, august: 7, september: 8, october: 9, november: 10, december: 11 };
        
        monthPatterns.forEach(pattern => {
          const matches = text.matchAll(pattern);
          for (const match of matches) {
            const monthName = match[1]?.toLowerCase();
            if (monthName && monthMap[monthName] !== undefined) {
              detected.events.push({ month: monthMap[monthName], text: match[0] });
            }
          }
        });

        return detected;
      };

      // Update state based on analysis
      const processAnalysis = (detected) => {
        if (detected.values.length > 0) {
          setValues(prev => [...new Set([...prev, ...detected.values])].slice(0, 5));
        }
        
        if (detected.lifeAreas.length > 0) {
          setLifeAreaFocus(prev => {
            const updated = { ...prev };
            detected.lifeAreas.forEach(area => {
              if (!updated[area]) updated[area] = 'mentioned';
            });
            return updated;
          });
        }
      };

      // ============ CONVERSATION LOGIC ============
      const generateResponse = (userMessage, currentPhase, exchangeNum) => {
        const detected = analyzeText(userMessage);
        processAnalysis(detected);
        
        const lower = userMessage.toLowerCase();

        // Phase-specific responses
        if (currentPhase === PHASES.EXPLORE) {
          if (exchangeNum === 1) {
            // First response - dig deeper
            const hasFeeling = ['feel', 'feeling', 'want to be', 'less', 'more'].some(w => lower.includes(w));
            const hasConcrete = ['achieve', 'goal', 'finish', 'complete', 'start', 'launch', 'build'].some(w => lower.includes(w));
            
            if (hasFeeling) {
              return `That's about <em>how</em> you want to feel, not just what you want to do — which is important.

What's getting in the way of that right now? What's creating friction?`;
            } else if (hasConcrete) {
              return `That's concrete — I can work with that.

But beyond achieving that, how do you want to <em>feel</em> this year? What would be different about your day-to-day life?`;
            } else {
              return `Say more about that. What would that actually look like in your life?`;
            }
          }
          
          if (exchangeNum === 2) {
            // Second response - identify the tension
            const detectedAreas = Object.keys(lifeAreaFocus);
            if (detectedAreas.length > 0) {
              const areaName = LIFE_AREAS[detectedAreas[0]].name;
              return `So ${areaName.toLowerCase()} is part of this.

If things stayed exactly as they are now for another year, how would that feel?`;
            }
            return `I'm starting to get a picture. What would you need to let go of to make space for this?`;
          }

          if (exchangeNum >= 3) {
            // Transition to GROUND phase
            setPhase(PHASES.GROUND);
            return `Before I share what I'm hearing, help me understand what's already on your plate this year.

What's committed — trips, work deadlines, big family events, anything that's already locked in?`;
          }
        }

        if (currentPhase === PHASES.GROUND) {
          // Parse events from their response
          const eventMentions = [];
          const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 
                             'july', 'august', 'september', 'october', 'november', 'december'];
          
          monthNames.forEach((month, idx) => {
            if (lower.includes(month)) {
              // Try to extract what the event is
              const regex = new RegExp(`([\\w\\s]+?)(?:in|during|around)?\\s*${month}|${month}[\\s\\w]*?(?:for|:)?\\s*([\\w\\s]+)`, 'i');
              const match = userMessage.match(regex);
              eventMentions.push({ month: idx, raw: match ? match[0] : month });
            }
          });

          if (eventMentions.length > 0) {
            // Add events
            const newEvents = eventMentions.map((e, i) => ({
              id: Date.now() + i,
              title: `Event in ${MONTHS[e.month]}`,
              month: e.month,
              lifeArea: 'fun', // default
              startDate: `2026-${String(e.month + 1).padStart(2, '0')}-15`,
              endDate: `2026-${String(e.month + 1).padStart(2, '0')}-15`,
            }));
            setEvents(prev => [...prev, ...newEvents]);
          }

          // Transition to REVEAL
          setTimeout(() => {
            setPhase(PHASES.REVEAL);
            setRevealed(true);
          }, 500);

          const valuesSummary = values.length > 0 
            ? values.slice(0, 3).join(', ')
            : 'presence, balance, and intention';
          
          const areasSummary = Object.keys(lifeAreaFocus).length > 0
            ? Object.keys(lifeAreaFocus).map(k => LIFE_AREAS[k].name.toLowerCase()).join(' and ')
            : 'how you spend your time and energy';

          return `Got it. Let me reflect back what I'm hearing.

<strong>Here's what I'm hearing:</strong>

Your values this year center around <em>${valuesSummary}</em>.

${Object.keys(lifeAreaFocus).length > 0 
  ? `${LIFE_AREAS[Object.keys(lifeAreaFocus)[0]].name} seems to be where the tension lives — ${Object.keys(lifeAreaFocus).length > 1 ? `and ${LIFE_AREAS[Object.keys(lifeAreaFocus)[1]].name} is connected to what you want more of` : 'it needs attention'}.`
  : `You're looking for a shift in ${areasSummary}.`}

${events.length > 0 
  ? `You've got ${events.length} thing${events.length > 1 ? 's' : ''} already on the calendar.`
  : `Your calendar is relatively open — that's either freedom or something to fill intentionally.`}

Take a look at what's taking shape on the left. Does this feel right?`;
        }

        if (currentPhase === PHASES.REVEAL || currentPhase === PHASES.PLAN) {
          setPhase(PHASES.PLAN);
          
          // Contextual planning responses
          if (lower.includes('yes') || lower.includes('right') || lower.includes('exactly') || lower.includes('that\'s it')) {
            return `Good. Now let's make it real.

Looking at your calendar — what's missing? ${values.length > 0 ? `If ${values[0]} matters, what needs to get scheduled to protect it?` : `What would make the next few months feel intentional rather than reactive?`}`;
          }

          if (lower.includes('no') || lower.includes('not quite') || lower.includes('change')) {
            return `That's okay — this is a starting point. You can edit anything on the left directly.

What feels off? What would you adjust?`;
          }

          // General planning responses
          const planningPrompts = [
            `What's one thing you've been meaning to schedule but haven't?`,
            `Which month feels most open right now? What could you protect that space for?`,
            `Is there something that used to bring you joy that's fallen off the calendar?`,
            `Looking at the balance of your time — what's missing?`,
          ];
          
          return planningPrompts[Math.floor(Math.random() * planningPrompts.length)];
        }

        return `Tell me more about that.`;
      };

      // ============ HANDLERS ============
      const handleSendMessage = () => {
        if (!inputValue.trim()) return;
        
        const userMessage = inputValue.trim();
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setInputValue('');
        setIsTyping(true);
        setExchangeCount(prev => prev + 1);

        setTimeout(() => {
          const response = generateResponse(userMessage, phase, exchangeCount + 1);
          setMessages(prev => [...prev, { role: 'assistant', content: response }]);
          setIsTyping(false);
        }, 1200);
      };

      const handleSkip = () => {
        setPhase(PHASES.PLAN);
        setRevealed(true);
        setMessages(prev => [...prev, {
          role: 'assistant',
          content: `No problem — let's jump into planning.

The canvas on the left is yours to shape. Add your values, rate how different areas of life are going, and start putting things on the calendar.

I'm here if you want to talk through any of it.`
        }]);
      };

      const handleAddEvent = (eventData) => {
        setEvents(prev => [...prev, { ...eventData, id: Date.now() }]);
        setShowEventModal(false);
      };

      // ============ RENDER ============
      return (
        <div style={styles.container}>
          {/* Header */}
          <header style={styles.header}>
            <div style={styles.headerLeft}>
              <div style={styles.logoContainer}>
                <svg width="28" height="28" viewBox="0 0 32 32" fill="none" style={{ marginRight: '8px' }}>
                  <path d="M16 26 Q16 18 16 14" stroke="var(--accent)" strokeWidth="2" strokeLinecap="round" fill="none"/>
                  <path d="M16 18 Q10 16 8 10 Q14 12 16 18" fill="var(--accent)" opacity="0.5"/>
                  <path d="M16 14 Q22 10 24 4 Q18 8 16 14" fill="var(--accent)"/>
                  <path d="M16 10 Q14 6 16 2 Q18 6 16 10" fill="var(--accent)" opacity="0.7"/>
                </svg>
                <h1 style={styles.logoText}>tend</h1>
              </div>
              <p style={styles.tagline}>a space for designing your life with intention</p>
            </div>
          </header>

          {/* Main Content */}
          <main style={styles.main}>
            {/* Left Panel - The Canvas */}
            <div style={styles.canvasPanel}>
              <div style={styles.canvasContent}>
                {/* Year Header */}
                <div style={styles.yearHeader}>
                  <h2 style={styles.yearTitle}>2026</h2>
                  <p style={styles.yearSubtitle}>Your year is taking shape</p>
                </div>

                {/* Values Section */}
                <div style={{...styles.section, ...(revealed ? {} : styles.ghosted)}}>
                  <div style={styles.sectionHeader}>
                    <h3 style={styles.sectionTitle}>Values</h3>
                    {revealed && values.length < 5 && (
                      <button style={styles.sectionAdd} onClick={() => {
                        const newValue = prompt('Add a value:');
                        if (newValue && !values.includes(newValue)) {
                          setValues([...values, newValue]);
                        }
                      }}>+ Add</button>
                    )}
                  </div>
                  <div style={styles.valuesContainer}>
                    {values.length === 0 ? (
                      <div style={styles.ghostedPlaceholder}>
                        <span style={styles.ghostedCircle}></span>
                        <span style={styles.ghostedCircle}></span>
                        <span style={styles.ghostedCircle}></span>
                      </div>
                    ) : (
                      <div style={styles.valuesTags}>
                        {values.map((v, i) => (
                          <span key={v} style={styles.valueTag} className="slide-in">
                            {v}
                            {revealed && (
                              <button 
                                style={styles.valueRemove}
                                onClick={() => setValues(values.filter(x => x !== v))}
                              >×</button>
                            )}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                {/* Life Areas Section */}
                <div style={{...styles.section, ...(revealed ? {} : styles.ghostedSoft)}}>
                  <div style={styles.sectionHeader}>
                    <h3 style={styles.sectionTitle}>Life Areas</h3>
                  </div>
                  <div style={styles.lifeAreasGrid}>
                    {Object.entries(LIFE_AREAS).map(([key, area]) => {
                      const status = lifeAreaFocus[key];
                      const isActive = revealed || status;
                      return (
                        <div 
                          key={key} 
                          style={{
                            ...styles.lifeAreaPill,
                            opacity: isActive ? 1 : 0.3,
                            borderColor: status ? area.color : 'var(--border)',
                            backgroundColor: status ? `${area.color}15` : 'transparent',
                          }}
                          className={status ? 'slide-in' : ''}
                        >
                          <span style={{color: area.color}}>{area.icon}</span>
                          <span style={styles.lifeAreaName}>{area.name}</span>
                          {status && <span style={{...styles.statusDot, backgroundColor: area.color}}></span>}
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Mini Calendar */}
                <div style={{...styles.section, ...(revealed ? {} : styles.ghostedSoft)}}>
                  <div style={styles.sectionHeader}>
                    <h3 style={styles.sectionTitle}>The Year</h3>
                    {revealed && (
                      <button style={styles.sectionAdd} onClick={() => setShowEventModal(true)}>+ Add Event</button>
                    )}
                  </div>
                  <MiniYearCalendar 
                    events={events} 
                    revealed={revealed}
                    onMonthClick={(month) => setSelectedMonth(month)}
                  />
                </div>

                {/* Events List */}
                {events.length > 0 && (
                  <div style={{...styles.section}} className="fade-in">
                    <div style={styles.sectionHeader}>
                      <h3 style={styles.sectionTitle}>Planned</h3>
                    </div>
                    <div style={styles.eventsList}>
                      {events.map(event => (
                        <div key={event.id} style={styles.eventItem}>
                          <span style={styles.eventMonth}>{MONTHS[event.month]}</span>
                          <span style={styles.eventTitle}>{event.title}</span>
                          {revealed && (
                            <button 
                              style={styles.eventRemove}
                              onClick={() => setEvents(events.filter(e => e.id !== event.id))}
                            >×</button>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Chat Panel */}
            <div style={styles.chatPanel}>
              <div style={styles.chatMessages}>
                {messages.map((msg, idx) => (
                  <ChatMessage key={idx} message={msg} />
                ))}
                {isTyping && <TypingIndicator />}
                <div ref={messagesEndRef} />
              </div>
              
              <div style={styles.chatInputArea}>
                {!revealed && phase === PHASES.EXPLORE && (
                  <button style={styles.skipButton} onClick={handleSkip}>
                    Skip to planning →
                  </button>
                )}
                <div style={styles.inputRow}>
                  <textarea
                    style={styles.chatInput}
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleSendMessage();
                      }
                    }}
                    placeholder="Share what's on your mind..."
                    rows={2}
                  />
                  <button 
                    style={{
                      ...styles.sendButton,
                      ...(inputValue.trim() ? {} : styles.sendButtonDisabled)
                    }}
                    onClick={handleSendMessage}
                    disabled={!inputValue.trim()}
                  >
                    ↑
                  </button>
                </div>
              </div>
            </div>
          </main>

          {/* Event Modal */}
          {showEventModal && (
            <EventModal 
              onClose={() => setShowEventModal(false)}
              onAdd={handleAddEvent}
            />
          )}
        </div>
      );
    }

    // ============ MINI YEAR CALENDAR ============
    function MiniYearCalendar({ events, revealed, onMonthClick }) {
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();

      const getEventsForMonth = (monthIndex) => {
        return events.filter(e => e.month === monthIndex);
      };

      return (
        <div style={styles.miniYearGrid}>
          {MONTHS.map((monthName, idx) => {
            const monthEvents = getEventsForMonth(idx);
            const isCurrent = idx === currentMonth;
            
            return (
              <div 
                key={idx}
                style={{
                  ...styles.miniMonthCard,
                  ...(isCurrent && styles.miniMonthCurrent),
                  ...(monthEvents.length > 0 && styles.miniMonthWithEvents),
                  cursor: revealed ? 'pointer' : 'default',
                }}
                onClick={() => revealed && onMonthClick(idx)}
              >
                <span style={styles.miniMonthName}>{monthName}</span>
                {monthEvents.length > 0 && (
                  <div style={styles.miniMonthDots}>
                    {monthEvents.slice(0, 3).map((_, i) => (
                      <span key={i} style={styles.miniMonthDot}></span>
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      );
    }

    // ============ CHAT MESSAGE ============
    function ChatMessage({ message }) {
      const isAssistant = message.role === 'assistant';
      
      return (
        <div style={{...styles.chatMessage, justifyContent: isAssistant ? 'flex-start' : 'flex-end'}} className="fade-in">
          {isAssistant && (
            <div style={styles.chatAvatar}>
              <span style={styles.chatAvatarText}>T</span>
            </div>
          )}
          <div style={{...styles.chatBubble, ...(isAssistant ? styles.chatBubbleAssistant : styles.chatBubbleUser)}}>
            <div dangerouslySetInnerHTML={{ __html: message.content.replace(/\n/g, '<br/>') }} />
          </div>
        </div>
      );
    }

    // ============ TYPING INDICATOR ============
    function TypingIndicator() {
      return (
        <div style={styles.chatMessage} className="fade-in">
          <div style={styles.chatAvatar}>
            <span style={styles.chatAvatarText}>T</span>
          </div>
          <div style={styles.typingBubble}>
            <span style={{...styles.typingDot, animationDelay: '0s'}}>•</span>
            <span style={{...styles.typingDot, animationDelay: '0.15s'}}>•</span>
            <span style={{...styles.typingDot, animationDelay: '0.3s'}}>•</span>
          </div>
        </div>
      );
    }

    // ============ EVENT MODAL ============
    function EventModal({ onClose, onAdd }) {
      const [title, setTitle] = useState('');
      const [month, setMonth] = useState(new Date().getMonth());
      const [lifeArea, setLifeArea] = useState('fun');

      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={styles.modal} onClick={e => e.stopPropagation()} className="fade-up">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Add an event</h3>
              <button style={styles.modalClose} onClick={onClose}>×</button>
            </div>
            <form onSubmit={(e) => { 
              e.preventDefault(); 
              if (title) {
                onAdd({ 
                  title, 
                  month,
                  lifeArea,
                  startDate: `2026-${String(month + 1).padStart(2, '0')}-15`,
                  endDate: `2026-${String(month + 1).padStart(2, '0')}-15`,
                });
              }
            }} style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>What is it?</label>
                <input 
                  type="text" 
                  style={styles.textInput} 
                  value={title} 
                  onChange={(e) => setTitle(e.target.value)} 
                  placeholder="Trip to Italy, work conference, birthday..." 
                  autoFocus
                />
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>When?</label>
                <select 
                  style={styles.selectInput} 
                  value={month} 
                  onChange={(e) => setMonth(parseInt(e.target.value))}
                >
                  {MONTHS.map((m, i) => (
                    <option key={i} value={i}>{m} 2026</option>
                  ))}
                </select>
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>Life Area</label>
                <select 
                  style={styles.selectInput} 
                  value={lifeArea} 
                  onChange={(e) => setLifeArea(e.target.value)}
                >
                  {Object.entries(LIFE_AREAS).map(([key, area]) => (
                    <option key={key} value={key}>{area.icon} {area.name}</option>
                  ))}
                </select>
              </div>
              <button 
                type="submit" 
                style={{...styles.submitButton, ...(!title ? styles.submitButtonDisabled : {})}}
                disabled={!title}
              >
                Add to calendar
              </button>
            </form>
          </div>
        </div>
      );
    }

    // ============ STYLES ============
    const styles = {
      container: { 
        minHeight: '100vh', 
        display: 'flex', 
        flexDirection: 'column',
        backgroundColor: 'var(--bg-main)',
      },
      
      // Header
      header: {
        padding: '1rem 2rem',
        borderBottom: '1px solid var(--border)',
        backgroundColor: 'var(--bg-card)',
      },
      headerLeft: { display: 'flex', flexDirection: 'column', gap: '0.25rem' },
      logoContainer: { display: 'flex', alignItems: 'center' },
      logoText: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", fontWeight: 400, color: 'var(--text)' },
      tagline: { fontSize: '0.85rem', color: 'var(--text-muted)', fontStyle: 'italic', marginLeft: '36px' },

      // Main layout
      main: { 
        display: 'grid', 
        gridTemplateColumns: '1fr 420px', 
        flex: 1,
        height: 'calc(100vh - 70px)',
      },
      
      // Canvas Panel (Left)
      canvasPanel: { 
        padding: '2rem',
        overflow: 'auto',
        backgroundColor: 'var(--bg-main)',
      },
      canvasContent: {
        maxWidth: '600px',
        margin: '0 auto',
      },
      yearHeader: {
        textAlign: 'center',
        marginBottom: '2rem',
      },
      yearTitle: {
        fontSize: '3rem',
        fontFamily: "'Fraunces', serif",
        color: 'var(--text)',
        marginBottom: '0.25rem',
      },
      yearSubtitle: {
        fontSize: '0.9rem',
        color: 'var(--text-muted)',
        fontStyle: 'italic',
      },

      // Sections
      section: {
        marginBottom: '2rem',
        transition: 'opacity 0.5s ease',
      },
      sectionHeader: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: '0.75rem',
      },
      sectionTitle: {
        fontSize: '0.8rem',
        textTransform: 'uppercase',
        letterSpacing: '0.1em',
        color: 'var(--text-muted)',
        fontFamily: "'DM Sans', sans-serif",
        fontWeight: 500,
      },
      sectionAdd: {
        fontSize: '0.75rem',
        color: 'var(--accent)',
        background: 'none',
        border: 'none',
        cursor: 'pointer',
      },

      // Ghosted states
      ghosted: { opacity: 0.25, pointerEvents: 'none' },
      ghostedSoft: { opacity: 0.4 },
      ghostedPlaceholder: {
        display: 'flex',
        gap: '0.75rem',
      },
      ghostedCircle: {
        width: '60px',
        height: '32px',
        borderRadius: '16px',
        backgroundColor: 'var(--ghost)',
      },

      // Values
      valuesContainer: {
        minHeight: '40px',
      },
      valuesTags: {
        display: 'flex',
        flexWrap: 'wrap',
        gap: '0.5rem',
      },
      valueTag: {
        display: 'inline-flex',
        alignItems: 'center',
        gap: '0.5rem',
        padding: '0.5rem 1rem',
        backgroundColor: 'var(--accent)',
        color: 'white',
        borderRadius: '20px',
        fontSize: '0.875rem',
      },
      valueRemove: {
        background: 'none',
        border: 'none',
        color: 'white',
        opacity: 0.7,
        cursor: 'pointer',
        fontSize: '1rem',
        padding: 0,
        marginLeft: '0.25rem',
      },

      // Life Areas
      lifeAreasGrid: {
        display: 'grid',
        gridTemplateColumns: 'repeat(2, 1fr)',
        gap: '0.5rem',
      },
      lifeAreaPill: {
        display: 'flex',
        alignItems: 'center',
        gap: '0.5rem',
        padding: '0.625rem 0.875rem',
        borderRadius: '10px',
        border: '1px solid var(--border)',
        backgroundColor: 'transparent',
        transition: 'all 0.3s ease',
      },
      lifeAreaName: {
        fontSize: '0.8rem',
        color: 'var(--text)',
        flex: 1,
      },
      statusDot: {
        width: '6px',
        height: '6px',
        borderRadius: '50%',
      },

      // Mini Year Calendar
      miniYearGrid: {
        display: 'grid',
        gridTemplateColumns: 'repeat(4, 1fr)',
        gap: '0.5rem',
      },
      miniMonthCard: {
        padding: '0.75rem 0.5rem',
        borderRadius: '8px',
        backgroundColor: 'var(--bg-card)',
        border: '1px solid var(--border)',
        textAlign: 'center',
        transition: 'all 0.2s ease',
      },
      miniMonthCurrent: {
        borderColor: 'var(--accent)',
        boxShadow: '0 0 0 1px var(--accent)',
      },
      miniMonthWithEvents: {
        backgroundColor: 'var(--accent-light)',
      },
      miniMonthName: {
        fontSize: '0.75rem',
        fontWeight: 500,
        color: 'var(--text)',
      },
      miniMonthDots: {
        display: 'flex',
        justifyContent: 'center',
        gap: '3px',
        marginTop: '4px',
      },
      miniMonthDot: {
        width: '5px',
        height: '5px',
        borderRadius: '50%',
        backgroundColor: 'var(--accent)',
      },

      // Events List
      eventsList: {
        display: 'flex',
        flexDirection: 'column',
        gap: '0.5rem',
      },
      eventItem: {
        display: 'flex',
        alignItems: 'center',
        gap: '0.75rem',
        padding: '0.625rem 0.875rem',
        backgroundColor: 'var(--bg-card)',
        borderRadius: '8px',
        border: '1px solid var(--border)',
      },
      eventMonth: {
        fontSize: '0.7rem',
        fontWeight: 600,
        color: 'var(--accent)',
        textTransform: 'uppercase',
        minWidth: '32px',
      },
      eventTitle: {
        fontSize: '0.875rem',
        color: 'var(--text)',
        flex: 1,
      },
      eventRemove: {
        background: 'none',
        border: 'none',
        color: 'var(--text-muted)',
        cursor: 'pointer',
        fontSize: '1rem',
        opacity: 0.5,
      },

      // Chat Panel (Right)
      chatPanel: { 
        backgroundColor: 'var(--bg-card)', 
        borderLeft: '1px solid var(--border)', 
        display: 'flex', 
        flexDirection: 'column',
      },
      chatMessages: { 
        flex: 1, 
        padding: '1.5rem', 
        overflowY: 'auto', 
        display: 'flex', 
        flexDirection: 'column', 
        gap: '1rem',
      },
      chatInputArea: { 
        padding: '1rem 1.5rem 1.5rem', 
        borderTop: '1px solid var(--border)',
      },
      skipButton: {
        width: '100%',
        padding: '0.5rem',
        marginBottom: '0.75rem',
        backgroundColor: 'transparent',
        border: '1px solid var(--border)',
        borderRadius: '8px',
        color: 'var(--text-muted)',
        fontSize: '0.8rem',
        cursor: 'pointer',
        transition: 'all 0.2s ease',
      },
      inputRow: {
        display: 'flex',
        gap: '0.75rem',
        alignItems: 'flex-end',
      },
      chatInput: {
        flex: 1,
        padding: '0.875rem 1rem',
        backgroundColor: 'var(--bg-elevated)',
        border: '1px solid var(--border)',
        borderRadius: '12px',
        color: 'var(--text)',
        fontSize: '0.9rem',
        fontFamily: "'DM Sans', sans-serif",
        resize: 'none',
      },
      sendButton: {
        width: '42px',
        height: '42px',
        borderRadius: '50%',
        backgroundColor: 'var(--accent)',
        border: 'none',
        color: 'white',
        fontSize: '1.125rem',
        cursor: 'pointer',
        flexShrink: 0,
      },
      sendButtonDisabled: { 
        backgroundColor: 'var(--border)', 
        cursor: 'not-allowed',
      },

      // Chat Message
      chatMessage: { 
        display: 'flex', 
        gap: '0.75rem', 
        alignItems: 'flex-start',
      },
      chatAvatar: {
        width: '32px',
        height: '32px',
        borderRadius: '50%',
        backgroundColor: 'var(--accent-light)',
        border: '1px solid var(--accent)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        flexShrink: 0,
      },
      chatAvatarText: { 
        fontFamily: "'Fraunces', serif", 
        fontSize: '0.875rem', 
        color: 'var(--accent)',
      },
      chatBubble: { 
        padding: '0.875rem 1rem', 
        borderRadius: '14px', 
        maxWidth: '85%', 
        fontSize: '0.9rem', 
        lineHeight: 1.6,
      },
      chatBubbleAssistant: { 
        backgroundColor: 'var(--bg-elevated)', 
        borderTopLeftRadius: '4px', 
        color: 'var(--text)',
      },
      chatBubbleUser: { 
        backgroundColor: 'var(--accent)', 
        borderTopRightRadius: '4px', 
        color: 'white',
      },
      typingBubble: { 
        padding: '0.875rem 1rem', 
        backgroundColor: 'var(--bg-elevated)', 
        borderRadius: '14px', 
        borderTopLeftRadius: '4px', 
        display: 'flex', 
        gap: '4px',
      },
      typingDot: { 
        color: 'var(--accent)', 
        fontSize: '1.25rem', 
        lineHeight: 1, 
        animation: 'pulse 1s infinite',
      },

      // Modal
      modalOverlay: { 
        position: 'fixed', 
        top: 0, 
        left: 0, 
        right: 0, 
        bottom: 0, 
        backgroundColor: 'rgba(0,0,0,0.4)', 
        display: 'flex', 
        alignItems: 'center', 
        justifyContent: 'center', 
        zIndex: 1000,
      },
      modal: { 
        backgroundColor: 'var(--bg-card)', 
        borderRadius: '20px', 
        padding: '1.75rem', 
        width: '90%', 
        maxWidth: '400px', 
        border: '1px solid var(--border)',
      },
      modalHeader: { 
        display: 'flex', 
        justifyContent: 'space-between', 
        alignItems: 'center', 
        marginBottom: '1.5rem',
      },
      modalTitle: { 
        fontSize: '1.25rem', 
        fontFamily: "'Fraunces', serif", 
        color: 'var(--text)',
      },
      modalClose: { 
        width: '30px', 
        height: '30px', 
        borderRadius: '50%', 
        backgroundColor: 'var(--bg-elevated)', 
        border: 'none', 
        color: 'var(--text-muted)', 
        fontSize: '1.125rem', 
        cursor: 'pointer',
      },
      modalForm: { 
        display: 'flex', 
        flexDirection: 'column', 
        gap: '1.25rem',
      },
      formField: { 
        display: 'flex', 
        flexDirection: 'column', 
        gap: '0.5rem',
      },
      formLabel: { 
        fontSize: '0.75rem', 
        color: 'var(--text-muted)', 
        textTransform: 'uppercase', 
        letterSpacing: '0.05em', 
        fontWeight: 500,
      },
      textInput: {
        padding: '0.75rem 1rem',
        backgroundColor: 'var(--bg-elevated)',
        border: '1px solid var(--border)',
        borderRadius: '10px',
        color: 'var(--text)',
        fontSize: '0.9rem',
        fontFamily: "'DM Sans', sans-serif",
      },
      selectInput: {
        padding: '0.75rem 1rem',
        backgroundColor: 'var(--bg-elevated)',
        border: '1px solid var(--border)',
        borderRadius: '10px',
        color: 'var(--text)',
        fontSize: '0.9rem',
        fontFamily: "'DM Sans', sans-serif",
      },
      submitButton: { 
        padding: '0.875rem', 
        backgroundColor: 'var(--accent)', 
        border: 'none', 
        borderRadius: '12px', 
        color: 'white', 
        fontSize: '0.9rem', 
        fontFamily: "'DM Sans', sans-serif", 
        fontWeight: 500, 
        cursor: 'pointer', 
        marginTop: '0.25rem',
      },
      submitButtonDisabled: { 
        backgroundColor: 'var(--border-dark)', 
        cursor: 'not-allowed',
      },
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TendApp />);
  </script>
</body>
</html>
