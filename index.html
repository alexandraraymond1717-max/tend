<!DOCTYPE html>
<html lang="en">
<!-- v2.1 - Mode selection for all users -->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tend ‚Äî Intentional Living</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBh7pjHsvlk_c3Ya22U-fWCkSoL89lvnKE",
      authDomain: "tend-17.firebaseapp.com",
      projectId: "tend-17",
      storageBucket: "tend-17.firebasestorage.app",
      messagingSenderId: "795612428176",
      appId: "1:795612428176:web:bff64a86add4ed2aee2515",
      measurementId: "G-2XFLRSET2Y"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-main: #FAF8F5;
      --bg-card: #FFFFFF;
      --bg-elevated: #F0EBE4;
      --text: #2D2A26;
      --text-light: #6B6660;
      --text-muted: #9A9590;
      --border: #E8E2D9;
      --border-dark: #D4CCC0;
      --accent: #7D9B76;
      --accent-light: #E8F0E6;
      
      --winter: #7EB3E0;
      --winter-light: #F5F9FC;
      --spring: #8FD4A0;
      --spring-light: #F5FBF6;
      --summer: #F9D07A;
      --summer-light: #FFFDF7;
      --fall: #E8A090;
      --fall-light: #FDF7F5;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--bg-main);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    h1, h2, h3, h4 { font-family: 'Fraunces', serif; font-weight: 400; }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-dark); border-radius: 3px; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.7; } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    .slide-in { animation: slideIn 0.4s ease-out forwards; }

    input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent) !important; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ============ CONSTANTS ============
    const VLQ_DOMAINS = {
      family: { 
        name: 'Family', 
        description: 'Parents, siblings, children, extended family ‚Äî feeling connected to and supported by your family.',
        icon: 'üë®‚Äçüë©‚Äçüëß',
        color: '#E8A090'
      },
      partner: { 
        name: 'Partner & Romance', 
        description: 'Romantic relationship, intimacy, partnership ‚Äî feeling loved and loving fully.',
        icon: 'üíï',
        color: '#E88B9C'
      },
      friendships: { 
        name: 'Friendships', 
        description: 'Close friends, social connections ‚Äî feeling known, supported, and part of a community.',
        icon: 'üëØ',
        color: '#F9D07A'
      },
      career: { 
        name: 'Work & Career', 
        description: 'Professional growth, meaningful work, financial stability ‚Äî feeling purposeful in your work.',
        icon: 'üíº',
        color: '#7EB3E0'
      },
      education: { 
        name: 'Learning & Growth', 
        description: 'Knowledge, skills, intellectual curiosity ‚Äî feeling like you\'re growing and developing.',
        icon: 'üìö',
        color: '#B8A9C9'
      },
      recreation: { 
        name: 'Recreation & Fun', 
        description: 'Hobbies, play, leisure, relaxation ‚Äî feeling joy and lightness in life.',
        icon: 'üé®',
        color: '#8FD4A0'
      },
      spirituality: { 
        name: 'Spirituality & Meaning', 
        description: 'Purpose, faith, inner life, connection to something larger ‚Äî feeling grounded in meaning.',
        icon: '‚ú®',
        color: '#C4B5D4'
      },
      community: { 
        name: 'Community & Citizenship', 
        description: 'Giving back, volunteering, social responsibility ‚Äî feeling like you contribute to the world.',
        icon: 'üåç',
        color: '#8BC4A0'
      },
      health: { 
        name: 'Physical Health', 
        description: 'Body, movement, sleep, nutrition ‚Äî feeling strong, energized, and well.',
        icon: 'üí™',
        color: '#6BBF59'
      },
      mentalHealth: { 
        name: 'Mental Health', 
        description: 'Emotional wellbeing, self-care, inner peace ‚Äî feeling balanced and at ease with yourself.',
        icon: 'üß†',
        color: '#7EB3E0'
      },
    };

    const VLQ_ORDER = ['family', 'partner', 'friendships', 'career', 'education', 'recreation', 'spirituality', 'community', 'health', 'mentalHealth'];

    const LIFE_AREAS = {
      health: { name: 'Health & Wellness', icon: '‚óê', color: '#6BBF59' },
      relationships: { name: 'Relationships', icon: '‚ô°', color: '#E88B9C' },
      career: { name: 'Career & Work', icon: '‚óÜ', color: '#5B9BD5' },
      finances: { name: 'Finances', icon: '‚óã', color: '#F4B942' },
      growth: { name: 'Personal Growth', icon: '‚ú¶', color: '#9B8AAE' },
      fun: { name: 'Fun & Adventure', icon: '‚ú∫', color: '#D66B4B' },
    };

    const VALUE_KEYWORDS = {
      'Freedom': ['freedom', 'free', 'autonomy', 'independent', 'flexible'],
      'Connection': ['connection', 'connected', 'together', 'relationship', 'partner', 'love', 'present', 'presence'],
      'Growth': ['growth', 'grow', 'learn', 'improve', 'better', 'develop'],
      'Peace': ['peace', 'calm', 'peaceful', 'stress', 'less stressed', 'relaxed', 'balance'],
      'Health': ['health', 'healthy', 'fit', 'strong', 'energy', 'wellness'],
      'Adventure': ['adventure', 'travel', 'explore', 'new', 'exciting', 'experience'],
      'Creativity': ['creative', 'creativity', 'create', 'art', 'make', 'build'],
      'Family': ['family', 'kids', 'children', 'parents', 'home'],
      'Joy': ['joy', 'happy', 'happiness', 'fun', 'laugh', 'enjoy'],
      'Security': ['security', 'secure', 'stable', 'stability', 'safe'],
    };

    const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const MONTH_FULL = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    const PHASES = { EXPLORE: 'explore', GROUND: 'ground', REVEAL: 'reveal', PLAN: 'plan' };
    const CENTER_VIEWS = { YEAR: 'year', SEASONS: 'seasons', MONTHLY: 'monthly', WEEKLY: 'weekly', DAILY: 'daily' };

    // ============ MAIN APP ============
    // ============ VLQ ASSESSMENT ============
    function VLQAssessment({ vlqScores, setVlqScores, vlqStep, setVlqStep, onComplete }) {
      
      // Calculate gaps for summary
      const getGaps = () => {
        return VLQ_ORDER.map(key => ({
          key,
          name: VLQ_DOMAINS[key].name,
          icon: VLQ_DOMAINS[key].icon,
          color: VLQ_DOMAINS[key].color,
          importance: vlqScores[key]?.importance || 5,
          consistency: vlqScores[key]?.consistency || 5,
          gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)
        })).sort((a, b) => b.gap - a.gap);
      };

      const vlqStyles = {
        container: {
          minHeight: '100vh',
          backgroundColor: 'var(--bg-main)',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '2rem',
          fontFamily: "'DM Sans', sans-serif",
        },
        card: {
          backgroundColor: 'var(--bg-card)',
          borderRadius: '24px',
          padding: '2.5rem',
          maxWidth: '700px',
          width: '100%',
          boxShadow: '0 4px 24px rgba(0,0,0,0.06)',
          border: '1px solid var(--border)',
        },
        header: {
          textAlign: 'center',
          marginBottom: '2rem',
        },
        stepIndicator: {
          fontSize: '0.75rem',
          color: 'var(--text-muted)',
          textTransform: 'uppercase',
          letterSpacing: '0.1em',
          marginBottom: '0.5rem',
        },
        title: {
          fontSize: '1.5rem',
          fontFamily: "'Fraunces', serif",
          color: 'var(--text)',
          marginBottom: '0.5rem',
        },
        subtitle: {
          fontSize: '0.9rem',
          color: 'var(--text-muted)',
          lineHeight: 1.5,
        },
        valuesGrid: {
          display: 'flex',
          flexDirection: 'column',
          gap: '0.75rem',
          marginBottom: '2rem',
        },
        valueRow: {
          display: 'grid',
          gridTemplateColumns: '140px 1fr 40px',
          alignItems: 'center',
          gap: '1rem',
          padding: '0.75rem 1rem',
          backgroundColor: 'var(--bg-elevated)',
          borderRadius: '12px',
        },
        valueInfo: {
          display: 'flex',
          alignItems: 'center',
          gap: '0.5rem',
        },
        valueIcon: {
          fontSize: '1.1rem',
        },
        valueName: {
          fontSize: '0.85rem',
          color: 'var(--text)',
          fontWeight: 500,
        },
        slider: {
          width: '100%',
          height: '6px',
          borderRadius: '3px',
          appearance: 'none',
          background: 'var(--border)',
          outline: 'none',
          cursor: 'pointer',
        },
        valueScore: {
          fontSize: '1.1rem',
          fontWeight: 600,
          textAlign: 'center',
          fontFamily: "'Fraunces', serif",
        },
        buttons: {
          display: 'flex',
          gap: '1rem',
          justifyContent: 'center',
        },
        backButton: {
          padding: '0.875rem 2rem',
          backgroundColor: 'transparent',
          border: '1px solid var(--border)',
          borderRadius: '12px',
          color: 'var(--text-muted)',
          fontSize: '0.95rem',
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
        },
        nextButton: {
          padding: '0.875rem 2.5rem',
          backgroundColor: 'var(--accent)',
          border: 'none',
          borderRadius: '12px',
          color: 'white',
          fontSize: '0.95rem',
          fontWeight: 500,
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
        },
        hint: {
          textAlign: 'center',
          fontSize: '0.8rem',
          color: 'var(--text-muted)',
          marginBottom: '1.5rem',
          fontStyle: 'italic',
        },
        // Summary styles
        summarySection: {
          marginBottom: '1.5rem',
        },
        summarySectionTitle: {
          fontSize: '0.75rem',
          fontWeight: 600,
          textTransform: 'uppercase',
          letterSpacing: '0.1em',
          color: 'var(--text-muted)',
          marginBottom: '0.75rem',
        },
        summaryItem: {
          display: 'flex',
          alignItems: 'center',
          gap: '0.75rem',
          padding: '0.75rem',
          backgroundColor: 'var(--bg-elevated)',
          borderRadius: '10px',
          marginBottom: '0.5rem',
        },
        summaryItemIcon: {
          fontSize: '1.25rem',
        },
        summaryItemName: {
          flex: 1,
          fontSize: '0.9rem',
          color: 'var(--text)',
        },
        summaryItemScores: {
          display: 'flex',
          alignItems: 'center',
          gap: '0.375rem',
          fontSize: '0.85rem',
        },
        summaryItemGap: {
          fontSize: '0.75rem',
          padding: '0.2rem 0.5rem',
          borderRadius: '8px',
          fontWeight: 500,
        },
        intro: {
          textAlign: 'center',
        },
        introTitle: {
          fontSize: '2rem',
          fontFamily: "'Fraunces', serif",
          color: 'var(--text)',
          marginBottom: '1rem',
        },
        introText: {
          fontSize: '1rem',
          color: 'var(--text-muted)',
          lineHeight: 1.7,
          marginBottom: '2rem',
        },
        startButton: {
          padding: '1rem 3rem',
          backgroundColor: 'var(--accent)',
          border: 'none',
          borderRadius: '12px',
          color: 'white',
          fontSize: '1rem',
          fontWeight: 500,
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
        },
      };

      const handleImportanceChange = (key, value) => {
        setVlqScores(prev => ({
          ...prev,
          [key]: { ...prev[key], importance: value }
        }));
      };

      const handleConsistencyChange = (key, value) => {
        setVlqScores(prev => ({
          ...prev,
          [key]: { ...prev[key], consistency: value }
        }));
      };

      // Intro screen
      if (vlqStep === -1) {
        return (
          <div style={vlqStyles.container}>
            <div style={{...vlqStyles.card, ...vlqStyles.intro, maxWidth: '500px'}}>
              <svg width="80" height="80" viewBox="0 0 80 80" fill="none" style={{marginBottom: '1.5rem', opacity: 0.8}}>
                <path d="M40 70 L40 45" stroke="var(--accent)" strokeWidth="1.5" strokeLinecap="round"/>
                <path d="M40 55 Q30 50 25 40 Q35 45 40 55" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <path d="M40 45 Q50 38 55 28 Q45 35 40 45" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <path d="M40 35 Q32 28 30 18 Q38 25 40 35" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <path d="M40 28 Q48 22 52 12 Q44 20 40 28" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
                <circle cx="40" cy="70" r="3" fill="none" stroke="var(--accent)" strokeWidth="1.5"/>
              </svg>
              <h1 style={vlqStyles.introTitle}>Welcome to Tend</h1>
              <p style={{...vlqStyles.introText, marginBottom: '1.5rem'}}>
                Tend helps you design a life aligned with your values ‚Äî not just survive, but live intentionally and mindfully.
              </p>
              <p style={vlqStyles.introText}>
                To get started, you'll reflect on <strong>10 areas of life</strong>. For each one, you'll rate:
                <br /><br />
                <em>How important is this to you?</em>
                <br />
                <em>How consistently have you been living it?</em>
                <br /><br />
                Think deeply, but don't worry about perfection ‚Äî you can reassess your values anytime.
              </p>
              <button style={vlqStyles.startButton} onClick={() => setVlqStep(0)}>
                Let's Begin
              </button>
            </div>
          </div>
        );
      }

      // Step 0: Importance ratings for all values
      if (vlqStep === 0) {
        return (
          <div style={vlqStyles.container}>
            <div style={vlqStyles.card}>
              <div style={vlqStyles.header}>
                <div style={vlqStyles.stepIndicator}>Step 1 of 2</div>
                <h2 style={vlqStyles.title}>How important is each area to you?</h2>
                <p style={vlqStyles.subtitle}>
                  Rate each value from 1 (not important) to 10 (extremely important).
                </p>
              </div>
              
              <p style={vlqStyles.hint}>
                Not everything can be a 10 ‚Äî what truly matters most?
              </p>

              <div style={vlqStyles.valuesGrid}>
                {VLQ_ORDER.map(key => {
                  const domain = VLQ_DOMAINS[key];
                  const score = vlqScores[key]?.importance || 5;
                  return (
                    <div key={key} style={vlqStyles.valueRow}>
                      <div style={vlqStyles.valueInfo}>
                        <span style={vlqStyles.valueIcon}>{domain.icon}</span>
                        <span style={vlqStyles.valueName}>{domain.name}</span>
                      </div>
                      <input
                        type="range"
                        min="1"
                        max="10"
                        value={score}
                        onChange={(e) => handleImportanceChange(key, parseInt(e.target.value))}
                        style={{...vlqStyles.slider, accentColor: domain.color}}
                      />
                      <span style={{...vlqStyles.valueScore, color: domain.color}}>
                        {score}
                      </span>
                    </div>
                  );
                })}
              </div>

              <div style={vlqStyles.buttons}>
                <button style={vlqStyles.backButton} onClick={() => setVlqStep(-1)}>
                  Back
                </button>
                <button style={vlqStyles.nextButton} onClick={() => setVlqStep(1)}>
                  Next
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Step 1: Consistency ratings for all values
      if (vlqStep === 1) {
        return (
          <div style={vlqStyles.container}>
            <div style={vlqStyles.card}>
              <div style={vlqStyles.header}>
                <div style={vlqStyles.stepIndicator}>Step 2 of 2</div>
                <h2 style={vlqStyles.title}>How much have you been living each value?</h2>
                <p style={vlqStyles.subtitle}>
                  Rate your actual behavior ‚Äî not what you wish, but what you've actually been doing.
                </p>
              </div>
              
              <p style={vlqStyles.hint}>
                1 = not at all lately ¬∑ 10 = it's a major part of my life right now
              </p>

              <div style={vlqStyles.valuesGrid}>
                {VLQ_ORDER.map(key => {
                  const domain = VLQ_DOMAINS[key];
                  const score = vlqScores[key]?.consistency || 5;
                  const importance = vlqScores[key]?.importance || 5;
                  return (
                    <div key={key} style={vlqStyles.valueRow}>
                      <div style={vlqStyles.valueInfo}>
                        <span style={vlqStyles.valueIcon}>{domain.icon}</span>
                        <span style={vlqStyles.valueName}>{domain.name}</span>
                        <span style={{fontSize: '0.7rem', color: 'var(--text-muted)', marginLeft: '0.25rem'}}>
                          (imp: {importance})
                        </span>
                      </div>
                      <input
                        type="range"
                        min="1"
                        max="10"
                        value={score}
                        onChange={(e) => handleConsistencyChange(key, parseInt(e.target.value))}
                        style={{...vlqStyles.slider, accentColor: domain.color}}
                      />
                      <span style={{...vlqStyles.valueScore, color: domain.color}}>
                        {score}
                      </span>
                    </div>
                  );
                })}
              </div>

              <div style={vlqStyles.buttons}>
                <button style={vlqStyles.backButton} onClick={() => setVlqStep(0)}>
                  Back
                </button>
                <button style={vlqStyles.nextButton} onClick={() => setVlqStep(2)}>
                  See Results
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Step 2: Summary screen
      if (vlqStep === 2) {
        const gaps = getGaps();
        const growthAreas = gaps.filter(g => g.gap >= 3);
        const strengths = gaps.filter(g => g.importance >= 7 && g.consistency >= 7);
        const lowerPriority = gaps.filter(g => g.importance <= 5);

        return (
          <div style={vlqStyles.container}>
            <div style={vlqStyles.card}>
              <div style={vlqStyles.header}>
                <h2 style={vlqStyles.title}>Your Values Landscape</h2>
                <p style={vlqStyles.subtitle}>
                  Here's what you shared about what matters and where you are.
                </p>
              </div>

              {growthAreas.length > 0 && (
                <div style={vlqStyles.summarySection}>
                  <h3 style={vlqStyles.summarySectionTitle}>üå± Growth Areas</h3>
                  <p style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginBottom: '0.75rem', fontStyle: 'italic'}}>
                    High importance, room to grow
                  </p>
                  {growthAreas.map(item => (
                    <div key={item.key} style={vlqStyles.summaryItem}>
                      <span style={vlqStyles.summaryItemIcon}>{item.icon}</span>
                      <span style={vlqStyles.summaryItemName}>{item.name}</span>
                      <div style={vlqStyles.summaryItemScores}>
                        <span style={{color: 'var(--text-muted)'}}>{item.consistency}</span>
                        <span style={{color: 'var(--text-muted)'}}>‚Üí</span>
                        <span style={{color: item.color, fontWeight: 600}}>{item.importance}</span>
                      </div>
                      <span style={{
                        ...vlqStyles.summaryItemGap,
                        backgroundColor: `${item.color}20`,
                        color: item.color
                      }}>
                        +{item.gap}
                      </span>
                    </div>
                  ))}
                </div>
              )}

              {strengths.length > 0 && (
                <div style={vlqStyles.summarySection}>
                  <h3 style={vlqStyles.summarySectionTitle}>üí™ Strengths</h3>
                  <p style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginBottom: '0.75rem', fontStyle: 'italic'}}>
                    Important and you're living it
                  </p>
                  {strengths.map(item => (
                    <div key={item.key} style={vlqStyles.summaryItem}>
                      <span style={vlqStyles.summaryItemIcon}>{item.icon}</span>
                      <span style={vlqStyles.summaryItemName}>{item.name}</span>
                      <div style={vlqStyles.summaryItemScores}>
                        <span style={{color: item.color, fontWeight: 600}}>{item.consistency}</span>
                        <span style={{color: 'var(--text-muted)'}}>/</span>
                        <span style={{color: item.color, fontWeight: 600}}>{item.importance}</span>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {lowerPriority.length > 0 && (
                <div style={vlqStyles.summarySection}>
                  <h3 style={vlqStyles.summarySectionTitle}>‚ö™ Lower Priority Right Now</h3>
                  {lowerPriority.slice(0, 3).map(item => (
                    <div key={item.key} style={{...vlqStyles.summaryItem, opacity: 0.7}}>
                      <span style={vlqStyles.summaryItemIcon}>{item.icon}</span>
                      <span style={vlqStyles.summaryItemName}>{item.name}</span>
                      <span style={{fontSize: '0.8rem', color: 'var(--text-muted)'}}>{item.importance}/10</span>
                    </div>
                  ))}
                </div>
              )}

              <div style={vlqStyles.buttons}>
                <button style={vlqStyles.backButton} onClick={() => setVlqStep(1)}>
                  Back
                </button>
                <button style={vlqStyles.nextButton} onClick={onComplete}>
                  Continue to Planning ‚Üí
                </button>
              </div>
            </div>
          </div>
        );
      }

      return null;
    }

    // ============ AUTH MODAL ============
    function AuthModal({ onSuccess }) {
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          if (isLogin) {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
          onSuccess();
        } catch (err) {
          console.error('Auth error:', err);
          if (err.code === 'auth/email-already-in-use') {
            setError('This email is already registered. Try logging in.');
          } else if (err.code === 'auth/invalid-email') {
            setError('Please enter a valid email address.');
          } else if (err.code === 'auth/weak-password') {
            setError('Password should be at least 6 characters.');
          } else if (err.code === 'auth/user-not-found' || err.code === 'auth/wrong-password') {
            setError('Invalid email or password.');
          } else {
            setError(err.message);
          }
        } finally {
          setLoading(false);
        }
      };

      const authStyles = {
        container: {
          minHeight: '100vh',
          backgroundColor: 'var(--bg-main)',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '2rem',
          fontFamily: "'DM Sans', sans-serif",
        },
        card: {
          backgroundColor: 'var(--bg-card)',
          borderRadius: '24px',
          padding: '3rem',
          maxWidth: '400px',
          width: '100%',
          boxShadow: '0 4px 24px rgba(0,0,0,0.06)',
          border: '1px solid var(--border)',
          textAlign: 'center',
        },
        title: {
          fontSize: '1.75rem',
          fontFamily: "'Fraunces', serif",
          color: 'var(--text)',
          marginBottom: '0.5rem',
        },
        subtitle: {
          fontSize: '0.9rem',
          color: 'var(--text-muted)',
          marginBottom: '2rem',
        },
        form: {
          display: 'flex',
          flexDirection: 'column',
          gap: '1rem',
        },
        input: {
          padding: '0.875rem 1rem',
          border: '1px solid var(--border)',
          borderRadius: '10px',
          fontSize: '0.95rem',
          fontFamily: "'DM Sans', sans-serif",
          backgroundColor: 'var(--bg-elevated)',
          color: 'var(--text)',
          outline: 'none',
        },
        button: {
          padding: '1rem',
          backgroundColor: 'var(--accent)',
          border: 'none',
          borderRadius: '12px',
          color: 'white',
          fontSize: '1rem',
          fontWeight: 500,
          cursor: 'pointer',
          fontFamily: "'DM Sans', sans-serif",
          marginTop: '0.5rem',
        },
        toggle: {
          marginTop: '1.5rem',
          fontSize: '0.85rem',
          color: 'var(--text-muted)',
        },
        toggleLink: {
          color: 'var(--accent)',
          cursor: 'pointer',
          fontWeight: 500,
        },
        error: {
          color: '#d32f2f',
          fontSize: '0.85rem',
          marginTop: '0.5rem',
          padding: '0.5rem',
          backgroundColor: '#ffebee',
          borderRadius: '8px',
        },
      };

      return (
        <div style={authStyles.container}>
          <div style={authStyles.card}>
            <svg width="60" height="60" viewBox="0 0 80 80" fill="none" style={{marginBottom: '1rem', opacity: 0.8}}>
              <path d="M40 70 L40 45" stroke="var(--accent)" strokeWidth="1.5" strokeLinecap="round"/>
              <path d="M40 55 Q30 50 25 40 Q35 45 40 55" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
              <path d="M40 45 Q50 38 55 28 Q45 35 40 45" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
              <path d="M40 35 Q32 28 30 18 Q38 25 40 35" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
              <path d="M40 28 Q48 22 52 12 Q44 20 40 28" stroke="var(--accent)" strokeWidth="1.5" fill="none" strokeLinecap="round"/>
              <circle cx="40" cy="70" r="3" fill="none" stroke="var(--accent)" strokeWidth="1.5"/>
            </svg>
            <h1 style={authStyles.title}>{isLogin ? 'Welcome back' : 'Create account'}</h1>
            <p style={authStyles.subtitle}>
              {isLogin ? 'Sign in to continue your journey' : 'Start designing your intentional life'}
            </p>

            <form style={authStyles.form} onSubmit={handleSubmit}>
              <input
                type="email"
                placeholder="Email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                style={authStyles.input}
                required
              />
              <input
                type="password"
                placeholder="Password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                style={authStyles.input}
                required
              />
              {error && <div style={authStyles.error}>{error}</div>}
              <button type="submit" style={authStyles.button} disabled={loading}>
                {loading ? 'Please wait...' : (isLogin ? 'Sign In' : 'Create Account')}
              </button>
            </form>

            <p style={authStyles.toggle}>
              {isLogin ? "Don't have an account? " : "Already have an account? "}
              <span style={authStyles.toggleLink} onClick={() => { setIsLogin(!isLogin); setError(''); }}>
                {isLogin ? 'Sign up' : 'Sign in'}
              </span>
            </p>
          </div>
        </div>
      );
    }

    function TendApp() {
      // Auth state
      const [user, setUser] = useState(null);
      const [authLoading, setAuthLoading] = useState(true);
      const [dataLoaded, setDataLoaded] = useState(false);
      const [showLoadingIcon, setShowLoadingIcon] = useState(true);
      const [appMode, setAppMode] = useState(null); // null = choose, 'journal', 'plan'

      const [phase, setPhase] = useState(PHASES.EXPLORE);
      const [vlqScores, setVlqScores] = useState({
        family: { importance: null, consistency: null },
        partner: { importance: null, consistency: null },
        friendships: { importance: null, consistency: null },
        career: { importance: null, consistency: null },
        education: { importance: null, consistency: null },
        recreation: { importance: null, consistency: null },
        spirituality: { importance: null, consistency: null },
        community: { importance: null, consistency: null },
        health: { importance: null, consistency: null },
        mentalHealth: { importance: null, consistency: null },
      });
      const [vlqCompleted, setVlqCompleted] = useState(false);
      const [vlqStep, setVlqStep] = useState(-1); // -1 for intro, 0-9 for domains, 10 for summary
      const [values, setValues] = useState([]);
      const [lifeAreaRatings, setLifeAreaRatings] = useState({
        health: { satisfaction: null, intention: null },
        relationships: { satisfaction: null, intention: null },
        career: { satisfaction: null, intention: null },
        finances: { satisfaction: null, intention: null },
        growth: { satisfaction: null, intention: null },
        fun: { satisfaction: null, intention: null }
      });
      const [lifeAreasCompleted, setLifeAreasCompleted] = useState(false);
      const [lifeAreasMode, setLifeAreasMode] = useState(false);
      const [currentLifeAreaIndex, setCurrentLifeAreaIndex] = useState(0);
      const [waitingForSatisfaction, setWaitingForSatisfaction] = useState(true);
      const [isLastLifeAreaResponse, setIsLastLifeAreaResponse] = useState(false);
      const lifeAreaOrder = ['health', 'relationships', 'career', 'finances', 'growth', 'fun'];
      const lifeAreaDescriptions = {
        health: 'physical energy, movement, sleep, how your body feels',
        relationships: 'partner, family, friendships, feeling connected',
        career: 'work satisfaction, growth, meaning in what you do',
        finances: 'financial security, freedom, relationship with money',
        growth: 'learning, self-improvement, becoming who you want to be',
        fun: 'play, adventure, hobbies, things that bring you joy'
      };
      const [events, setEvents] = useState([]);
      const [goals, setGoals] = useState([]);
      const [notes, setNotes] = useState(''); // Planning notes in sidebar
      const [journalEntries, setJournalEntries] = useState({}); // Daily journal entries by date
      const [seasonIntentions, setSeasonIntentions] = useState({
        winter: '', spring: '', summer: '', fall: ''
      });
      const [yearTheme, setYearTheme] = useState('');
      const [weeklyHabits, setWeeklyHabits] = useState([]);
      const [dailyHabits, setDailyHabits] = useState([]);
      
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [exchangeCount, setExchangeCount] = useState(0);
      const messagesEndRef = useRef(null);

      const [revealed, setRevealed] = useState(false);
      const [activeTab, setActiveTab] = useState('events');
      const [sidebarExpanded, setSidebarExpanded] = useState(false);
      const [sidebarWidth, setSidebarWidth] = useState(240);
      const [isResizingSidebar, setIsResizingSidebar] = useState(false);
      const [centerView, setCenterView] = useState(CENTER_VIEWS.YEAR);
      const [expandedEvent, setExpandedEvent] = useState(null);
      const [showEventModal, setShowEventModal] = useState(false);
      const [showGoalModal, setShowGoalModal] = useState(false);
      const [showSettingsModal, setShowSettingsModal] = useState(false);
      const [apiKey, setApiKey] = useState(() => localStorage.getItem('tend_api_key') || '');
      const [chatWidth, setChatWidth] = useState(320);
      const [isResizing, setIsResizing] = useState(false);
      const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());

      // Auth state listener
      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged((firebaseUser) => {
          setUser(firebaseUser);
          setAuthLoading(false);
          if (firebaseUser) {
            // Load user data from Firestore
            loadUserData(firebaseUser.uid);
          }
        });
        return () => unsubscribe();
      }, []);

      // Show loading icon for at least 1.5 seconds
      useEffect(() => {
        const timer = setTimeout(() => {
          setShowLoadingIcon(false);
        }, 1500);
        return () => clearTimeout(timer);
      }, []);

      // Load user data from Firestore
      const loadUserData = async (userId) => {
        try {
          const doc = await db.collection('users').doc(userId).get();
          if (doc.exists) {
            const data = doc.data();
            if (data.vlqScores) setVlqScores(data.vlqScores);
            if (data.vlqCompleted) setVlqCompleted(data.vlqCompleted);
            if (data.yearTheme) setYearTheme(data.yearTheme);
            if (data.events) setEvents(data.events);
            if (data.goals) setGoals(data.goals);
            if (data.notes) setNotes(data.notes);
            if (data.journalEntries) setJournalEntries(data.journalEntries);
            if (data.seasonIntentions) setSeasonIntentions(data.seasonIntentions);
            if (data.weeklyHabits) setWeeklyHabits(data.weeklyHabits);
            if (data.dailyHabits) setDailyHabits(data.dailyHabits);
            if (data.revealed) setRevealed(data.revealed);
            if (data.phase) setPhase(data.phase);
            // If VLQ was completed, skip to step 2 (after summary)
            if (data.vlqCompleted) setVlqStep(2);
          }
          setDataLoaded(true);
        } catch (error) {
          console.error('Error loading user data:', error);
          setDataLoaded(true);
        }
      };

      // Save user data to Firestore (debounced)
      const saveTimeoutRef = useRef(null);
      const saveUserData = useCallback(() => {
        if (!user) return;
        
        // Clear existing timeout
        if (saveTimeoutRef.current) {
          clearTimeout(saveTimeoutRef.current);
        }
        
        // Debounce: save after 1 second of no changes
        saveTimeoutRef.current = setTimeout(async () => {
          try {
            await db.collection('users').doc(user.uid).set({
              vlqScores,
              vlqCompleted,
              yearTheme,
              events,
              goals,
              notes,
              journalEntries,
              seasonIntentions,
              weeklyHabits,
              dailyHabits,
              revealed,
              phase,
              updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            }, { merge: true });
            console.log('Data saved');
          } catch (error) {
            console.error('Error saving user data:', error);
          }
        }, 1000);
      }, [user, vlqScores, vlqCompleted, yearTheme, events, goals, notes, journalEntries, seasonIntentions, weeklyHabits, dailyHabits, revealed, phase]);

      // Auto-save when data changes
      useEffect(() => {
        if (user && dataLoaded) {
          saveUserData();
        }
      }, [vlqScores, vlqCompleted, yearTheme, events, goals, notes, journalEntries, seasonIntentions, weeklyHabits, dailyHabits, revealed, phase, user, dataLoaded]);

      // Logout function
      const handleLogout = async () => {
        try {
          await auth.signOut();
          // Reset all state
          setVlqScores({
            family: { importance: null, consistency: null },
            partner: { importance: null, consistency: null },
            friendships: { importance: null, consistency: null },
            career: { importance: null, consistency: null },
            education: { importance: null, consistency: null },
            recreation: { importance: null, consistency: null },
            spirituality: { importance: null, consistency: null },
            community: { importance: null, consistency: null },
            health: { importance: null, consistency: null },
            mentalHealth: { importance: null, consistency: null },
          });
          setVlqCompleted(false);
          setVlqStep(-1);
          setYearTheme('');
          setEvents([]);
          setGoals([]);
          setNotes('');
          setSeasonIntentions({ winter: '', spring: '', summer: '', fall: '' });
          setWeeklyHabits([]);
          setDailyHabits([]);
          setRevealed(false);
          setPhase(PHASES.EXPLORE);
          setMessages([]);
          setDataLoaded(false);
        } catch (error) {
          console.error('Error signing out:', error);
        }
      };

      // Loading screen - just the icon
      const loadingScreen = (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundColor: 'var(--bg-main)',
        }}>
          <svg width="48" height="48" viewBox="0 0 80 80" fill="none" style={{opacity: 0.6}}>
            <path d="M40 70 L40 45" stroke="var(--accent)" strokeWidth="2" strokeLinecap="round"/>
            <path d="M40 55 Q30 50 25 40 Q35 45 40 55" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <path d="M40 45 Q50 38 55 28 Q45 35 40 45" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <path d="M40 35 Q32 28 30 18 Q38 25 40 35" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <path d="M40 28 Q48 22 52 12 Q44 20 40 28" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <circle cx="40" cy="70" r="4" fill="none" stroke="var(--accent)" strokeWidth="2"/>
          </svg>
        </div>
      );

      // Initial chat message after VLQ
      useEffect(() => {
        // Only set initial message after VLQ is complete and data is loaded
        if (vlqCompleted && messages.length === 0 && dataLoaded) {
          // Find top growth areas - include all needed fields
          const gaps = VLQ_ORDER.map(key => ({
            key,
            name: VLQ_DOMAINS[key].name,
            importance: vlqScores[key]?.importance || 5,
            consistency: vlqScores[key]?.consistency || 5,
            gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)
          })).sort((a, b) => b.gap - a.gap);
          
          // Find the biggest growth area (gap >= 2) to explore
          const biggestGap = gaps.find(g => g.gap >= 2);
          
          // Find a strength (high importance AND high consistency)
          const topStrength = gaps.find(a => a.importance >= 7 && a.consistency >= 6);

          let openingMessage = '';

          // If they already have a theme word, welcome them back with next steps
          if (yearTheme) {
            openingMessage = `Welcome back! Your word for the year is <em>${yearTheme}</em>.

Now that you have your compass, there are a few paths we could explore together:

<strong>üå∏ Seasons</strong> ‚Äî What do you want each season to feel like? Winter might be for rest, spring for new beginnings...

<strong>üìÖ Events</strong> ‚Äî Are there trips, milestones, or commitments to map out? Let's make sure your calendar reflects your values.

<strong>üîÅ Rhythms</strong> ‚Äî What weekly or daily habits would help you live into <em>${yearTheme}</em>?

What feels most alive for you right now?`;
          } else {
            // New user - introduce the process
            openingMessage = `Thank you for sharing what matters to you.

My goal is to help you design a year that actually aligns with your values ‚Äî not just a list of goals, but a life that feels intentional and true to who you are.

To do that, we'll start by finding a <em>theme word</em> for your year ‚Äî one guiding word you can return to when making decisions, setting priorities, or just checking in with yourself.

But first, I'd love to understand your values a bit more deeply.`;
          
            if (biggestGap && biggestGap.gap >= 2) {
              openingMessage += `

I noticed <em>${biggestGap.name}</em> really matters to you (${biggestGap.importance}/10), but you rated how you've been living it as ${biggestGap.consistency}/10. That gap is meaningful.

What's been getting in the way there?`;
            } else if (topStrength) {
              openingMessage += `

I see <em>${topStrength.name}</em> is both important to you and something you're living well ‚Äî that's a real strength.

What's helped you stay consistent there? And are there other areas you'd like to bring that same energy to?`;
            } else {
              openingMessage += `

Looking at your values, what's been on your mind lately? What do you wish had more space in your life this year?`;
            }
          }

          setMessages([{
            role: 'assistant',
            content: openingMessage
          }]);
        }
      }, [vlqCompleted, dataLoaded, yearTheme]);

      // Track view/tab for system prompt context (no auto-messages)

      // Chat resize handlers
      const handleMouseDown = (e) => {
        setIsResizing(true);
        e.preventDefault();
      };

      useEffect(() => {
        const handleMouseMove = (e) => {
          if (!isResizing) return;
          const newWidth = window.innerWidth - e.clientX;
          setChatWidth(Math.min(Math.max(280, newWidth), 600));
        };

        const handleMouseUp = () => {
          setIsResizing(false);
        };

        if (isResizing) {
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);
        }

        return () => {
          document.removeEventListener('mousemove', handleMouseMove);
          document.removeEventListener('mouseup', handleMouseUp);
        };
      }, [isResizing]);

      // Sidebar resize handlers
      const handleSidebarMouseDown = (e) => {
        setIsResizingSidebar(true);
        e.preventDefault();
      };

      useEffect(() => {
        const handleSidebarMouseMove = (e) => {
          if (!isResizingSidebar) return;
          const newWidth = e.clientX;
          setSidebarWidth(Math.min(Math.max(200, newWidth), 400));
        };

        const handleSidebarMouseUp = () => {
          setIsResizingSidebar(false);
        };

        if (isResizingSidebar) {
          document.addEventListener('mousemove', handleSidebarMouseMove);
          document.addEventListener('mouseup', handleSidebarMouseUp);
        }

        return () => {
          document.removeEventListener('mousemove', handleSidebarMouseMove);
          document.removeEventListener('mouseup', handleSidebarMouseUp);
        };
      }, [isResizingSidebar]);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const analyzeText = (text) => {
        const lower = text.toLowerCase();
        const detected = { values: [] };
        Object.entries(VALUE_KEYWORDS).forEach(([value, keywords]) => {
          if (keywords.some(kw => lower.includes(kw)) && !values.includes(value)) {
            detected.values.push(value);
          }
        });
        return detected;
      };

      const processAnalysis = (detected) => {
        if (detected.values.length > 0) {
          setValues(prev => [...new Set([...prev, ...detected.values])].slice(0, 4));
        }
      };

      const parseEvents = (text) => {
        const lower = text.toLowerCase();
        const foundEvents = [];
        MONTH_FULL.forEach((month, idx) => {
          if (lower.includes(month.toLowerCase())) {
            foundEvents.push({ month: idx });
          }
        });
        return foundEvents;
      };

      const generateResponse = (userMessage, currentPhase, exchangeNum) => {
        const detected = analyzeText(userMessage);
        processAnalysis(detected);
        const lower = userMessage.toLowerCase();

        if (currentPhase === PHASES.EXPLORE) {
          if (exchangeNum === 1) {
            // Try to extract a theme word from their response
            const words = userMessage.split(/\s+/).filter(w => w.length > 2 && w.length < 15);
            const potentialTheme = words.find(w => 
              /^[a-zA-Z]+$/.test(w) && 
              !['the', 'and', 'but', 'for', 'that', 'this', 'with', 'would', 'could', 'think', 'want', 'like', 'year', 'maybe', 'something'].includes(w.toLowerCase())
            );
            
            if (potentialTheme && words.length <= 5) {
              // They likely gave a single word or short phrase
              setYearTheme(potentialTheme.toLowerCase());
              return `<em>${potentialTheme.charAt(0).toUpperCase() + potentialTheme.slice(1).toLowerCase()}</em> ‚Äî I love that.

What does ${potentialTheme.toLowerCase()} mean to you? What would it look like if this year actually embodied that word?`;
            }
            
            const hasFeeling = ['feel', 'feeling', 'want to be', 'less', 'more'].some(w => lower.includes(w));
            if (hasFeeling) {
              return `That's about <em>how</em> you want to feel ‚Äî which is often more important than what you achieve.

If you had to distill that into one word, what would it be? And what's getting in the way of that right now?`;
            }
            return `Tell me more. If you could capture that in a single word ‚Äî a theme for the year ‚Äî what might it be?`;
          }
          
          if (exchangeNum === 2) {
            // Check if they gave a theme word this time
            const words = userMessage.split(/\s+/).filter(w => w.length > 2 && w.length < 15);
            const potentialTheme = words.find(w => 
              /^[a-zA-Z]+$/.test(w) && 
              !['the', 'and', 'but', 'for', 'that', 'this', 'with', 'would', 'could', 'think', 'want', 'like', 'year', 'maybe', 'something'].includes(w.toLowerCase())
            );
            
            if (potentialTheme && !yearTheme) {
              setYearTheme(potentialTheme.toLowerCase());
            }
            
            return `I'm starting to see what matters to you.

If nothing changed this year, how would that feel?`;
          }

          if (exchangeNum >= 3) {
            setPhase(PHASES.GROUND);
            return `Before I share what I'm hearing, help me understand what's already planned.

What's committed this year ‚Äî trips, big events, deadlines? Just mention the month and what it is.`;
          }
        }

        if (currentPhase === PHASES.GROUND) {
          const foundEvents = parseEvents(userMessage);
          
          if (foundEvents.length > 0) {
            const newEvents = foundEvents.map((e, i) => ({
              id: Date.now() + i,
              title: `Event in ${MONTHS[e.month]}`,
              month: e.month,
              lifeArea: 'fun',
              details: { flights: '', stays: '', activities: '', notes: '' },
            }));
            setEvents(prev => [...prev, ...newEvents]);
          }

          setTimeout(() => {
            setPhase(PHASES.REVEAL);
            setRevealed(true);
          }, 500);

          const valuesSummary = values.length > 0 
            ? values.slice(0, 3).join(', ')
            : 'intention and presence';

          return `<strong>Here's what I'm hearing:</strong>

Your values center around <em>${valuesSummary}</em>.

${foundEvents.length > 0 
  ? `You have ${foundEvents.length} thing${foundEvents.length > 1 ? 's' : ''} anchoring the year.`
  : `Your calendar is open ‚Äî that's space to be intentional.`}

Your year is taking shape. Switch between Year, Seasons, and Monthly views to explore different perspectives.

What's missing?`;
        }

        if (currentPhase === PHASES.REVEAL || currentPhase === PHASES.PLAN) {
          setPhase(PHASES.PLAN);

          // Sidebar tabs - Events
          if (activeTab === 'events') {
            if (lower.includes('trip') || lower.includes('travel') || lower.includes('vacation') || lower.includes('visit')) {
              return `A trip! Let's plan it.

Tell me:
‚Ä¢ <em>Where</em> are you thinking?
‚Ä¢ <em>When</em> ‚Äî which month?
‚Ä¢ <em>Who's going</em> ‚Äî solo, partner, friends, family?

Once you add it, I can help with activities, stays, and logistics.`;
            }

            if (lower.includes('birthday') || lower.includes('anniversary') || lower.includes('celebration')) {
              return `Celebrations deserve planning too.

What would make this one special? Think about:
‚Ä¢ The <em>experience</em> you want to create
‚Ä¢ Who needs to be involved
‚Ä¢ What you want to remember about it

Add it to your events and we can flesh out the details.`;
            }

            if (lower.includes('deadline') || lower.includes('work') || lower.includes('project') || lower.includes('launch')) {
              return `Work events anchor the year too.

For this deadline or project:
‚Ä¢ What needs to happen <em>before</em> it?
‚Ä¢ Do you need to protect time leading up to it?
‚Ä¢ What would make it feel successful, not just done?`;
            }

            const eventCount = events.length;
            if (eventCount > 0) {
              return `You have ${eventCount} event${eventCount > 1 ? 's' : ''} planned. Want to add another, or dive deeper into one of these?

I can help with:
‚Ä¢ Activity ideas for any trip
‚Ä¢ Logistics and planning
‚Ä¢ Making sure you're not over-scheduling`;
            }

            return `What's on the horizon? Trips, celebrations, deadlines, milestones?

Even tentative plans are worth capturing ‚Äî they help you see the shape of your year.`;
          }

          // Sidebar tabs - Notes
          if (activeTab === 'notes') {
            return `This is your space to think out loud.

You can use it for:
‚Ä¢ Brain dumps when your head is full
‚Ä¢ Ideas you're not ready to act on
‚Ä¢ Reflections on how things are going
‚Ä¢ Anything that doesn't fit elsewhere

What's taking up mental space right now?`;
          }

          // Sidebar tabs - Goals
          if (activeTab === 'goals') {
            if (lower.includes('fitness') || lower.includes('health') || lower.includes('weight') || lower.includes('run') || lower.includes('exercise')) {
              return `Health goals are foundational.

Make them specific and achievable:
‚Ä¢ <em>"Run a 5K"</em> beats "get in shape"
‚Ä¢ <em>"Workout 3x/week for 3 months"</em> beats "exercise more"
‚Ä¢ <em>"Lose 10 pounds by June"</em> beats "lose weight"

What's your real target?`;
            }

            if (lower.includes('read') || lower.includes('book') || lower.includes('learn')) {
              return `Learning goals expand your world.

Some ways to frame them:
‚Ä¢ <em>"Read 12 books"</em> ‚Äî one a month
‚Ä¢ <em>"Finish one online course"</em>
‚Ä¢ <em>"Learn conversational Spanish"</em>

What do you want to know by year's end?`;
            }

            if (lower.includes('save') || lower.includes('money') || lower.includes('financial') || lower.includes('invest')) {
              return `Financial goals create options.

Be specific:
‚Ä¢ <em>"Save $10K for emergency fund"</em>
‚Ä¢ <em>"Max out retirement contribution"</em>
‚Ä¢ <em>"Pay off credit card by August"</em>

What number would make you feel more secure?`;
            }

            const goalCount = goals.length;
            if (goalCount > 0) {
              return `You have ${goalCount} goal${goalCount > 1 ? 's' : ''} set. Want to add another, or talk through how to make progress on one?

Goals work best when they're:
‚Ä¢ Specific enough to know when you've hit them
‚Ä¢ Connected to what actually matters to you`;
            }

            return `What do you want to be true by the end of this year that isn't true now?

Don't overthink it ‚Äî you can always refine. Start with what comes to mind.`;
          }
          
          // Seasons view - help with season intentions
          if (centerView === CENTER_VIEWS.SEASONS) {
            const seasonWords = {
              winter: ['cozy', 'rest', 'reflect', 'hibernate', 'slow', 'quiet', 'warm'],
              spring: ['renew', 'fresh', 'start', 'bloom', 'energy', 'clean', 'grow'],
              summer: ['adventure', 'explore', 'freedom', 'play', 'travel', 'sun', 'joy'],
              fall: ['harvest', 'gather', 'prepare', 'focus', 'transition', 'gratitude', 'settle']
            };
            
            const currentSeasonName = (() => {
              const month = new Date().getMonth();
              if ([11, 0, 1].includes(month)) return 'winter';
              if ([2, 3, 4].includes(month)) return 'spring';
              if ([5, 6, 7].includes(month)) return 'summer';
              return 'fall';
            })();

            if (lower.includes('winter') || lower.includes('cold') || lower.includes('december') || lower.includes('january') || lower.includes('february')) {
              return `Winter is a time for slowing down.

Some intentions to consider:
‚Ä¢ <em>"Rest without guilt"</em>
‚Ä¢ <em>"Protect my mornings"</em>  
‚Ä¢ <em>"Less doing, more being"</em>

What would make your winter feel nourishing rather than just something to get through?`;
            }
            
            if (lower.includes('spring') || lower.includes('march') || lower.includes('april') || lower.includes('may')) {
              return `Spring is about emergence and new energy.

Some intentions to consider:
‚Ä¢ <em>"Start one thing I've been putting off"</em>
‚Ä¢ <em>"Clear what's not serving me"</em>
‚Ä¢ <em>"Say yes to something new"</em>

What wants to bloom in your life this spring?`;
            }

            if (lower.includes('summer') || lower.includes('june') || lower.includes('july') || lower.includes('august')) {
              return `Summer holds space for expansion and joy.

Some intentions to consider:
‚Ä¢ <em>"Prioritize experiences over tasks"</em>
‚Ä¢ <em>"Protect time for spontaneity"</em>
‚Ä¢ <em>"Be present in the long days"</em>

What would a summer well-lived look like for you?`;
            }

            if (lower.includes('fall') || lower.includes('autumn') || lower.includes('september') || lower.includes('october') || lower.includes('november')) {
              return `Fall is a season of gathering and grounding.

Some intentions to consider:
‚Ä¢ <em>"Harvest what I've built"</em>
‚Ä¢ <em>"Simplify before winter"</em>
‚Ä¢ <em>"Celebrate progress, not just goals"</em>

What do you want to carry into the darker months?`;
            }

            return `Think about what each season needs from you ‚Äî and what you need from it.

You're in <em>${currentSeasonName}</em> right now. How's it going? What would help this season feel more aligned with what you want?`;
          }

          // Monthly view - help with specific month planning
          if (centerView === CENTER_VIEWS.MONTHLY) {
            const monthName = MONTH_FULL[selectedMonth];
            
            if (lower.includes('plan') || lower.includes('suggest') || lower.includes('ideas') || lower.includes('what should')) {
              return `For <em>${monthName}</em>, let's think about:

<strong>What's already anchored?</strong>
Work commitments, birthdays, holidays, travel

<strong>What do you want to protect?</strong>
Rest days, date nights, creative time, nothing-days

<strong>What's one thing that would make this month feel successful?</strong>

Tell me what's on your mind for ${monthName}.`;
            }

            const monthEvents = events.filter(e => e.month === selectedMonth);
            if (monthEvents.length > 0) {
              return `You have <em>${monthEvents.length}</em> thing${monthEvents.length > 1 ? 's' : ''} in ${monthName}: ${monthEvents.map(e => e.title).join(', ')}.

Want me to help you think through any of these? I can suggest activities, help with logistics, or just think through what would make it great.`;
            }

            return `${monthName} is open ‚Äî that's possibility.

What would make this month feel intentional rather than just busy? Any trips, goals, or moments you want to create?`;
          }

          // Weekly view - help with weekly habits
          if (centerView === CENTER_VIEWS.WEEKLY) {
            if (lower.includes('exercise') || lower.includes('workout') || lower.includes('gym') || lower.includes('run') || lower.includes('movement')) {
              return `Movement is foundational. Some weekly rhythms to consider:

‚Ä¢ <em>3x strength, 2x cardio</em> ‚Äî classic balance
‚Ä¢ <em>Daily walks + 2x intense sessions</em> ‚Äî gentler approach
‚Ä¢ <em>1 long active adventure</em> ‚Äî hiking, biking, swimming

What feels sustainable for you? The best routine is one you'll actually do.`;
            }

            if (lower.includes('date') || lower.includes('partner') || lower.includes('relationship') || lower.includes('connect')) {
              return `Protecting time for relationships is one of the most important things you can do.

Ideas for weekly connection:
‚Ä¢ <em>Weekly date night</em> ‚Äî same night each week makes it automatic
‚Ä¢ <em>Morning coffee together</em> ‚Äî 15 minutes of presence
‚Ä¢ <em>Phone-free dinner</em> ‚Äî simple but powerful

What would help your relationships thrive?`;
            }

            if (lower.includes('creative') || lower.includes('hobby') || lower.includes('learn') || lower.includes('read')) {
              return `Making space for creativity and growth:

‚Ä¢ <em>2 hours of creative time</em> ‚Äî protect it like a meeting
‚Ä¢ <em>One chapter a day</em> ‚Äî books add up
‚Ä¢ <em>Weekly learning session</em> ‚Äî courses, podcasts, practice

What do you want to make more time for?`;
            }

            return `Think about the activities that, when you do them regularly, make everything else feel better.

What would you put on your <em>ideal week</em>? Start with just one or two ‚Äî you can always add more.`;
          }

          // Daily view - help with daily habits  
          if (centerView === CENTER_VIEWS.DAILY) {
            if (lower.includes('morning') || lower.includes('wake') || lower.includes('routine')) {
              return `Mornings set the tone for everything.

Some daily morning practices:
‚Ä¢ <em>No phone for first 30 minutes</em>
‚Ä¢ <em>10 minutes of movement</em>
‚Ä¢ <em>Write 3 things you're grateful for</em>
‚Ä¢ <em>One intentional deep breath</em>

What would your ideal morning include?`;
            }

            if (lower.includes('water') || lower.includes('hydrat') || lower.includes('drink')) {
              return `Hydration is one of those small things with outsized impact.

Simple targets:
‚Ä¢ <em>8 glasses / 2 liters</em> ‚Äî the classic
‚Ä¢ <em>Glass before each meal</em> ‚Äî easy to remember
‚Ä¢ <em>Water bottle always visible</em> ‚Äî environment design

What would help you drink more water?`;
            }

            if (lower.includes('walk') || lower.includes('step') || lower.includes('move')) {
              return `Daily movement doesn't have to be intense to be transformative.

Ideas:
‚Ä¢ <em>10,000 steps</em> ‚Äî the gold standard
‚Ä¢ <em>Walk after each meal</em> ‚Äî aids digestion too
‚Ä¢ <em>Standing desk + hourly movement breaks</em>

What level of daily movement feels right for you?`;
            }

            if (lower.includes('phone') || lower.includes('screen') || lower.includes('social media')) {
              return `Our relationship with technology shapes our days more than we realize.

Boundaries to consider:
‚Ä¢ <em>No phone in bedroom</em>
‚Ä¢ <em>App limits on social media</em>
‚Ä¢ <em>Phone-free first and last hour</em>
‚Ä¢ <em>Grayscale mode</em>

What boundary would give you the most peace?`;
            }

            return `Daily habits are about becoming the person you want to be, one small action at a time.

Start tiny ‚Äî what's one thing you could do <em>every single day</em> that would compound over a year?`;
          }
          
          // Default planning responses
          if (lower.includes('plan') || lower.includes('suggest') || lower.includes('ideas') || lower.includes('activities') || lower.includes('where to stay')) {
            const eventMention = events.find(e => lower.includes(MONTHS[e.month].toLowerCase()) || lower.includes(e.title.toLowerCase()));
            if (eventMention) {
              return `For your ${MONTHS[eventMention.month]} event:

<strong>Activities:</strong>
‚Ä¢ Explore the local neighborhood on foot
‚Ä¢ Find one "must-do" and leave room for spontaneity
‚Ä¢ Schedule downtime ‚Äî rest is part of the trip

<strong>Stays:</strong>
‚Ä¢ Look for somewhere with a kitchen for flexibility
‚Ä¢ Consider location vs. price

Click on the event in the sidebar to add details.`;
            }
            return `What event would you like to plan? I can suggest activities, places to stay, and things to consider.`;
          }

          const prompts = [
            `What's one thing you've been wanting to plan but haven't?`,
            `Looking at the seasons ‚Äî where do you need to protect space?`,
            `Is there a trip or experience you keep pushing off?`,
          ];
          return prompts[Math.floor(Math.random() * prompts.length)];
        }

        return `Tell me more about that.`;
      };

      // System prompt for Tend AI
      const getTendSystemPrompt = (pendingState = {}) => {
        const { 
          pendingLifeAreaUpdate, 
          pendingNextAreaIndex, 
          pendingWaitingForSatisfaction,
          pendingIsLastResponse 
        } = pendingState;
        
        // Use pending values if provided, otherwise use current state
        const effectiveAreaIndex = pendingNextAreaIndex !== undefined ? pendingNextAreaIndex : currentLifeAreaIndex;
        const effectiveWaitingFor = pendingWaitingForSatisfaction !== undefined ? pendingWaitingForSatisfaction : waitingForSatisfaction;
        const effectiveIsLast = pendingIsLastResponse || isLastLifeAreaResponse;
        
        // Build updated life area ratings including any pending update
        const effectiveRatings = pendingLifeAreaUpdate 
          ? {
              ...lifeAreaRatings,
              [pendingLifeAreaUpdate.area]: {
                ...lifeAreaRatings[pendingLifeAreaUpdate.area],
                [pendingLifeAreaUpdate.field]: pendingLifeAreaUpdate.score
              }
            }
          : lifeAreaRatings;

        const currentSeason = (() => {
          const month = new Date().getMonth();
          if ([11, 0, 1].includes(month)) return 'winter';
          if ([2, 3, 4].includes(month)) return 'spring';
          if ([5, 6, 7].includes(month)) return 'summer';
          return 'fall';
        })();

        const lifeAreasContext = vlqCompleted 
          ? VLQ_ORDER.map(key => {
              const scores = vlqScores[key];
              const gap = (scores?.importance || 0) - (scores?.consistency || 0);
              return `${VLQ_DOMAINS[key].name}: importance ${scores?.importance}/10, consistency ${scores?.consistency}/10${gap >= 3 ? ' (GROWTH AREA)' : ''}`;
            }).join('; ')
          : 'not assessed yet';

        // Check for misalignments between intentions and actual plans
        const getMisalignments = () => {
          if (!lifeAreasCompleted && !effectiveIsLast) return '';
          const ratingsToCheck = effectiveIsLast ? effectiveRatings : lifeAreaRatings;
          const misalignments = [];
          
          // High intention areas with low activity
          Object.entries(ratingsToCheck).forEach(([key, val]) => {
            if (val.intention >= 7) {
              const relatedHabits = weeklyHabits.filter(h => 
                h.text.toLowerCase().includes(key) || 
                (key === 'health' && /exercise|workout|gym|run|walk|yoga/i.test(h.text)) ||
                (key === 'relationships' && /date|partner|friend|family|call/i.test(h.text)) ||
                (key === 'fun' && /hobby|play|adventure|trip/i.test(h.text))
              );
              const relatedEvents = events.filter(e => e.lifeArea === key);
              
              if (relatedHabits.length === 0 && relatedEvents.length === 0) {
                misalignments.push(`${LIFE_AREAS[key].name} has high intention (${val.intention}) but no related habits or events`);
              }
            }
          });
          
          return misalignments.length > 0 
            ? `\n\nPotential misalignments to gently explore: ${misalignments.join('; ')}`
            : '';
        };

        return `You are Tend, a thoughtful AI companion for intentional living and life design. You help people design their year with intention ‚Äî not just survive, but live intentionally and mindfully.

Your personality:
- Warm, calm, and grounded ‚Äî like a wise friend
- You ask thoughtful questions rather than give prescriptive advice
- You're concise ‚Äî 2-4 sentences is often enough, occasionally more for important moments
- You use gentle emphasis with *italics* for key words (use asterisks for italics)
- You avoid bullet points in conversation ‚Äî speak naturally

Current context:
- The user is designing their 2026
- Current view: ${centerView}
- Current sidebar tab: ${activeTab}
- Current season: ${currentSeason}
- Their year theme: ${yearTheme || 'not set yet'}
- Their values: ${values.length > 0 ? values.join(', ') : 'not identified yet'}
- Life areas (from VLQ): ${lifeAreasContext}
- Their events: ${events.length > 0 ? events.map(e => `${MONTHS[e.month]}: ${e.title}`).join(', ') : 'none yet'}
- Weekly habits: ${weeklyHabits.length > 0 ? weeklyHabits.map(h => `${h.text} (${h.frequency}x/week)`).join(', ') : 'none yet'}
- Daily habits: ${dailyHabits.length > 0 ? dailyHabits.map(h => h.text).join(', ') : 'none yet'}
- Phase: ${phase} (explore = getting to know them, ground = understanding commitments, reveal = unlocking the app, plan = ongoing planning)
- Conversation length: ${messages.length} messages so far
${getMisalignments()}

The user has already completed the VLQ (Valued Living Questionnaire) assessment. You know their values - use this knowledge to personalize your guidance.

IMPORTANT - Theme Word Discovery Process (in EXPLORE phase):
1. DO NOT ask the user "what word do you want for your year" upfront
2. Instead, EXPLORE their VLQ results through conversation:
   - Ask about their growth areas (high importance, low consistency)
   - Ask what's been getting in the way
   - Ask what they wish was different
   - Ask what they want more of
3. After 4-6 exchanges of genuine conversation, SUGGEST a theme word based on what you've learned. Frame it like this:
   - Explain what a theme word is: "A theme word is like a compass ‚Äî one guiding word you can return to throughout the year to center yourself and make decisions."
   - Then suggest: "Based on what you've shared about [summarize key themes], I think your word might be *[word]*. It captures [specific reason tied to what they said]."
   - Ask: "Does that resonate? Feel free to try it on, adjust it, or suggest something else."
4. Let them accept, modify, or suggest alternatives
5. Once they accept a word, celebrate briefly then offer three paths forward:
   - "Now that you have your compass, here are some ways we could go deeper:"
   - **Seasons** ‚Äî "We could think about what you want each season to feel like"
   - **Events** ‚Äî "We could map out trips, milestones, or commitments for the year"  
   - **Rhythms** ‚Äî "We could establish weekly or daily habits that support your theme"
   - Ask: "What feels most alive for you right now?"

CURRENT VIEW: ${centerView.toUpperCase()}
${centerView === 'year' ? `
You're on the YEAR view. ${yearTheme ? `Their theme word is "${yearTheme}". If this is a returning user, offer the three paths (Seasons, Events, Rhythms) and ask what they want to explore. Help them see how their year could unfold around this theme.` : `Focus on discovering their theme word through conversation. Don't ask directly - explore their VLQ results and what they want from the year, then suggest a word.`}
` : ''}${centerView === 'seasons' ? `
You're on the SEASONS view. Help them think about what each season could feel like and hold for them. Ask about:
- What's already planned for each season?
- How do they want each season to feel?
- Are there natural rhythms they want to honor (rest in winter, growth in spring, adventure in summer, harvest in fall)?
` : ''}${centerView === 'monthly' ? `
You're on the MONTHLY view. Help them plan specific events and commitments. Ask about:
- What trips, events, or milestones are coming up?
- Are there months that feel too full or too empty?
- What needs to be scheduled to honor their values?
` : ''}${centerView === 'weekly' ? `
You're on the WEEKLY view. Help them establish weekly rhythms and recurring commitments. Ask about:
- What weekly habits would support their values? (exercise, date nights, creative time, rest)
- What's a realistic frequency for each?
- How can they protect time for what matters?
` : ''}${centerView === 'daily' ? `
You're on the DAILY view. Help them identify small daily habits that compound over time. Ask about:
- What tiny habits would make the biggest difference?
- What do they want their mornings or evenings to look like?
- What daily practice would support their theme word?
` : ''}
If they mention specific events, habits, or plans, acknowledge those and help them think through the details.
If they seem stuck, offer a gentle prompt or example.
If you notice a misalignment between their VLQ values (high importance areas) and their actual plans, gently bring it up.

Keep responses focused and conversational. You're not a productivity app ‚Äî you're helping them live with more intention.`;
      };

      // Call Claude API
      const callClaudeAPI = async (userMessage, pendingState = {}) => {
        if (!apiKey) {
          return "I'd love to help you plan, but I need an API key to think deeply. Click the ‚öô settings icon to add your Anthropic API key.";
        }

        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': apiKey,
              'anthropic-version': '2023-06-01',
              'anthropic-dangerous-direct-browser-access': 'true'
            },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 500,
              system: getTendSystemPrompt(pendingState),
              messages: [
                ...messages.map(m => ({
                  role: m.role === 'assistant' ? 'assistant' : 'user',
                  content: m.content.replace(/<[^>]*>/g, '') // Strip HTML for API
                })),
                { role: 'user', content: userMessage }
              ]
            })
          });

          if (!response.ok) {
            const error = await response.json();
            console.error('API Error:', error);
            if (response.status === 401) {
              return "That API key doesn't seem to be working. Check your key in settings (‚öô).";
            }
            return "Something went wrong connecting to Claude. Try again?";
          }

          const data = await response.json();
          return data.content[0].text;
        } catch (error) {
          console.error('Fetch error:', error);
          return "I couldn't connect to Claude. Check your internet connection and try again.";
        }
      };

      const handleSendMessage = async () => {
        if (!inputValue.trim()) return;
        
        const userMessage = inputValue.trim();
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setInputValue('');
        setIsTyping(true);
        setExchangeCount(prev => prev + 1);

        // Handle life areas mode - parse numbers
        let pendingLifeAreaUpdate = null;
        let pendingNextAreaIndex = currentLifeAreaIndex;
        let pendingWaitingForSatisfaction = waitingForSatisfaction;
        let pendingIsLastResponse = false;
        
        if (lifeAreasMode) {
          const numbers = userMessage.match(/\b([1-9]|10)\b/g);
          if (numbers && numbers.length > 0) {
            const score = parseInt(numbers[0]);
            const currentArea = lifeAreaOrder[currentLifeAreaIndex];
            
            if (waitingForSatisfaction) {
              pendingLifeAreaUpdate = { area: currentArea, field: 'satisfaction', score };
              setLifeAreaRatings(prev => ({
                ...prev,
                [currentArea]: { ...prev[currentArea], satisfaction: score }
              }));
              setWaitingForSatisfaction(false);
              pendingWaitingForSatisfaction = false;
            } else {
              pendingLifeAreaUpdate = { area: currentArea, field: 'intention', score };
              setLifeAreaRatings(prev => ({
                ...prev,
                [currentArea]: { ...prev[currentArea], intention: score }
              }));
              
              // Move to next area
              if (currentLifeAreaIndex < lifeAreaOrder.length - 1) {
                setCurrentLifeAreaIndex(prev => prev + 1);
                setWaitingForSatisfaction(true);
                pendingNextAreaIndex = currentLifeAreaIndex + 1;
                pendingWaitingForSatisfaction = true;
              } else {
                // This is the final area - flag for summary, then complete
                setIsLastLifeAreaResponse(true);
                pendingIsLastResponse = true;
              }
            }
          }
        }

        // Analyze for values/events even with API
        const detected = analyzeText(userMessage);
        processAnalysis(detected);
        
        // Parse events from message
        const foundEvents = parseEvents(userMessage);
        if (foundEvents.length > 0 && phase === PHASES.GROUND) {
          const newEvents = foundEvents.map((e, i) => ({
            id: Date.now() + i,
            title: `Event in ${MONTHS[e.month]}`,
            month: e.month,
            lifeArea: 'fun',
            details: { flights: '', stays: '', activities: '', notes: '' },
          }));
          setEvents(prev => [...prev, ...newEvents]);
        }

        // Check for theme word in early exchanges
        if (phase === PHASES.EXPLORE && exchangeCount < 3) {
          const words = userMessage.split(/\s+/).filter(w => w.length > 2 && w.length < 15);
          const potentialTheme = words.find(w => 
            /^[a-zA-Z]+$/.test(w) && 
            !['the', 'and', 'but', 'for', 'that', 'this', 'with', 'would', 'could', 'think', 'want', 'like', 'year', 'maybe', 'something'].includes(w.toLowerCase())
          );
          if (potentialTheme && words.length <= 5 && !yearTheme) {
            setYearTheme(potentialTheme.toLowerCase());
          }
        }

        // Progress phases based on exchange count
        if (phase === PHASES.EXPLORE && exchangeCount >= 2) {
          setPhase(PHASES.GROUND);
        }
        if (phase === PHASES.GROUND && exchangeCount >= 3 && !revealed) {
          setPhase(PHASES.REVEAL);
          setRevealed(true);
          // Start life areas mode - Claude will handle the transition naturally via system prompt
          if (!lifeAreasCompleted) {
            setLifeAreasMode(true);
          }
        }

        // Get response from Claude API
        const response = await callClaudeAPI(userMessage, {
          pendingLifeAreaUpdate,
          pendingNextAreaIndex,
          pendingWaitingForSatisfaction,
          pendingIsLastResponse
        });
        setMessages(prev => [...prev, { role: 'assistant', content: response }]);
        setIsTyping(false);
        
        // Complete life areas after the summary response
        if (isLastLifeAreaResponse || pendingIsLastResponse) {
          setLifeAreasCompleted(true);
          setLifeAreasMode(false);
          setIsLastLifeAreaResponse(false);
        }
      };

      const handleSkip = () => {
        setPhase(PHASES.PLAN);
        setRevealed(true);
        setMessages(prev => [...prev, {
          role: 'assistant',
          content: `No problem ‚Äî let's dive in.

Use the view switcher to explore your year. Add events, set season intentions, and plan the details.

I'm here to help with any planning.`
        }]);
      };

      const handleAddEvent = (eventData) => {
        setEvents(prev => [...prev, { 
          ...eventData, 
          id: Date.now(),
          details: { flights: '', stays: '', activities: '', notes: '' },
        }]);
        setShowEventModal(false);
      };

      const handleUpdateEventDetails = (eventId, field, value) => {
        setEvents(prev => prev.map(e => 
          e.id === eventId ? { ...e, details: { ...e.details, [field]: value } } : e
        ));
      };

      const handleAddGoal = (goalData) => {
        setGoals(prev => [...prev, { ...goalData, id: Date.now(), completed: false }]);
        setShowGoalModal(false);
      };

      const handleVlqComplete = () => {
        setVlqCompleted(true);
        // Pre-fill values based on high-importance domains
        const highImportance = VLQ_ORDER
          .filter(key => vlqScores[key]?.importance >= 7)
          .map(key => VLQ_DOMAINS[key].name.split(' ')[0]);
        if (highImportance.length > 0) {
          setValues(highImportance.slice(0, 3));
        }
      };

      // Mode selection screen
      const modeSelectionScreen = (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundColor: 'var(--bg-main)',
          padding: '2rem',
          fontFamily: "'DM Sans', sans-serif",
        }}>
          <svg width="48" height="48" viewBox="0 0 80 80" fill="none" style={{opacity: 0.7, marginBottom: '1.5rem'}}>
            <path d="M40 70 L40 45" stroke="var(--accent)" strokeWidth="2" strokeLinecap="round"/>
            <path d="M40 55 Q30 50 25 40 Q35 45 40 55" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <path d="M40 45 Q50 38 55 28 Q45 35 40 45" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <path d="M40 35 Q32 28 30 18 Q38 25 40 35" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <path d="M40 28 Q48 22 52 12 Q44 20 40 28" stroke="var(--accent)" strokeWidth="2" fill="none" strokeLinecap="round"/>
            <circle cx="40" cy="70" r="4" fill="none" stroke="var(--accent)" strokeWidth="2"/>
          </svg>
          
          <h2 style={{
            fontFamily: "'Fraunces', serif",
            fontSize: '1.5rem',
            color: 'var(--text)',
            marginBottom: '0.5rem',
            fontWeight: 400,
          }}>
            {yearTheme ? `Welcome back` : 'Welcome'}
          </h2>
          {yearTheme && (
            <p style={{
              color: 'var(--accent)',
              fontSize: '0.9rem',
              fontStyle: 'italic',
              marginBottom: '0.25rem',
            }}>
              Your word: {yearTheme}
            </p>
          )}
          <p style={{
            color: 'var(--text-muted)',
            fontSize: '0.95rem',
            marginBottom: '2rem',
          }}>
            What would you like to do today?
          </p>

          <div style={{
            display: 'flex',
            flexDirection: 'column',
            gap: '1rem',
            width: '100%',
            maxWidth: '320px',
          }}>
            <button
              onClick={() => setAppMode('journal')}
              style={{
                padding: '1.25rem 1.5rem',
                backgroundColor: 'var(--bg-card)',
                border: '1px solid var(--border)',
                borderRadius: '16px',
                cursor: 'pointer',
                textAlign: 'left',
                transition: 'all 0.2s',
              }}
            >
              <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                <span style={{fontSize: '1.5rem'}}>üìù</span>
                <div>
                  <div style={{fontWeight: 500, color: 'var(--text)', marginBottom: '0.25rem'}}>Switch to Journal Mode</div>
                  <div style={{fontSize: '0.8rem', color: 'var(--text-muted)'}}>Reflect on your day</div>
                </div>
              </div>
            </button>

            <button
              onClick={() => setAppMode('plan')}
              style={{
                padding: '1.25rem 1.5rem',
                backgroundColor: 'var(--bg-card)',
                border: '1px solid var(--border)',
                borderRadius: '16px',
                cursor: 'pointer',
                textAlign: 'left',
                transition: 'all 0.2s',
              }}
            >
              <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                <span style={{fontSize: '1.5rem'}}>üóìÔ∏è</span>
                <div>
                  <div style={{fontWeight: 500, color: 'var(--text)', marginBottom: '0.25rem'}}>Switch to Plan & Design Mode</div>
                  <div style={{fontSize: '0.8rem', color: 'var(--text-muted)'}}>Shape your year</div>
                </div>
              </div>
            </button>
          </div>
        </div>
      );

      // Show loading icon for minimum time
      if (showLoadingIcon || authLoading) {
        return loadingScreen;
      }

      // Show auth screen if not logged in
      if (!user) {
        return <AuthModal onSuccess={() => {}} />;
      }

      // Wait for user data to load from Firebase before deciding what to show
      if (!dataLoaded) {
        return loadingScreen;
      }

      // Show VLQ assessment first (new users)
      if (!vlqCompleted) {
        return (
          <VLQAssessment
            vlqScores={vlqScores}
            setVlqScores={setVlqScores}
            vlqStep={vlqStep}
            setVlqStep={setVlqStep}
            onComplete={handleVlqComplete}
          />
        );
      }

      // Show mode selection for all returning users who have completed VLQ
      if (appMode === null) {
        return modeSelectionScreen;
      }

      // Journal mode
      if (appMode === 'journal') {
        return (
          <DailyJournalView 
            yearTheme={yearTheme}
            vlqScores={vlqScores}
            journalEntries={journalEntries}
            setJournalEntries={setJournalEntries}
            onSwitchMode={() => setAppMode('plan')}
            onBack={() => setAppMode(null)}
          />
        );
      }

      return (
        <div style={styles.container}>
          <header style={styles.header}>
            <div style={styles.logoContainer}>
              <svg width="28" height="28" viewBox="0 0 32 32" fill="none" style={{ marginRight: '8px' }}>
                <path d="M16 26 Q16 18 16 14" stroke="var(--accent)" strokeWidth="2" strokeLinecap="round" fill="none"/>
                <path d="M16 18 Q10 16 8 10 Q14 12 16 18" fill="var(--accent)" opacity="0.5"/>
                <path d="M16 14 Q22 10 24 4 Q18 8 16 14" fill="var(--accent)"/>
                <path d="M16 10 Q14 6 16 2 Q18 6 16 10" fill="var(--accent)" opacity="0.7"/>
              </svg>
              <h1 style={styles.logoText}>tend</h1>
            </div>
            <p style={styles.tagline}>a space for designing your life with intention</p>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <button 
                style={{
                  ...styles.settingsButton,
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.375rem',
                  fontSize: '0.8rem',
                  padding: '0.375rem 0.75rem',
                  borderRadius: '8px',
                  backgroundColor: 'var(--bg-elevated)',
                  border: '1px solid var(--border)',
                }}
                onClick={() => setAppMode('journal')}
                title="Switch to Daily Journal"
              >
                üìù Switch to Journal
              </button>
              <button 
                style={styles.settingsButton} 
                onClick={() => setShowSettingsModal(true)}
                title="Settings"
              >
                ‚öô
              </button>
            </div>
          </header>

          <main style={{...styles.main, gridTemplateColumns: `${sidebarExpanded ? sidebarWidth : 64}px 1fr ${chatWidth}px`}}>
            {/* Left Sidebar */}
            <aside style={{
              ...styles.sidebar,
              width: sidebarExpanded ? sidebarWidth : 64,
              transition: sidebarExpanded ? 'none' : 'width 0.2s ease',
              position: 'relative'
            }}>
              {/* Resize handle when expanded */}
              {sidebarExpanded && (
                <div 
                  style={styles.sidebarResizeHandle}
                  onMouseDown={handleSidebarMouseDown}
                  title="Drag to resize"
                />
              )}
              
              <div style={styles.sidebarNav}>
                {[
                  { id: 'events', icon: 'üìÖ', label: 'Events' },
                  { id: 'notes', icon: 'üìù', label: 'Notes' },
                  { id: 'lifeareas', icon: 'üå±', label: 'Life Areas' }
                ].map(item => (
                  <button
                    key={item.id}
                    style={{
                      ...styles.sidebarNavItem,
                      ...(activeTab === item.id && sidebarExpanded && styles.sidebarNavItemActive),
                      backgroundColor: activeTab === item.id && sidebarExpanded ? 'var(--bg-elevated)' : 'transparent'
                    }}
                    onClick={() => {
                      if (activeTab === item.id && sidebarExpanded) {
                        setSidebarExpanded(false);
                      } else {
                        setActiveTab(item.id);
                        setSidebarExpanded(true);
                      }
                    }}
                    title={item.label}
                  >
                    <span style={styles.sidebarNavIcon}>{item.icon}</span>
                    <span style={{
                      ...styles.sidebarNavLabel,
                      opacity: sidebarExpanded ? 1 : 0,
                      width: sidebarExpanded ? 'auto' : 0
                    }}>{item.label}</span>
                  </button>
                ))}
              </div>

              {/* Tab content when expanded */}
              {sidebarExpanded && (
                <div style={styles.tabContent}>
                  {activeTab === 'events' && (
                    <EventsTab
                      events={events}
                      expandedEvent={expandedEvent}
                      setExpandedEvent={setExpandedEvent}
                      onUpdateDetails={handleUpdateEventDetails}
                      onDelete={(id) => setEvents(events.filter(e => e.id !== id))}
                      onAdd={() => setShowEventModal(true)}
                      revealed={revealed}
                    />
                  )}
                  {activeTab === 'notes' && (
                    <NotesTab notes={notes} setNotes={setNotes} revealed={revealed} />
                  )}
                  {activeTab === 'lifeareas' && (
                    <LifeAreasTab 
                      vlqScores={vlqScores}
                      goals={goals}
                      setGoals={setGoals}
                      onReassess={() => { setVlqStep(-1); setVlqCompleted(false); }}
                      onAddGoal={() => setShowGoalModal(true)}
                      revealed={revealed}
                    />
                  )}
                </div>
              )}
            </aside>

            <div style={styles.centerPanel}>
              <div style={styles.viewSwitcher}>
                {[
                  { id: CENTER_VIEWS.YEAR, label: 'Year' },
                  { id: CENTER_VIEWS.SEASONS, label: 'Seasons' },
                  { id: CENTER_VIEWS.MONTHLY, label: 'Monthly' },
                  { id: CENTER_VIEWS.WEEKLY, label: 'Weekly' },
                  { id: CENTER_VIEWS.DAILY, label: 'Daily' },
                ].map(view => (
                  <button
                    key={view.id}
                    style={{...styles.viewButton, ...(centerView === view.id && styles.viewButtonActive)}}
                    onClick={() => setCenterView(view.id)}
                  >
                    {view.label}
                  </button>
                ))}
              </div>

              {centerView === CENTER_VIEWS.YEAR && (
                <YearCircleView 
                  events={events}
                  revealed={revealed}
                  onAddEvent={() => setShowEventModal(true)}
                  yearTheme={yearTheme}
                  setYearTheme={setYearTheme}
                />
              )}
              {centerView === CENTER_VIEWS.SEASONS && (
                <SeasonsView 
                  seasonIntentions={seasonIntentions}
                  setSeasonIntentions={setSeasonIntentions}
                  revealed={revealed}
                />
              )}
              {centerView === CENTER_VIEWS.MONTHLY && (
                <MonthlyView 
                  events={events}
                  selectedMonth={selectedMonth}
                  setSelectedMonth={setSelectedMonth}
                  revealed={revealed}
                  onAddEvent={() => setShowEventModal(true)}
                />
              )}
              {centerView === CENTER_VIEWS.WEEKLY && (
                <WeeklyView 
                  weeklyHabits={weeklyHabits}
                  setWeeklyHabits={setWeeklyHabits}
                  revealed={revealed}
                />
              )}
              {centerView === CENTER_VIEWS.DAILY && (
                <DailyView 
                  dailyHabits={dailyHabits}
                  setDailyHabits={setDailyHabits}
                  revealed={revealed}
                />
              )}

              <div style={styles.bottomSection}>
                <div style={styles.vlqSummary}>
                  <div style={styles.vlqSummaryColumn}>
                    <span style={styles.vlqSummaryLabel}>üå± Focus on</span>
                    <div style={styles.vlqSummaryItems}>
                      {(() => {
                        const allAreas = VLQ_ORDER.map(key => ({
                          key, 
                          ...VLQ_DOMAINS[key], 
                          importance: vlqScores[key]?.importance || 5,
                          consistency: vlqScores[key]?.consistency || 5,
                          gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)
                        }));
                        // Strengths: high importance AND consistency is close to importance (gap < 2)
                        const strengthKeys = allAreas
                          .filter(a => a.importance >= 7 && a.consistency >= 6 && a.gap < 2)
                          .map(a => a.key);
                        // Growth: gap >= 2 AND not already a strength
                        return allAreas
                          .filter(a => a.gap >= 2 && !strengthKeys.includes(a.key))
                          .sort((a, b) => b.gap - a.gap)
                          .slice(0, 3)
                          .map(area => (
                            <span key={area.key} style={{...styles.vlqSummaryTag, borderColor: area.color, color: area.color}}>
                              {area.icon} {area.name.split(' ')[0]}
                            </span>
                          ));
                      })()}
                    </div>
                  </div>
                  <div style={styles.vlqSummaryColumn}>
                    <span style={styles.vlqSummaryLabel}>üí™ Thriving in</span>
                    <div style={styles.vlqSummaryItems}>
                      {VLQ_ORDER
                        .map(key => ({key, ...VLQ_DOMAINS[key], importance: vlqScores[key]?.importance || 5, consistency: vlqScores[key]?.consistency || 5, gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)}))
                        .filter(a => a.importance >= 7 && a.consistency >= 6 && a.gap < 2)
                        .slice(0, 3)
                        .map(area => (
                          <span key={area.key} style={{...styles.vlqSummaryTag, borderColor: area.color, color: area.color, opacity: 0.8}}>
                            {area.icon} {area.name.split(' ')[0]}
                          </span>
                        ))
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div style={styles.chatPanel}>
              <div 
                style={styles.resizeHandle} 
                onMouseDown={handleMouseDown}
                title="Drag to resize"
              />
              <div style={styles.chatMessages}>
                {messages.map((msg, idx) => (
                  <ChatMessage key={idx} message={msg} />
                ))}
                {isTyping && <TypingIndicator />}
                <div ref={messagesEndRef} />
              </div>
              
              <div style={styles.chatInputArea}>
                {!revealed && phase === PHASES.EXPLORE && (
                  <button style={styles.skipButton} onClick={handleSkip}>Skip to planning ‚Üí</button>
                )}
                <div style={styles.inputRow}>
                  <textarea
                    style={styles.chatInput}
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleSendMessage();
                      }
                    }}
                    placeholder="Say whatever comes to mind..."
                    rows={2}
                  />
                  <button 
                    style={{...styles.sendButton, ...(inputValue.trim() ? {} : styles.sendButtonDisabled)}}
                    onClick={handleSendMessage}
                    disabled={!inputValue.trim()}
                  >‚Üë</button>
                </div>
              </div>
            </div>
          </main>

          {showEventModal && <EventModal onClose={() => setShowEventModal(false)} onAdd={handleAddEvent} />}
          {showGoalModal && <GoalModal onClose={() => setShowGoalModal(false)} onAdd={handleAddGoal} />}
          {showSettingsModal && (
            <SettingsModal 
              apiKey={apiKey} 
              setApiKey={(key) => {
                setApiKey(key);
                localStorage.setItem('tend_api_key', key);
              }} 
              onClose={() => setShowSettingsModal(false)}
              user={user}
              onLogout={handleLogout}
            />
          )}
        </div>
      );
    }

    // ============ DAILY JOURNAL VIEW ============
    function DailyJournalView({ yearTheme, vlqScores, journalEntries, setJournalEntries, onSwitchMode, onBack }) {
      const today = new Date();
      const dateKey = today.toISOString().split('T')[0]; // e.g., "2026-01-19"
      const dateString = today.toLocaleDateString('en-US', { 
        weekday: 'long', 
        month: 'long', 
        day: 'numeric' 
      });

      // Load today's entry or create empty
      const todayEntry = journalEntries[dateKey] || { rating: null, gratitude: '', reflection: '' };

      // Update today's entry
      const updateEntry = (field, value) => {
        setJournalEntries(prev => ({
          ...prev,
          [dateKey]: {
            ...prev[dateKey],
            [field]: value
          }
        }));
      };

      // Get top growth area for prompt
      const topGrowthArea = VLQ_ORDER
        .map(key => ({
          key,
          name: VLQ_DOMAINS[key].name,
          gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)
        }))
        .sort((a, b) => b.gap - a.gap)[0];

      const journalStyles = {
        container: {
          minHeight: '100vh',
          backgroundColor: 'var(--bg-main)',
          display: 'flex',
          flexDirection: 'column',
        },
        header: {
          padding: '1rem 2rem',
          borderBottom: '1px solid var(--border)',
          backgroundColor: 'var(--bg-card)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
        },
        headerLeft: {
          display: 'flex',
          alignItems: 'center',
          gap: '1rem',
        },
        backButton: {
          background: 'none',
          border: 'none',
          fontSize: '1.25rem',
          color: 'var(--text-muted)',
          cursor: 'pointer',
          padding: '0.25rem',
        },
        title: {
          fontFamily: "'Fraunces', serif",
          fontSize: '1.25rem',
          color: 'var(--text)',
        },
        switchButton: {
          padding: '0.5rem 1rem',
          backgroundColor: 'var(--bg-elevated)',
          border: '1px solid var(--border)',
          borderRadius: '8px',
          color: 'var(--text-muted)',
          fontSize: '0.8rem',
          cursor: 'pointer',
          display: 'flex',
          alignItems: 'center',
          gap: '0.5rem',
        },
        content: {
          flex: 1,
          padding: '2rem',
          maxWidth: '600px',
          margin: '0 auto',
          width: '100%',
        },
        date: {
          color: 'var(--text-muted)',
          fontSize: '0.9rem',
          marginBottom: '0.5rem',
        },
        greeting: {
          fontFamily: "'Fraunces', serif",
          fontSize: '1.5rem',
          color: 'var(--text)',
          marginBottom: '2rem',
        },
        section: {
          marginBottom: '2rem',
        },
        sectionTitle: {
          fontSize: '0.75rem',
          fontWeight: 600,
          textTransform: 'uppercase',
          letterSpacing: '0.05em',
          color: 'var(--text-muted)',
          marginBottom: '0.75rem',
        },
        textarea: {
          width: '100%',
          padding: '1rem',
          backgroundColor: 'var(--bg-card)',
          border: '1px solid var(--border)',
          borderRadius: '12px',
          fontSize: '0.95rem',
          color: 'var(--text)',
          fontFamily: "'DM Sans', sans-serif",
          resize: 'none',
          lineHeight: 1.6,
          outline: 'none',
        },
        gratitudeInput: {
          width: '100%',
          padding: '0.75rem 1rem',
          backgroundColor: 'var(--bg-card)',
          border: '1px solid var(--border)',
          borderRadius: '10px',
          fontSize: '0.9rem',
          color: 'var(--text)',
          fontFamily: "'DM Sans', sans-serif",
          outline: 'none',
        },
        ratingContainer: {
          display: 'flex',
          gap: '0.5rem',
          justifyContent: 'center',
        },
        ratingButton: {
          width: '44px',
          height: '44px',
          borderRadius: '50%',
          border: '2px solid var(--border)',
          backgroundColor: 'var(--bg-card)',
          cursor: 'pointer',
          fontSize: '0.9rem',
          fontWeight: 500,
          color: 'var(--text-muted)',
          transition: 'all 0.2s',
        },
        ratingButtonActive: {
          borderColor: 'var(--accent)',
          backgroundColor: 'var(--accent)',
          color: 'white',
        },
        prompt: {
          padding: '1rem',
          backgroundColor: 'var(--accent-light)',
          borderRadius: '12px',
          fontSize: '0.9rem',
          color: 'var(--text)',
          fontStyle: 'italic',
          marginBottom: '0.75rem',
        },
      };

      return (
        <div style={journalStyles.container}>
          <header style={journalStyles.header}>
            <div style={journalStyles.headerLeft}>
              <button style={journalStyles.backButton} onClick={onBack} title="Back">
                ‚Üê
              </button>
              <h1 style={journalStyles.title}>Daily Journal</h1>
            </div>
            <button style={journalStyles.switchButton} onClick={onSwitchMode}>
              üóìÔ∏è Switch to Plan & Design
            </button>
          </header>

          <div style={journalStyles.content}>
            <p style={journalStyles.date}>{dateString}</p>
            <h2 style={journalStyles.greeting}>
              {yearTheme ? `How are you living into "${yearTheme}" today?` : 'How was your day?'}
            </h2>

            {/* Today's Rating */}
            <div style={journalStyles.section}>
              <h3 style={journalStyles.sectionTitle}>How do you feel about today?</h3>
              <div style={journalStyles.ratingContainer}>
                {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(num => (
                  <button
                    key={num}
                    style={{
                      ...journalStyles.ratingButton,
                      ...(todayEntry.rating === num && journalStyles.ratingButtonActive)
                    }}
                    onClick={() => updateEntry('rating', num)}
                  >
                    {num}
                  </button>
                ))}
              </div>
            </div>

            {/* Gratitude */}
            <div style={journalStyles.section}>
              <h3 style={journalStyles.sectionTitle}>One thing you're grateful for</h3>
              <input
                type="text"
                style={journalStyles.gratitudeInput}
                value={todayEntry.gratitude || ''}
                onChange={(e) => updateEntry('gratitude', e.target.value)}
                placeholder="What made today a little brighter?"
              />
            </div>

            {/* Free Write */}
            <div style={journalStyles.section}>
              <h3 style={journalStyles.sectionTitle}>Reflect</h3>
              {topGrowthArea && topGrowthArea.gap >= 2 && (
                <div style={journalStyles.prompt}>
                  üí≠ How did you show up for <strong>{topGrowthArea.name}</strong> today?
                </div>
              )}
              <textarea
                style={journalStyles.textarea}
                value={todayEntry.reflection || ''}
                onChange={(e) => updateEntry('reflection', e.target.value)}
                placeholder="What's on your mind? What happened today? What do you want to remember?"
                rows={8}
              />
            </div>
          </div>
        </div>
      );
    }

    // ============ YEAR CIRCLE VIEW ============
    function YearCircleView({ events, revealed, onAddEvent, yearTheme, setYearTheme }) {
      const size = 400;
      const center = size / 2;
      const outerRadius = 175;
      const innerRadius = 75;
      const monthRadius = 145;
      const currentMonth = new Date().getMonth();

      const getMonthPosition = (monthIndex) => {
        const angle = ((monthIndex - 2) / 12) * 2 * Math.PI - Math.PI / 2;
        return { x: center + Math.cos(angle) * monthRadius, y: center + Math.sin(angle) * monthRadius };
      };

      const getEventPosition = (monthIndex, eventIndex = 0) => {
        const angle = ((monthIndex - 2) / 12) * 2 * Math.PI - Math.PI / 2;
        const radius = innerRadius + 18 + (eventIndex * 12);
        return { x: center + Math.cos(angle) * radius, y: center + Math.sin(angle) * radius };
      };

      const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {
        const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
        return { x: centerX + radius * Math.cos(angleInRadians), y: centerY + radius * Math.sin(angleInRadians) };
      };

      const describeArc = (startAngle, endAngle, radius) => {
        const start = polarToCartesian(center, center, radius, endAngle);
        const end = polarToCartesian(center, center, radius, startAngle);
        const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
        return `M ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 0 ${end.x} ${end.y} L ${center} ${center} Z`;
      };

      const seasonArcs = [
        { id: 'winter', start: -60, end: 30, color: '#7EB3E0' },
        { id: 'spring', start: 30, end: 120, color: '#8FD4A0' },
        { id: 'summer', start: 120, end: 210, color: '#F9D07A' },
        { id: 'fall', start: 210, end: 300, color: '#E8A090' },
      ];

      return (
        <div style={styles.circleContainer}>
          <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
            {seasonArcs.map(season => (
              <path key={season.id} d={describeArc(season.start, season.end, outerRadius)} fill={season.color} opacity={0.35} />
            ))}

            <circle cx={center} cy={center} r={innerRadius} fill="var(--bg-card)" stroke="var(--border)" strokeWidth="1" />

            <text x={center} y={center - 12} textAnchor="middle" dominantBaseline="middle" fill="var(--text)"
              style={{ fontFamily: "'Fraunces', serif", fontSize: '1.75rem' }}>
              2026
            </text>

            {/* Theme word - only show if set */}
            {yearTheme && (
              <text x={center} y={center + 18} textAnchor="middle" dominantBaseline="middle" 
                fill="var(--accent)"
                style={{ fontFamily: "'Fraunces', serif", fontSize: '0.95rem', fontStyle: 'italic', cursor: 'pointer' }}
                onClick={() => {
                  const newTheme = prompt('Edit your theme word:', yearTheme);
                  if (newTheme !== null) setYearTheme(newTheme.toLowerCase());
                }}>
                {yearTheme}
              </text>
            )}

            {MONTHS.map((month, idx) => {
              const pos = getMonthPosition(idx);
              const isCurrent = idx === currentMonth;
              return (
                <g key={month}>
                  <text x={pos.x} y={pos.y} textAnchor="middle" dominantBaseline="middle"
                    fill={isCurrent ? 'var(--text)' : 'var(--text-light)'}
                    style={{ fontFamily: "'DM Sans', sans-serif", fontSize: '0.7rem', fontWeight: isCurrent ? 600 : 400 }}>
                    {month}
                  </text>
                  {isCurrent && <circle cx={pos.x} cy={pos.y + 10} r="2" fill="var(--accent)" />}
                </g>
              );
            })}

            {events.map((event) => {
              const monthEvents = events.filter(e => e.month === event.month);
              const eventIndex = monthEvents.indexOf(event);
              const pos = getEventPosition(event.month, eventIndex);
              const color = LIFE_AREAS[event.lifeArea]?.color || 'var(--accent)';
              return (
                <g key={event.id} className="fade-in">
                  <circle cx={pos.x} cy={pos.y} r="6" fill={color} />
                  <circle cx={pos.x} cy={pos.y} r="2.5" fill="white" opacity="0.5" />
                </g>
              );
            })}
          </svg>
        </div>
      );
    }

    // ============ SEASONS VIEW ============
    function SeasonsView({ seasonIntentions, setSeasonIntentions, revealed }) {
      const seasons = [
        { 
          id: 'winter', 
          name: 'Winter', 
          months: 'Dec ‚Äì Feb', 
          color: '#7EB3E0', 
          lightColor: '#F5F9FC', 
          elements: ['‚ùÑ', '¬∑', '‚ùÑ', '¬∑', '‚ùÑ'],
          description: 'A time for rest, reflection, and turning inward. Shorter days invite quiet planning, cozy routines, and nurturing what matters most.'
        },
        { 
          id: 'spring', 
          name: 'Spring', 
          months: 'Mar ‚Äì May', 
          color: '#8FD4A0', 
          lightColor: '#F5FBF6', 
          elements: ['‚úø', '¬∑', '‚ùÄ', '¬∑', '‚úø'],
          description: 'A time for new beginnings and fresh energy. Nature awakens ‚Äî a good season to plant seeds, start projects, and embrace growth.'
        },
        { 
          id: 'summer', 
          name: 'Summer', 
          months: 'Jun ‚Äì Aug', 
          color: '#F9D07A', 
          lightColor: '#FFFDF7', 
          elements: ['‚òÄ', '~', '‚òÄ', '~', '‚òÄ'],
          description: 'A time for expansion, adventure, and connection. Long days invite travel, outdoor activities, and making memories with others.'
        },
        { 
          id: 'fall', 
          name: 'Fall', 
          months: 'Sep ‚Äì Nov', 
          color: '#E8A090', 
          lightColor: '#FDF7F5', 
          elements: ['üçÇ', '¬∑', 'üçÅ', '¬∑', 'üçÇ'],
          description: 'A time for harvest and gratitude. Energy turns toward completion, gathering, and preparing for the quieter months ahead.'
        },
      ];

      const currentSeason = (() => {
        const month = new Date().getMonth();
        if ([11, 0, 1].includes(month)) return 'winter';
        if ([2, 3, 4].includes(month)) return 'spring';
        if ([5, 6, 7].includes(month)) return 'summer';
        return 'fall';
      })();

      return (
        <div style={styles.seasonsContainer}>
          <div style={styles.seasonsGrid}>
            {seasons.map(season => (
              <div 
                key={season.id} 
                style={{
                  ...styles.seasonCard,
                  backgroundColor: season.lightColor,
                  borderColor: season.id === currentSeason ? season.color : 'transparent',
                  borderWidth: '2px',
                }}
              >
                {/* Decorative top */}
                <div style={{...styles.seasonDecorative, color: season.color}}>
                  {season.elements.map((el, i) => (
                    <span key={i} style={{opacity: i % 2 === 0 ? 1 : 0.5}}>{el}</span>
                  ))}
                </div>

                <div style={styles.seasonCardContent}>
                  <div style={styles.seasonCardHeader}>
                    <h3 style={{...styles.seasonName, color: season.color}}>{season.name}</h3>
                    <span style={styles.seasonMonths}>{season.months}</span>
                    {season.id === currentSeason && (
                      <span style={{...styles.currentBadge, backgroundColor: `${season.color}90`}}>Now</span>
                    )}
                  </div>
                  
                  <p style={styles.seasonDescription}>{season.description}</p>
                  
                  <div style={styles.seasonIntentionBox}>
                    <label style={{...styles.seasonLabel, color: season.color}}>What do you envision for this season?</label>
                    <textarea
                      style={{
                        ...styles.seasonTextarea,
                        borderColor: revealed ? season.color : 'var(--border)',
                        opacity: revealed ? 1 : 0.6,
                      }}
                      value={seasonIntentions[season.id] || ''}
                      onChange={(e) => setSeasonIntentions({...seasonIntentions, [season.id]: e.target.value})}
                      placeholder={revealed ? 'Your intention for this season...' : 'Complete conversation to unlock'}
                      disabled={!revealed}
                      rows={2}
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ============ MONTHLY VIEW ============
    function MonthlyView({ events, selectedMonth, setSelectedMonth, revealed, onAddEvent }) {
      const year = 2026;
      const daysInMonth = new Date(year, selectedMonth + 1, 0).getDate();
      const firstDayOfMonth = new Date(year, selectedMonth, 1).getDay();
      const monthEvents = events.filter(e => e.month === selectedMonth);
      const currentMonth = new Date().getMonth();
      const today = new Date().getDate();

      const getSeasonColor = (monthIdx) => {
        if ([11, 0, 1].includes(monthIdx)) return '#7EB3E0';
        if ([2, 3, 4].includes(monthIdx)) return '#8FD4A0';
        if ([5, 6, 7].includes(monthIdx)) return '#F9D07A';
        return '#E8A090';
      };

      const seasonColor = getSeasonColor(selectedMonth);

      return (
        <div style={styles.monthlyContainer}>
          {/* Month selector strip */}
          <div style={styles.monthStrip}>
            {MONTHS.map((month, idx) => (
              <button
                key={idx}
                style={{
                  ...styles.monthStripButton,
                  backgroundColor: selectedMonth === idx ? `${getSeasonColor(idx)}40` : 'transparent',
                  color: selectedMonth === idx ? getSeasonColor(idx) : 'var(--text-muted)',
                  fontWeight: selectedMonth === idx ? 600 : 400,
                }}
                onClick={() => setSelectedMonth(idx)}
              >
                {month}
              </button>
            ))}
          </div>

          {/* Calendar */}
          <div style={{...styles.calendarWrapper, borderColor: seasonColor}}>
            <div style={{...styles.calendarHeader, backgroundColor: `${seasonColor}90`}}>
              <button style={styles.calendarNav} onClick={() => setSelectedMonth(selectedMonth === 0 ? 11 : selectedMonth - 1)}>‚Äπ</button>
              <h2 style={styles.calendarTitle}>{MONTH_FULL[selectedMonth]} 2026</h2>
              <button style={styles.calendarNav} onClick={() => setSelectedMonth(selectedMonth === 11 ? 0 : selectedMonth + 1)}>‚Ä∫</button>
            </div>

            <div style={styles.calendarBody}>
              <div style={styles.calendarGrid}>
                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, i) => (
                  <div key={i} style={styles.calendarDayHeader}>{day}</div>
                ))}
                {Array.from({ length: firstDayOfMonth }, (_, i) => (
                  <div key={`empty-${i}`} style={styles.calendarDayEmpty}></div>
                ))}
                {Array.from({ length: daysInMonth }, (_, i) => {
                  const day = i + 1;
                  const isToday = selectedMonth === currentMonth && day === today;
                  return (
                    <div key={day} style={{
                      ...styles.calendarDay, 
                      ...(isToday && {...styles.calendarDayToday, backgroundColor: `${seasonColor}70`})
                    }}>
                      {day}
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Events for this month */}
          <div style={styles.monthEventsSection}>
            {monthEvents.length > 0 ? (
              <div style={styles.monthEventsList}>
                {monthEvents.map(event => (
                  <div key={event.id} style={styles.monthEventItem}>
                    <span style={{...styles.eventDot, backgroundColor: LIFE_AREAS[event.lifeArea]?.color}}></span>
                    <span>{event.title}</span>
                  </div>
                ))}
              </div>
            ) : (
              <p style={styles.noEventsText}>No events in {MONTH_FULL[selectedMonth]}</p>
            )}
            {revealed && <button style={{...styles.addEventSmall, borderColor: seasonColor, color: seasonColor}} onClick={onAddEvent}>+ Add Event</button>}
          </div>
        </div>
      );
    }

    // ============ WEEKLY VIEW ============
    function WeeklyView({ weeklyHabits, setWeeklyHabits, revealed }) {
      const [newHabit, setNewHabit] = useState('');
      const [newFrequency, setNewFrequency] = useState(3);

      const addHabit = () => {
        if (!newHabit.trim()) return;
        setWeeklyHabits([...weeklyHabits, {
          id: Date.now(),
          text: newHabit,
          frequency: newFrequency,
          color: ['#7EB3E0', '#8FD4A0', '#F9D07A', '#E8A090', '#B8A9C9'][weeklyHabits.length % 5]
        }]);
        setNewHabit('');
        setNewFrequency(3);
      };

      const daysOfWeek = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];

      return (
        <div style={styles.weeklyContainer}>
          <div style={styles.weeklyHeader}>
            <h2 style={styles.weeklyTitle}>Weekly Rhythms</h2>
            <p style={styles.weeklySubtitle}>What do you want to do each week?</p>
          </div>

          {weeklyHabits.length > 0 ? (
            <div style={styles.weeklyHabitsList}>
              {weeklyHabits.map(habit => (
                <div key={habit.id} style={styles.weeklyHabitRow}>
                  <div style={styles.weeklyHabitInfo}>
                    <span style={{...styles.weeklyHabitDot, backgroundColor: habit.color}}></span>
                    <span style={styles.weeklyHabitText}>{habit.text}</span>
                    <span style={styles.weeklyHabitFreq}>{habit.frequency}x/week</span>
                    <button 
                      style={styles.weeklyHabitDelete}
                      onClick={() => setWeeklyHabits(weeklyHabits.filter(h => h.id !== habit.id))}
                    >√ó</button>
                  </div>
                  <div style={styles.weeklyHabitDays}>
                    {daysOfWeek.map((day, i) => (
                      <div 
                        key={i} 
                        style={{
                          ...styles.weeklyDayCircle,
                          backgroundColor: i < habit.frequency ? `${habit.color}30` : 'transparent',
                          borderColor: i < habit.frequency ? habit.color : 'var(--border)',
                        }}
                      >
                        <span style={{ fontSize: '0.65rem', color: i < habit.frequency ? habit.color : 'var(--text-muted)' }}>{day}</span>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div style={styles.weeklyEmpty}>
              <p style={styles.weeklyEmptyText}>No weekly habits yet.</p>
              <p style={{...styles.weeklyEmptyText, fontStyle: 'normal', color: 'var(--text-light)'}}>What rhythm do you want to create?</p>
            </div>
          )}

          {revealed ? (
            <div style={styles.addHabitSection}>
              <input
                type="text"
                value={newHabit}
                onChange={(e) => setNewHabit(e.target.value)}
                placeholder="Exercise, read, date night..."
                style={styles.addHabitInput}
                onKeyDown={(e) => e.key === 'Enter' && addHabit()}
              />
              <select 
                value={newFrequency} 
                onChange={(e) => setNewFrequency(parseInt(e.target.value))}
                style={styles.addHabitSelect}
              >
                {[1,2,3,4,5,6,7].map(n => (
                  <option key={n} value={n}>{n}x/week</option>
                ))}
              </select>
              <button onClick={addHabit} style={styles.addHabitButton}>+ Add</button>
            </div>
          ) : (
            <p style={styles.lockedText}>Complete the conversation to add weekly habits</p>
          )}
        </div>
      );
    }

    // ============ DAILY VIEW ============
    function DailyView({ dailyHabits, setDailyHabits, revealed }) {
      const [newHabit, setNewHabit] = useState('');

      const addHabit = () => {
        if (!newHabit.trim()) return;
        setDailyHabits([...dailyHabits, {
          id: Date.now(),
          text: newHabit,
          color: ['#7EB3E0', '#8FD4A0', '#F9D07A', '#E8A090', '#B8A9C9'][dailyHabits.length % 5]
        }]);
        setNewHabit('');
      };

      return (
        <div style={styles.dailyContainer}>
          <div style={styles.dailyHeader}>
            <h2 style={styles.dailyTitle}>Daily Intentions</h2>
            <p style={styles.dailySubtitle}>Small things that add up to a life well-lived</p>
          </div>

          {dailyHabits.length > 0 ? (
            <div style={styles.dailyList}>
              {dailyHabits.map(habit => (
                <div key={habit.id} style={styles.dailyHabitCard}>
                  <div style={{...styles.dailyHabitAccent, backgroundColor: habit.color}}></div>
                  <div style={styles.dailyHabitContent}>
                    <span style={styles.dailyHabitText}>{habit.text}</span>
                    <span style={styles.dailyHabitLabel}>every day</span>
                  </div>
                  <button 
                    style={styles.dailyHabitDelete}
                    onClick={() => setDailyHabits(dailyHabits.filter(h => h.id !== habit.id))}
                  >√ó</button>
                </div>
              ))}
            </div>
          ) : (
            <div style={styles.dailyEmpty}>
              <p style={styles.dailyEmptyText}>What small daily practices would change your life?</p>
              <p style={styles.dailyEmptyExamples}>
                <em>10k steps ¬∑ Morning pages ¬∑ 8 glasses of water ¬∑ Gratitude ¬∑ Phone-free meals</em>
              </p>
            </div>
          )}

          {revealed ? (
            <div style={styles.addDailySection}>
              <input
                type="text"
                value={newHabit}
                onChange={(e) => setNewHabit(e.target.value)}
                placeholder="Walk 10k steps, drink water, journal..."
                style={styles.addDailyInput}
                onKeyDown={(e) => e.key === 'Enter' && addHabit()}
              />
              <button onClick={addHabit} style={styles.addDailyButton}>+ Add Daily Habit</button>
            </div>
          ) : (
            <p style={styles.lockedText}>Complete the conversation to add daily habits</p>
          )}
        </div>
      );
    }

    // ============ EVENTS TAB ============
    function EventsTab({ events, expandedEvent, setExpandedEvent, onUpdateDetails, onDelete, onAdd, revealed }) {
      if (!revealed) {
        return <div style={styles.tabPlaceholder}><p style={styles.placeholderText}>Your events will appear here.</p></div>;
      }

      return (
        <div style={styles.eventsTab}>
          <button style={styles.addItemButton} onClick={onAdd}>+ Add Event</button>
          
          {events.length === 0 ? (
            <p style={styles.emptyText}>No events yet.</p>
          ) : (
            <div style={styles.eventsList}>
              {events.map(event => (
                <div key={event.id} style={styles.eventCard}>
                  <div style={styles.eventHeader} onClick={() => setExpandedEvent(expandedEvent === event.id ? null : event.id)}>
                    <div style={styles.eventHeaderLeft}>
                      <span style={{...styles.eventDot, backgroundColor: LIFE_AREAS[event.lifeArea]?.color}}></span>
                      <span style={styles.eventMonth}>{MONTHS[event.month]}</span>
                      <span style={styles.eventTitle}>{event.title}</span>
                    </div>
                    <span style={styles.expandIcon}>{expandedEvent === event.id ? '‚àí' : '+'}</span>
                  </div>
                  
                  {expandedEvent === event.id && (
                    <div style={styles.eventDetails} className="slide-in">
                      {['flights', 'stays', 'activities', 'notes'].map(field => (
                        <div key={field} style={styles.detailField}>
                          <label style={styles.detailLabel}>
                            {field === 'flights' ? '‚úà' : field === 'stays' ? 'üè†' : field === 'activities' ? '‚≠ê' : 'üìù'} {field.charAt(0).toUpperCase() + field.slice(1)}
                          </label>
                          <textarea
                            style={styles.detailInput}
                            value={event.details?.[field] || ''}
                            onChange={(e) => onUpdateDetails(event.id, field, e.target.value)}
                            placeholder={`Add ${field}...`}
                            rows={2}
                          />
                        </div>
                      ))}
                      <button style={styles.deleteEventButton} onClick={() => onDelete(event.id)}>Delete</button>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
          
          <p style={styles.tipText}>üí° Ask AI to suggest activities</p>
        </div>
      );
    }

    function NotesTab({ notes, setNotes, revealed }) {
      if (!revealed) {
        return <div style={styles.tabPlaceholder}><p style={styles.placeholderText}>A scratchpad for planning ideas.</p></div>;
      }
      return (
        <div style={styles.notesTab}>
          <textarea style={styles.notesTextarea} value={notes} onChange={(e) => setNotes(e.target.value)} placeholder="Jot down future plans, trip ideas, things to remember..." />
        </div>
      );
    }

    function GoalsTab({ goals, setGoals, onAdd, revealed }) {
      if (!revealed) {
        return <div style={styles.tabPlaceholder}><p style={styles.placeholderText}>Your goals will live here.</p></div>;
      }

      return (
        <div style={styles.goalsTab}>
          <button style={styles.addItemButton} onClick={onAdd}>+ Add Goal</button>
          {goals.length === 0 ? (
            <p style={styles.emptyText}>No goals yet.</p>
          ) : (
            <div style={styles.goalsList}>
              {goals.map(goal => (
                <div key={goal.id} style={{...styles.goalCard, opacity: goal.completed ? 0.6 : 1}}>
                  <button
                    style={{...styles.goalCheck, backgroundColor: goal.completed ? 'var(--accent)' : 'transparent'}}
                    onClick={() => setGoals(goals.map(g => g.id === goal.id ? {...g, completed: !g.completed} : g))}
                  >{goal.completed && '‚úì'}</button>
                  <span style={{...styles.goalText, textDecoration: goal.completed ? 'line-through' : 'none'}}>{goal.text}</span>
                  <button style={styles.goalDelete} onClick={() => setGoals(goals.filter(g => g.id !== goal.id))}>√ó</button>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    function LifeAreasTab({ vlqScores, goals, setGoals, onReassess, onAddGoal, revealed }) {
      // Calculate growth areas and strengths from VLQ
      const sortedAreas = VLQ_ORDER.map(key => ({
        key,
        ...VLQ_DOMAINS[key],
        importance: vlqScores[key]?.importance || 5,
        consistency: vlqScores[key]?.consistency || 5,
        gap: (vlqScores[key]?.importance || 5) - (vlqScores[key]?.consistency || 5)
      })).sort((a, b) => b.gap - a.gap);

      const growthAreas = sortedAreas.filter(a => a.gap >= 2);
      const strengths = sortedAreas.filter(a => a.importance >= 7 && a.consistency >= 6);

      return (
        <div style={{padding: '1rem', display: 'flex', flexDirection: 'column', gap: '1.25rem', height: '100%', overflowY: 'auto'}}>
          {/* Growth Areas */}
          <div>
            <h3 style={{fontSize: '0.7rem', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '0.05em', color: 'var(--text-muted)', marginBottom: '0.625rem'}}>
              üå± Growth Areas
            </h3>
            {growthAreas.length > 0 ? growthAreas.slice(0, 4).map(area => (
              <div key={area.key} style={{
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem',
                padding: '0.5rem 0.625rem',
                backgroundColor: 'var(--bg-elevated)',
                borderRadius: '8px',
                marginBottom: '0.375rem',
                borderLeft: `3px solid ${area.color}`
              }}>
                <span style={{fontSize: '0.9rem'}}>{area.icon}</span>
                <span style={{flex: 1, fontSize: '0.8rem', color: 'var(--text)'}}>{area.name.split(' ')[0]}</span>
                <span style={{fontSize: '0.7rem', color: 'var(--text-muted)'}}>{area.consistency}‚Üí{area.importance}</span>
              </div>
            )) : (
              <p style={{fontSize: '0.75rem', color: 'var(--text-muted)', fontStyle: 'italic'}}>
                You're well-aligned across areas!
              </p>
            )}
          </div>

          {/* Strengths */}
          <div>
            <h3 style={{fontSize: '0.7rem', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '0.05em', color: 'var(--text-muted)', marginBottom: '0.625rem'}}>
              üí™ Strengths
            </h3>
            {strengths.length > 0 ? strengths.slice(0, 3).map(area => (
              <div key={area.key} style={{
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem',
                padding: '0.5rem 0.625rem',
                backgroundColor: 'var(--bg-elevated)',
                borderRadius: '8px',
                marginBottom: '0.375rem',
                opacity: 0.85
              }}>
                <span style={{fontSize: '0.9rem'}}>{area.icon}</span>
                <span style={{flex: 1, fontSize: '0.8rem', color: 'var(--text)'}}>{area.name.split(' ')[0]}</span>
                <span style={{fontSize: '0.7rem', color: area.color}}>‚úì</span>
              </div>
            )) : (
              <p style={{fontSize: '0.75rem', color: 'var(--text-muted)', fontStyle: 'italic'}}>
                Keep building!
              </p>
            )}
          </div>

          {/* Goals */}
          <div style={{flex: 1}}>
            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.625rem'}}>
              <h3 style={{fontSize: '0.7rem', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '0.05em', color: 'var(--text-muted)'}}>
                üéØ Goals
              </h3>
              {revealed && <button style={{
                padding: '0.25rem 0.5rem',
                backgroundColor: 'var(--bg-elevated)',
                border: '1px solid var(--border)',
                borderRadius: '6px',
                color: 'var(--text-muted)',
                fontSize: '0.7rem',
                cursor: 'pointer'
              }} onClick={onAddGoal}>+ Add</button>}
            </div>
            {goals.length === 0 ? (
              <p style={{fontSize: '0.75rem', color: 'var(--text-muted)', fontStyle: 'italic'}}>
                No goals yet ‚Äî chat about what you want to achieve
              </p>
            ) : (
              <div style={{display: 'flex', flexDirection: 'column', gap: '0.375rem'}}>
                {goals.map(goal => (
                  <div key={goal.id} style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem',
                    padding: '0.5rem 0.625rem',
                    backgroundColor: 'var(--bg-elevated)',
                    borderRadius: '8px',
                    opacity: goal.completed ? 0.5 : 1
                  }}>
                    <input
                      type="checkbox"
                      checked={goal.completed}
                      onChange={() => setGoals(goals.map(g => g.id === goal.id ? {...g, completed: !g.completed} : g))}
                      style={{margin: 0, cursor: 'pointer', accentColor: 'var(--accent)'}}
                    />
                    <span style={{
                      fontSize: '0.8rem',
                      textDecoration: goal.completed ? 'line-through' : 'none',
                      flex: 1,
                      color: 'var(--text)'
                    }}>{goal.text}</span>
                    <button 
                      style={{background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '0.8rem'}}
                      onClick={() => setGoals(goals.filter(g => g.id !== goal.id))}
                    >√ó</button>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Reassess Button */}
          <button 
            style={{
              padding: '0.625rem',
              backgroundColor: 'transparent',
              border: '1px dashed var(--border)',
              borderRadius: '8px',
              color: 'var(--text-muted)',
              fontSize: '0.75rem',
              cursor: 'pointer',
              marginTop: 'auto'
            }}
            onClick={onReassess}
          >
            Reassess My Values
          </button>
        </div>
      );
    }

    function ChatMessage({ message }) {
      const isAssistant = message.role === 'assistant';
      return (
        <div style={{...styles.chatMessage, justifyContent: isAssistant ? 'flex-start' : 'flex-end'}} className="fade-in">
          {isAssistant && <div style={styles.chatAvatar}><span style={styles.chatAvatarText}>T</span></div>}
          <div style={{...styles.chatBubble, ...(isAssistant ? styles.chatBubbleAssistant : styles.chatBubbleUser)}}>
            <div dangerouslySetInnerHTML={{ __html: message.content.replace(/\n/g, '<br/>') }} />
          </div>
        </div>
      );
    }

    function TypingIndicator() {
      return (
        <div style={styles.chatMessage} className="fade-in">
          <div style={styles.chatAvatar}><span style={styles.chatAvatarText}>T</span></div>
          <div style={styles.typingBubble}>
            <span style={{...styles.typingDot, animationDelay: '0s'}}>‚Ä¢</span>
            <span style={{...styles.typingDot, animationDelay: '0.15s'}}>‚Ä¢</span>
            <span style={{...styles.typingDot, animationDelay: '0.3s'}}>‚Ä¢</span>
          </div>
        </div>
      );
    }

    function EventModal({ onClose, onAdd }) {
      const [title, setTitle] = useState('');
      const [month, setMonth] = useState(new Date().getMonth());
      const [lifeArea, setLifeArea] = useState('fun');

      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={styles.modal} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Add an event</h3>
              <button style={styles.modalClose} onClick={onClose}>√ó</button>
            </div>
            <form onSubmit={(e) => { e.preventDefault(); if (title) onAdd({ title, month, lifeArea }); }} style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>What is it?</label>
                <input type="text" style={styles.textInput} value={title} onChange={(e) => setTitle(e.target.value)} placeholder="Trip, birthday, deadline..." autoFocus />
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>When?</label>
                <select style={styles.selectInput} value={month} onChange={(e) => setMonth(parseInt(e.target.value))}>
                  {MONTHS.map((m, i) => <option key={i} value={i}>{m} 2026</option>)}
                </select>
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>Life Area</label>
                <select style={styles.selectInput} value={lifeArea} onChange={(e) => setLifeArea(e.target.value)}>
                  {Object.entries(LIFE_AREAS).map(([key, area]) => (
                    <option key={key} value={key}>{area.icon} {area.name}</option>
                  ))}
                </select>
              </div>
              <button type="submit" style={{...styles.submitButton, ...(!title ? styles.submitButtonDisabled : {})}} disabled={!title}>Add to year</button>
            </form>
          </div>
        </div>
      );
    }

    function GoalModal({ onClose, onAdd }) {
      const [text, setText] = useState('');
      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={styles.modal} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Add a goal</h3>
              <button style={styles.modalClose} onClick={onClose}>√ó</button>
            </div>
            <form onSubmit={(e) => { e.preventDefault(); if (text) onAdd({ text }); }} style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>What do you want to achieve?</label>
                <input type="text" style={styles.textInput} value={text} onChange={(e) => setText(e.target.value)} placeholder="Run a 5K, read 12 books..." autoFocus />
              </div>
              <button type="submit" style={{...styles.submitButton, ...(!text ? styles.submitButtonDisabled : {})}} disabled={!text}>Add goal</button>
            </form>
          </div>
        </div>
      );
    }

    function SettingsModal({ apiKey, setApiKey, onClose, user, onLogout }) {
      const [key, setKey] = useState(apiKey);
      
      const handleSave = () => {
        setApiKey(key);
        onClose();
      };

      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={{...styles.modal, maxWidth: '420px'}} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Settings</h3>
              <button style={styles.modalClose} onClick={onClose}>√ó</button>
            </div>
            <div style={styles.modalForm}>
              {/* Account Section */}
              <div style={{...styles.formField, marginBottom: '1.5rem', paddingBottom: '1.5rem', borderBottom: '1px solid var(--border)'}}>
                <label style={styles.formLabel}>Account</label>
                <p style={{fontSize: '0.9rem', color: 'var(--text)', marginBottom: '0.75rem'}}>
                  {user?.email}
                </p>
                <button 
                  onClick={() => { onLogout(); onClose(); }} 
                  style={{
                    padding: '0.5rem 1rem',
                    backgroundColor: 'transparent',
                    border: '1px solid var(--border)',
                    borderRadius: '8px',
                    color: 'var(--text-muted)',
                    fontSize: '0.8rem',
                    cursor: 'pointer',
                  }}
                >
                  Sign Out
                </button>
              </div>

              {/* API Key Section */}
              <div style={styles.formField}>
                <label style={styles.formLabel}>Anthropic API Key</label>
                <input 
                  type="password" 
                  style={styles.textInput} 
                  value={key} 
                  onChange={(e) => setKey(e.target.value)} 
                  placeholder="sk-ant-..." 
                  autoFocus 
                />
                <p style={styles.settingsHint}>
                  Your key is stored locally in your browser only. Get one at{' '}
                  <a href="https://console.anthropic.com/api-keys" target="_blank" rel="noopener noreferrer" style={styles.settingsLink}>
                    console.anthropic.com
                  </a>
                </p>
              </div>
              <button onClick={handleSave} style={styles.submitButton}>Save</button>
              {apiKey && (
                <p style={styles.settingsStatus}>‚úì API key is set</p>
              )}
            </div>
          </div>
        </div>
      );
    }

    const styles = {
      container: { height: '100vh', maxHeight: '100vh', display: 'flex', flexDirection: 'column', backgroundColor: 'var(--bg-main)', overflow: 'hidden' },
      header: { padding: '0.875rem 2rem', borderBottom: '1px solid var(--border)', backgroundColor: 'var(--bg-card)', display: 'flex', alignItems: 'baseline', gap: '1rem' },
      logoContainer: { display: 'flex', alignItems: 'center' },
      logoText: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", fontWeight: 400, color: 'var(--text)' },
      tagline: { fontSize: '0.85rem', color: 'var(--text-muted)', fontStyle: 'italic', flex: 1 },
      settingsButton: { background: 'none', border: 'none', fontSize: '1.25rem', color: 'var(--text-muted)', cursor: 'pointer', padding: '0.25rem', opacity: 0.7, transition: 'opacity 0.2s' },

      main: { display: 'grid', gridTemplateColumns: '64px 1fr 320px', flex: 1, height: 'calc(100vh - 56px)', overflow: 'hidden' },

      sidebar: { backgroundColor: 'var(--bg-card)', borderRight: '1px solid var(--border)', display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden' },
      sidebarResizeHandle: { position: 'absolute', right: 0, top: 0, bottom: 0, width: '4px', cursor: 'ew-resize', backgroundColor: 'transparent', zIndex: 10, transition: 'background-color 0.2s' },
      sidebarNav: { display: 'flex', flexDirection: 'column', padding: '0.75rem 0.5rem', gap: '0.25rem', borderBottom: '1px solid var(--border)' },
      sidebarNavItem: { display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.75rem', border: 'none', borderRadius: '10px', cursor: 'pointer', transition: 'background-color 0.2s', textAlign: 'left', width: '100%' },
      sidebarNavItemActive: { backgroundColor: 'var(--bg-elevated)' },
      sidebarNavIcon: { fontSize: '1.25rem', flexShrink: 0 },
      sidebarNavLabel: { fontSize: '0.85rem', color: 'var(--text)', fontWeight: 500, whiteSpace: 'nowrap', overflow: 'hidden', transition: 'opacity 0.2s, width 0.2s' },
      tabs: { display: 'flex', flex: 1 },
      tab: { flex: 1, padding: '0.875rem 0.375rem', backgroundColor: 'transparent', border: 'none', borderBottom: '2px solid transparent', color: 'var(--text-muted)', fontSize: '0.7rem', fontWeight: 500, cursor: 'pointer', whiteSpace: 'nowrap' },
      tabActive: { color: 'var(--text)', borderBottomColor: 'var(--accent)' },
      tabContent: { flex: 1, overflow: 'auto', padding: '1rem', minHeight: 0 },
      tabPlaceholder: { display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%', padding: '2rem' },
      placeholderText: { color: 'var(--text-muted)', fontSize: '0.85rem', textAlign: 'center', fontStyle: 'italic' },

      eventsTab: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      addItemButton: { padding: '0.625rem 1rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '8px', color: 'white', fontSize: '0.8rem', cursor: 'pointer', alignSelf: 'flex-start' },
      eventsList: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
      eventCard: { backgroundColor: 'var(--bg-elevated)', borderRadius: '10px', overflow: 'hidden' },
      eventHeader: { padding: '0.875rem 1rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', cursor: 'pointer' },
      eventHeaderLeft: { display: 'flex', alignItems: 'center', gap: '0.625rem' },
      eventDot: { width: '8px', height: '8px', borderRadius: '50%', flexShrink: 0 },
      eventMonth: { fontSize: '0.7rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' },
      eventTitle: { fontSize: '0.875rem', color: 'var(--text)' },
      expandIcon: { color: 'var(--text-muted)', fontSize: '1rem' },
      eventDetails: { padding: '0 1rem 1rem', display: 'flex', flexDirection: 'column', gap: '0.75rem', borderTop: '1px solid var(--border)', paddingTop: '0.875rem' },
      detailField: { display: 'flex', flexDirection: 'column', gap: '0.25rem' },
      detailLabel: { fontSize: '0.7rem', color: 'var(--text-muted)' },
      detailInput: { padding: '0.5rem 0.75rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '6px', fontSize: '0.8rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", resize: 'none' },
      deleteEventButton: { padding: '0.5rem', backgroundColor: 'transparent', border: '1px solid var(--border)', borderRadius: '6px', color: 'var(--text-muted)', fontSize: '0.75rem', cursor: 'pointer', marginTop: '0.25rem' },
      emptyText: { color: 'var(--text-muted)', fontSize: '0.85rem', fontStyle: 'italic' },
      tipText: { color: 'var(--text-muted)', fontSize: '0.75rem', marginTop: 'auto', paddingTop: '1rem' },

      notesTab: { height: '100%' },
      notesTextarea: { width: '100%', height: '100%', minHeight: '300px', padding: '1rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '10px', fontSize: '0.875rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", resize: 'none', lineHeight: 1.7 },

      goalsTab: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      goalsList: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
      goalCard: { display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.75rem 1rem', backgroundColor: 'var(--bg-elevated)', borderRadius: '8px' },
      goalCheck: { width: '20px', height: '20px', borderRadius: '50%', border: '2px solid var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', color: 'white', fontSize: '0.7rem', flexShrink: 0 },
      goalText: { flex: 1, fontSize: '0.875rem', color: 'var(--text)' },
      goalDelete: { background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '1rem', opacity: 0.5 },

      centerPanel: { display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '1.5rem 1.25rem', backgroundColor: 'var(--bg-main)', gap: '1.5rem', overflow: 'auto', height: '100%', minHeight: 0 },
      viewSwitcher: { display: 'flex', gap: '2px', backgroundColor: 'var(--bg-card)', padding: '4px', borderRadius: '12px', border: '1px solid var(--border)' },
      viewButton: { padding: '0.5rem 1rem', backgroundColor: 'transparent', border: 'none', borderRadius: '10px', color: 'var(--text-muted)', fontSize: '0.8rem', fontWeight: 500, cursor: 'pointer', transition: 'all 0.2s ease' },
      viewButtonActive: { backgroundColor: 'var(--accent)', color: 'white' },

      circleContainer: { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem' },
      circleAddButton: { padding: '0.5rem 1.25rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '20px', color: 'white', fontSize: '0.8rem', cursor: 'pointer' },

      // Seasons
      seasonsContainer: { width: '100%', maxWidth: '580px' },
      seasonsGrid: { display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem' },
      seasonCard: { borderRadius: '16px', overflow: 'hidden', border: '2px solid transparent' },
      seasonDecorative: { padding: '0.75rem', display: 'flex', justifyContent: 'center', gap: '0.75rem', fontSize: '1rem', opacity: 0.7 },
      seasonCardContent: { padding: '1rem', backgroundColor: 'var(--bg-card)', borderBottomLeftRadius: '14px', borderBottomRightRadius: '14px' },
      seasonCardHeader: { marginBottom: '0.5rem', position: 'relative' },
      seasonName: { fontSize: '1.125rem', fontFamily: "'Fraunces', serif", marginBottom: '0.125rem' },
      seasonMonths: { fontSize: '0.75rem', color: 'var(--text-muted)' },
      currentBadge: { position: 'absolute', top: 0, right: 0, fontSize: '0.6rem', color: 'white', padding: '0.2rem 0.5rem', borderRadius: '8px' },
      seasonDescription: { fontSize: '0.75rem', color: 'var(--text-muted)', lineHeight: 1.5, marginBottom: '0.75rem', fontStyle: 'italic' },
      seasonIntentionBox: { },
      seasonLabel: { fontSize: '0.7rem', fontWeight: 500, display: 'block', marginBottom: '0.375rem' },
      seasonTextarea: { width: '100%', padding: '0.625rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', fontSize: '0.8rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", resize: 'none', lineHeight: 1.5 },

      // Monthly
      monthlyContainer: { width: '100%', maxWidth: '500px', display: 'flex', flexDirection: 'column', gap: '1rem' },
      monthStrip: { display: 'flex', gap: '2px', backgroundColor: 'var(--bg-card)', padding: '4px', borderRadius: '10px', border: '1px solid var(--border)' },
      monthStripButton: { flex: 1, padding: '0.5rem 0.25rem', border: 'none', borderRadius: '6px', fontSize: '0.65rem', fontWeight: 500, cursor: 'pointer', transition: 'all 0.2s ease' },
      calendarWrapper: { backgroundColor: 'var(--bg-card)', borderRadius: '16px', overflow: 'hidden', border: '1px solid var(--border)' },
      calendarHeader: { padding: '0.875rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', opacity: 0.85 },
      calendarNav: { background: 'none', border: 'none', color: 'white', fontSize: '1.25rem', cursor: 'pointer', padding: '0 0.5rem', opacity: 0.9 },
      calendarTitle: { color: 'white', fontSize: '1rem', fontFamily: "'Fraunces', serif" },
      calendarBody: { padding: '1rem' },
      calendarGrid: { display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px' },
      calendarDayHeader: { padding: '0.5rem', textAlign: 'center', fontSize: '0.65rem', color: 'var(--text-muted)', fontWeight: 500 },
      calendarDayEmpty: { aspectRatio: '1' },
      calendarDay: { aspectRatio: '1', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.8rem', color: 'var(--text-light)', backgroundColor: 'var(--bg-elevated)', borderRadius: '8px' },
      calendarDayToday: { color: 'white', fontWeight: 600 },
      monthEventsSection: { display: 'flex', flexDirection: 'column', gap: '0.5rem', alignItems: 'center' },
      monthEventsList: { width: '100%', display: 'flex', flexDirection: 'column', gap: '0.375rem' },
      monthEventItem: { display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.625rem 0.875rem', backgroundColor: 'var(--bg-card)', borderRadius: '8px', fontSize: '0.85rem', border: '1px solid var(--border)' },
      noEventsText: { color: 'var(--text-muted)', fontSize: '0.85rem', fontStyle: 'italic' },
      addEventSmall: { padding: '0.5rem 1rem', backgroundColor: 'transparent', border: '1px solid', borderRadius: '20px', fontSize: '0.8rem', cursor: 'pointer' },

      // Weekly
      weeklyContainer: { width: '100%', maxWidth: '650px', display: 'flex', flexDirection: 'column', gap: '1.5rem', padding: '1rem' },
      weeklyHeader: { textAlign: 'center', marginBottom: '0.5rem' },
      weeklyTitle: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", color: 'var(--text)', marginBottom: '0.375rem' },
      weeklySubtitle: { fontSize: '0.9rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      weeklyGrid: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      weeklyDaysHeader: { display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', maxWidth: '350px', margin: '0 auto' },
      weeklyDayLabel: { fontSize: '0.7rem', color: 'var(--text-muted)', textAlign: 'center', fontWeight: 500 },
      weeklyHabitsList: { display: 'flex', flexDirection: 'column', gap: '0.75rem' },
      weeklyHabitRow: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: '1.5rem', padding: '1rem 1.25rem', backgroundColor: 'var(--bg-card)', borderRadius: '12px', border: '1px solid var(--border)' },
      weeklyHabitInfo: { display: 'flex', alignItems: 'center', gap: '0.625rem', flex: '1' },
      weeklyHabitDot: { width: '10px', height: '10px', borderRadius: '50%', flexShrink: 0 },
      weeklyHabitText: { fontSize: '0.95rem', color: 'var(--text)', fontWeight: 500 },
      weeklyHabitFreq: { fontSize: '0.75rem', color: 'var(--text-muted)', backgroundColor: 'var(--bg-elevated)', padding: '0.25rem 0.625rem', borderRadius: '12px', marginLeft: '0.5rem' },
      weeklyHabitDelete: { background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '1.125rem', opacity: 0.5, marginLeft: '0.5rem' },
      weeklyHabitDays: { display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', width: '280px', flexShrink: 0 },
      weeklyDayCircle: { width: '32px', height: '32px', borderRadius: '50%', border: '2px solid', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto' },
      weeklyEmpty: { textAlign: 'center', padding: '3rem 2rem', backgroundColor: 'var(--bg-card)', borderRadius: '16px', border: '1px dashed var(--border)' },
      weeklyEmptyText: { fontSize: '1rem', color: 'var(--text-muted)', fontStyle: 'italic', marginBottom: '0.25rem' },
      addHabitSection: { display: 'flex', gap: '0.625rem', alignItems: 'center', justifyContent: 'center', flexWrap: 'wrap' },
      addHabitInput: { flex: '1', minWidth: '200px', maxWidth: '280px', padding: '0.75rem 1rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '10px', fontSize: '0.9rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif" },
      addHabitSelect: { padding: '0.75rem 1rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '10px', fontSize: '0.85rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif" },
      addHabitButton: { padding: '0.75rem 1.5rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '10px', color: 'white', fontSize: '0.85rem', cursor: 'pointer', fontWeight: 500 },
      lockedText: { textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.9rem', fontStyle: 'italic', padding: '1rem' },

      // Daily
      dailyContainer: { width: '100%', maxWidth: '550px', display: 'flex', flexDirection: 'column', gap: '1.5rem', padding: '1rem' },
      dailyHeader: { textAlign: 'center', marginBottom: '0.5rem' },
      dailyTitle: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", color: 'var(--text)', marginBottom: '0.375rem' },
      dailySubtitle: { fontSize: '0.9rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      dailyList: { display: 'flex', flexDirection: 'column', gap: '0.75rem' },
      dailyHabitCard: { display: 'flex', alignItems: 'center', backgroundColor: 'var(--bg-card)', borderRadius: '14px', border: '1px solid var(--border)', overflow: 'hidden' },
      dailyHabitAccent: { width: '5px', height: '100%', minHeight: '70px', flexShrink: 0 },
      dailyHabitContent: { flex: 1, padding: '1rem 1.25rem', display: 'flex', flexDirection: 'column', gap: '0.2rem' },
      dailyHabitText: { fontSize: '1rem', color: 'var(--text)', fontWeight: 500 },
      dailyHabitLabel: { fontSize: '0.75rem', color: 'var(--text-muted)', fontStyle: 'italic' },
      dailyHabitDelete: { background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', fontSize: '1.25rem', padding: '1rem', opacity: 0.5 },
      dailyEmpty: { textAlign: 'center', padding: '3rem 2rem', backgroundColor: 'var(--bg-card)', borderRadius: '16px', border: '1px dashed var(--border)' },
      dailyEmptyText: { fontSize: '1rem', color: 'var(--text-muted)', marginBottom: '0.75rem' },
      dailyEmptyExamples: { fontSize: '0.85rem', color: 'var(--text-muted)' },
      addDailySection: { display: 'flex', flexDirection: 'column', gap: '0.625rem', alignItems: 'center' },
      addDailyInput: { width: '100%', maxWidth: '400px', padding: '0.875rem 1.125rem', backgroundColor: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', fontSize: '0.95rem', color: 'var(--text)', fontFamily: "'DM Sans', sans-serif", textAlign: 'center' },
      addDailyButton: { padding: '0.75rem 1.5rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '12px', color: 'white', fontSize: '0.9rem', cursor: 'pointer', fontWeight: 500 },

      // Bottom section - VLQ Summary
      bottomSection: { display: 'flex', justifyContent: 'center', gap: '2rem', width: '100%', maxWidth: '600px', padding: '1rem 1.5rem', backgroundColor: 'var(--bg-card)', borderRadius: '14px', border: '1px solid var(--border)', marginTop: 'auto' },
      vlqSummary: { display: 'flex', gap: '2.5rem', justifyContent: 'center', width: '100%' },
      vlqSummaryColumn: { display: 'flex', flexDirection: 'column', gap: '0.5rem', alignItems: 'center' },
      vlqSummaryLabel: { fontSize: '0.7rem', color: 'var(--text-muted)', fontWeight: 500 },
      vlqSummaryItems: { display: 'flex', flexWrap: 'wrap', gap: '0.375rem', justifyContent: 'center' },
      vlqSummaryTag: { display: 'inline-flex', alignItems: 'center', gap: '0.25rem', padding: '0.3rem 0.6rem', backgroundColor: 'transparent', border: '1px solid', borderRadius: '12px', fontSize: '0.7rem' },
      sectionLabel: { fontSize: '0.65rem', textTransform: 'uppercase', letterSpacing: '0.1em', color: 'var(--text-muted)', marginBottom: '0.5rem', fontFamily: "'DM Sans', sans-serif", fontWeight: 600 },
      slider: { width: '100%', height: '3px', cursor: 'pointer' },

      // Chat
      chatPanel: { backgroundColor: 'var(--bg-card)', borderLeft: '1px solid var(--border)', display: 'flex', flexDirection: 'column', height: '100%', overflow: 'hidden', position: 'relative' },
      resizeHandle: { position: 'absolute', left: 0, top: 0, bottom: 0, width: '6px', cursor: 'ew-resize', backgroundColor: 'transparent', zIndex: 10, transition: 'background-color 0.2s' },
      chatMessages: { flex: 1, padding: '1.25rem', overflowY: 'auto', display: 'flex', flexDirection: 'column', gap: '0.875rem', minHeight: 0 },
      chatInputArea: { padding: '1rem 1.25rem 1.25rem', borderTop: '1px solid var(--border)' },
      skipButton: { width: '100%', padding: '0.5rem', marginBottom: '0.75rem', backgroundColor: 'transparent', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text-muted)', fontSize: '0.8rem', cursor: 'pointer' },
      inputRow: { display: 'flex', gap: '0.625rem', alignItems: 'flex-end' },
      chatInput: { flex: 1, padding: '0.75rem 1rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '12px', color: 'var(--text)', fontSize: '0.875rem', fontFamily: "'DM Sans', sans-serif", resize: 'none' },
      sendButton: { width: '40px', height: '40px', borderRadius: '50%', backgroundColor: 'var(--accent)', border: 'none', color: 'white', fontSize: '1rem', cursor: 'pointer', flexShrink: 0 },
      sendButtonDisabled: { backgroundColor: 'var(--border)', cursor: 'not-allowed' },
      chatMessage: { display: 'flex', gap: '0.625rem', alignItems: 'flex-start' },
      chatAvatar: { width: '28px', height: '28px', borderRadius: '50%', backgroundColor: 'var(--accent-light)', border: '1px solid var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 },
      chatAvatarText: { fontFamily: "'Fraunces', serif", fontSize: '0.75rem', color: 'var(--accent)' },
      chatBubble: { padding: '0.75rem 1rem', borderRadius: '14px', maxWidth: '88%', fontSize: '0.875rem', lineHeight: 1.55 },
      chatBubbleAssistant: { backgroundColor: 'var(--bg-elevated)', borderTopLeftRadius: '4px', color: 'var(--text)' },
      chatBubbleUser: { backgroundColor: 'var(--accent)', borderTopRightRadius: '4px', color: 'white' },
      typingBubble: { padding: '0.75rem 1rem', backgroundColor: 'var(--bg-elevated)', borderRadius: '14px', borderTopLeftRadius: '4px', display: 'flex', gap: '4px' },
      typingDot: { color: 'var(--accent)', fontSize: '1.125rem', lineHeight: 1, animation: 'pulse 1s infinite' },

      modalOverlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0,0,0,0.4)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 },
      modal: { backgroundColor: 'var(--bg-card)', borderRadius: '16px', padding: '1.5rem', width: '90%', maxWidth: '360px', border: '1px solid var(--border)' },
      modalHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.25rem' },
      modalTitle: { fontSize: '1.125rem', fontFamily: "'Fraunces', serif", color: 'var(--text)' },
      modalClose: { width: '28px', height: '28px', borderRadius: '50%', backgroundColor: 'var(--bg-elevated)', border: 'none', color: 'var(--text-muted)', fontSize: '1rem', cursor: 'pointer' },
      modalForm: { display: 'flex', flexDirection: 'column', gap: '1rem' },
      formField: { display: 'flex', flexDirection: 'column', gap: '0.375rem' },
      formLabel: { fontSize: '0.7rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em', fontWeight: 500 },
      textInput: { padding: '0.625rem 0.875rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text)', fontSize: '0.875rem', fontFamily: "'DM Sans', sans-serif" },
      selectInput: { padding: '0.625rem 0.875rem', backgroundColor: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text)', fontSize: '0.875rem', fontFamily: "'DM Sans', sans-serif" },
      submitButton: { padding: '0.75rem', backgroundColor: 'var(--accent)', border: 'none', borderRadius: '10px', color: 'white', fontSize: '0.875rem', fontWeight: 500, cursor: 'pointer', marginTop: '0.5rem' },
      submitButtonDisabled: { backgroundColor: 'var(--border-dark)', cursor: 'not-allowed' },
      settingsHint: { fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.5rem', lineHeight: 1.5 },
      settingsLink: { color: 'var(--accent)', textDecoration: 'none' },
      settingsStatus: { fontSize: '0.8rem', color: 'var(--accent)', textAlign: 'center', marginTop: '0.5rem' },
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TendApp />);
  </script>
</body>
</html>
