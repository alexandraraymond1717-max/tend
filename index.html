<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tend — Intentional Living</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-main: #FAF8F5;
      --bg-card: #FFFFFF;
      --bg-elevated: #F0EBE4;
      --text: #2D2A26;
      --text-light: #6B6660;
      --text-muted: #9A9590;
      --border: #E8E2D9;
      --border-dark: #D4CCC0;
      --accent: #7D9B76;
      --accent-light: #E8F0E6;
      --ghost: #E8E2D9;
      
      --winter: #7A9CAD;
      --spring: #7D9B76;
      --summer: #C9A66B;
      --fall: #C4836A;
    }

    [data-theme="dark"] {
      --bg-main: #1a1916;
      --bg-card: #252320;
      --bg-elevated: #2d2a26;
      --text: #F5F0E8;
      --text-light: #B8B2A8;
      --text-muted: #8A857C;
      --border: #3d3a36;
      --border-dark: #4a4640;
      --accent: #A8C4A2;
      --accent-light: #2d332c;
      --ghost: #3d3a36;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--bg-main);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    h1, h2, h3, h4 {
      font-family: 'Fraunces', serif;
      font-weight: 400;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-dark); border-radius: 3px; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.7; }
    }
    @keyframes gentlePulse {
      0%, 100% { opacity: 0.15; }
      50% { opacity: 0.25; }
    }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    .slide-in { animation: slideIn 0.4s ease-out forwards; }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent) !important;
    }
  </style>
</head>
<body data-theme="light">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ============ CONSTANTS ============
    const LIFE_AREAS = {
      health: { name: 'Health & Wellness', icon: '◐', color: '#7D9B76', keywords: ['health', 'fitness', 'exercise', 'gym', 'sleep', 'energy', 'body', 'weight', 'diet', 'mental health', 'stress', 'anxiety', 'tired', 'exhausted'] },
      relationships: { name: 'Relationships', icon: '♡', color: '#C48B8B', keywords: ['partner', 'relationship', 'marriage', 'spouse', 'husband', 'wife', 'boyfriend', 'girlfriend', 'family', 'friends', 'kids', 'children', 'parents', 'dating', 'connection', 'lonely', 'love', 'present'] },
      career: { name: 'Career & Work', icon: '◆', color: '#7A9CAD', keywords: ['work', 'job', 'career', 'promotion', 'boss', 'office', 'business', 'project', 'deadline', 'meeting', 'professional', 'salary', 'coworkers', 'manager', 'burnout'] },
      finances: { name: 'Finances', icon: '○', color: '#C9A66B', keywords: ['money', 'financial', 'savings', 'debt', 'budget', 'invest', 'retirement', 'income', 'expenses', 'afford', 'bills', 'wealth'] },
      growth: { name: 'Personal Growth', icon: '✦', color: '#9B8AAE', keywords: ['learn', 'grow', 'growth', 'read', 'book', 'course', 'skill', 'hobby', 'creative', 'creativity', 'develop', 'improve', 'therapy', 'meditation', 'mindful'] },
      fun: { name: 'Fun & Adventure', icon: '✺', color: '#C4836A', keywords: ['fun', 'adventure', 'travel', 'trip', 'vacation', 'explore', 'experience', 'play', 'enjoy', 'hobby', 'entertainment', 'relax', 'weekend'] },
    };

    const VALUE_KEYWORDS = {
      'Freedom': ['freedom', 'free', 'autonomy', 'independent', 'flexible', 'flexibility', 'control', 'choice'],
      'Connection': ['connection', 'connected', 'together', 'relationship', 'partner', 'love', 'intimacy', 'close', 'present', 'presence'],
      'Growth': ['growth', 'grow', 'learn', 'improve', 'better', 'develop', 'progress', 'evolve'],
      'Peace': ['peace', 'calm', 'peaceful', 'stress', 'less stressed', 'relaxed', 'quiet', 'stillness', 'balance', 'balanced'],
      'Health': ['health', 'healthy', 'fit', 'strong', 'energy', 'energized', 'well', 'wellness'],
      'Adventure': ['adventure', 'travel', 'explore', 'new', 'exciting', 'experience', 'spontaneous'],
      'Creativity': ['creative', 'creativity', 'create', 'art', 'make', 'build', 'design', 'write', 'music'],
      'Family': ['family', 'kids', 'children', 'parents', 'mom', 'dad', 'siblings', 'home'],
      'Success': ['success', 'achieve', 'accomplish', 'goal', 'ambitious', 'career', 'promotion'],
      'Joy': ['joy', 'happy', 'happiness', 'fun', 'laugh', 'enjoy', 'pleasure', 'delight'],
      'Authenticity': ['authentic', 'real', 'true', 'honest', 'genuine', 'myself', 'who I am'],
      'Security': ['security', 'secure', 'stable', 'stability', 'safe', 'reliable', 'consistent'],
    };

    const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const MONTH_FULL = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    const SEASONS = {
      winter: { name: 'Winter', months: [11, 0, 1], color: '#7A9CAD' },
      spring: { name: 'Spring', months: [2, 3, 4], color: '#7D9B76' },
      summer: { name: 'Summer', months: [5, 6, 7], color: '#C9A66B' },
      fall: { name: 'Fall', months: [8, 9, 10], color: '#C4836A' },
    };

    const PHASES = {
      EXPLORE: 'explore',
      GROUND: 'ground',
      REVEAL: 'reveal',
      PLAN: 'plan',
    };

    // ============ MAIN APP ============
    function TendApp() {
      // Core state
      const [phase, setPhase] = useState(PHASES.EXPLORE);
      const [values, setValues] = useState([]);
      const [lifeAreaFocus, setLifeAreaFocus] = useState({});
      const [events, setEvents] = useState([]);
      const [goals, setGoals] = useState([]);
      const [seasonIntentions, setSeasonIntentions] = useState({});
      
      // Chat state
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [exchangeCount, setExchangeCount] = useState(0);
      const messagesEndRef = useRef(null);

      // UI state
      const [revealed, setRevealed] = useState(false);
      const [showEventModal, setShowEventModal] = useState(false);

      // Initialize
      useEffect(() => {
        setMessages([{
          role: 'assistant',
          content: `Welcome to Tend.

Before we get into calendars and planning, I want to understand what you actually want from this year.

What would make 2026 feel like a success? It could be a concrete achievement, a feeling you want to have, a change in how you're living — whatever comes to mind first.`
        }]);
      }, []);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      // ============ TEXT ANALYSIS ============
      const analyzeText = (text) => {
        const lower = text.toLowerCase();
        const detected = { values: [], lifeAreas: [] };

        Object.entries(VALUE_KEYWORDS).forEach(([value, keywords]) => {
          if (keywords.some(kw => lower.includes(kw)) && !values.includes(value)) {
            detected.values.push(value);
          }
        });

        Object.entries(LIFE_AREAS).forEach(([key, area]) => {
          if (area.keywords.some(kw => lower.includes(kw))) {
            detected.lifeAreas.push(key);
          }
        });

        return detected;
      };

      const processAnalysis = (detected) => {
        if (detected.values.length > 0) {
          setValues(prev => [...new Set([...prev, ...detected.values])].slice(0, 5));
        }
        
        if (detected.lifeAreas.length > 0) {
          setLifeAreaFocus(prev => {
            const updated = { ...prev };
            detected.lifeAreas.forEach(area => {
              if (!updated[area]) updated[area] = 'mentioned';
            });
            return updated;
          });
        }
      };

      const parseEvents = (text) => {
        const lower = text.toLowerCase();
        const foundEvents = [];
        
        MONTH_FULL.forEach((month, idx) => {
          if (lower.includes(month.toLowerCase())) {
            foundEvents.push({ month: idx });
          }
        });
        
        return foundEvents;
      };

      // ============ CONVERSATION LOGIC ============
      const generateResponse = (userMessage, currentPhase, exchangeNum) => {
        const detected = analyzeText(userMessage);
        processAnalysis(detected);
        
        const lower = userMessage.toLowerCase();

        if (currentPhase === PHASES.EXPLORE) {
          if (exchangeNum === 1) {
            const hasFeeling = ['feel', 'feeling', 'want to be', 'less', 'more'].some(w => lower.includes(w));
            const hasConcrete = ['achieve', 'goal', 'finish', 'complete', 'start', 'launch', 'build'].some(w => lower.includes(w));
            
            if (hasFeeling) {
              return `That's about <em>how</em> you want to feel, not just what you want to do — which is important.

What's getting in the way of that right now? What's creating friction?`;
            } else if (hasConcrete) {
              return `That's concrete — I can work with that.

But beyond achieving that, how do you want to <em>feel</em> this year? What would be different about your day-to-day life?`;
            } else {
              return `Say more about that. What would that actually look like in your life?`;
            }
          }
          
          if (exchangeNum === 2) {
            const detectedAreas = Object.keys(lifeAreaFocus);
            if (detectedAreas.length > 0) {
              const areaName = LIFE_AREAS[detectedAreas[0]].name;
              return `So ${areaName.toLowerCase()} is part of this.

If things stayed exactly as they are now for another year, how would that feel?`;
            }
            return `I'm starting to get a picture. What would you need to let go of to make space for this?`;
          }

          if (exchangeNum >= 3) {
            setPhase(PHASES.GROUND);
            return `Before I share what I'm hearing, help me understand what's already on your plate this year.

What's committed — trips, work deadlines, big family events, anything that's already locked in? Just mention the month and what it is.`;
          }
        }

        if (currentPhase === PHASES.GROUND) {
          const foundEvents = parseEvents(userMessage);
          
          if (foundEvents.length > 0) {
            const newEvents = foundEvents.map((e, i) => ({
              id: Date.now() + i,
              title: `Event`,
              month: e.month,
              lifeArea: 'fun',
            }));
            setEvents(prev => [...prev, ...newEvents]);
          }

          setTimeout(() => {
            setPhase(PHASES.REVEAL);
            setRevealed(true);
          }, 500);

          const valuesSummary = values.length > 0 
            ? values.slice(0, 3).join(', ')
            : 'presence, balance, and intention';

          return `Got it. Let me reflect back what I'm hearing.

<strong>Here's what's taking shape:</strong>

Your values this year seem to center around <em>${valuesSummary}</em>.

${Object.keys(lifeAreaFocus).length > 0 
  ? `${LIFE_AREAS[Object.keys(lifeAreaFocus)[0]].name} is where I'm hearing some tension or desire for change.`
  : `You're looking for a shift in how you spend your time and energy.`}

${foundEvents.length > 0 
  ? `You've got ${foundEvents.length} thing${foundEvents.length > 1 ? 's' : ''} already anchoring the year.`
  : `Your calendar sounds relatively open — that's space to be intentional with.`}

Take a look at what's forming on the left. Does this feel right? You can edit anything directly now.`;
        }

        if (currentPhase === PHASES.REVEAL || currentPhase === PHASES.PLAN) {
          setPhase(PHASES.PLAN);
          
          if (lower.includes('yes') || lower.includes('right') || lower.includes('exactly') || lower.includes('good')) {
            return `Good. Now let's make it real.

Looking at the year — what's missing? ${values.length > 0 ? `If <em>${values[0]}</em> matters, what needs to get on the calendar to protect it?` : `What would make the next few months feel intentional rather than reactive?`}`;
          }

          if (lower.includes('no') || lower.includes('not quite') || lower.includes('change')) {
            return `That's okay — this is just a starting point. Edit anything on the left that doesn't feel right.

What would you adjust?`;
          }

          const planningPrompts = [
            `What's one thing you've been meaning to schedule but haven't?`,
            `Looking at the seasons — which one needs the most attention?`,
            `Is there something that used to bring you joy that's fallen off the calendar?`,
            `What does rest look like for you, and where does it fit?`,
          ];
          
          return planningPrompts[Math.floor(Math.random() * planningPrompts.length)];
        }

        return `Tell me more about that.`;
      };

      // ============ HANDLERS ============
      const handleSendMessage = () => {
        if (!inputValue.trim()) return;
        
        const userMessage = inputValue.trim();
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setInputValue('');
        setIsTyping(true);
        setExchangeCount(prev => prev + 1);

        setTimeout(() => {
          const response = generateResponse(userMessage, phase, exchangeCount + 1);
          setMessages(prev => [...prev, { role: 'assistant', content: response }]);
          setIsTyping(false);
        }, 1200);
      };

      const handleSkip = () => {
        setPhase(PHASES.PLAN);
        setRevealed(true);
        setMessages(prev => [...prev, {
          role: 'assistant',
          content: `No problem — let's jump into planning.

The canvas is yours. Add values that matter to you, check in on different life areas, and start placing intentions on the year.

I'm here whenever you want to think out loud.`
        }]);
      };

      const handleAddEvent = (eventData) => {
        setEvents(prev => [...prev, { ...eventData, id: Date.now() }]);
        setShowEventModal(false);
      };

      // ============ RENDER ============
      return (
        <div style={styles.container}>
          {/* Header */}
          <header style={styles.header}>
            <div style={styles.logoContainer}>
              <svg width="28" height="28" viewBox="0 0 32 32" fill="none" style={{ marginRight: '8px' }}>
                <path d="M16 26 Q16 18 16 14" stroke="var(--accent)" strokeWidth="2" strokeLinecap="round" fill="none"/>
                <path d="M16 18 Q10 16 8 10 Q14 12 16 18" fill="var(--accent)" opacity="0.5"/>
                <path d="M16 14 Q22 10 24 4 Q18 8 16 14" fill="var(--accent)"/>
                <path d="M16 10 Q14 6 16 2 Q18 6 16 10" fill="var(--accent)" opacity="0.7"/>
              </svg>
              <h1 style={styles.logoText}>tend</h1>
            </div>
            <p style={styles.tagline}>a space for designing your life with intention</p>
          </header>

          {/* Main Content - Three Columns */}
          <main style={styles.main}>
            {/* Left Sidebar - Ghosted Placeholders */}
            <aside style={styles.sidebar}>
              <SidebarSection 
                title="Values" 
                revealed={revealed}
                items={values}
                ghostCount={3}
                renderItem={(v) => (
                  <span key={v} style={styles.valueChip} className="slide-in">
                    {v}
                    {revealed && (
                      <button style={styles.chipRemove} onClick={() => setValues(values.filter(x => x !== v))}>×</button>
                    )}
                  </span>
                )}
                onAdd={revealed ? () => {
                  const v = prompt('Add a value:');
                  if (v && !values.includes(v)) setValues([...values, v]);
                } : null}
              />
              
              <SidebarSection 
                title="Life Areas" 
                revealed={revealed}
                ghostCount={0}
              >
                <div style={styles.lifeAreasList}>
                  {Object.entries(LIFE_AREAS).map(([key, area]) => {
                    const isActive = revealed || lifeAreaFocus[key];
                    return (
                      <div 
                        key={key}
                        style={{
                          ...styles.lifeAreaItem,
                          opacity: isActive ? 1 : 0.3,
                          borderColor: lifeAreaFocus[key] ? area.color : 'transparent',
                        }}
                      >
                        <span style={{color: area.color, fontSize: '0.9rem'}}>{area.icon}</span>
                        <span style={styles.lifeAreaLabel}>{area.name}</span>
                      </div>
                    );
                  })}
                </div>
              </SidebarSection>

              <SidebarSection 
                title="Goals" 
                revealed={revealed}
                items={goals}
                ghostCount={2}
                renderItem={(g) => (
                  <div key={g.id} style={styles.goalItem} className="slide-in">
                    <span>{g.text}</span>
                    {revealed && (
                      <button style={styles.chipRemove} onClick={() => setGoals(goals.filter(x => x.id !== g.id))}>×</button>
                    )}
                  </div>
                )}
                onAdd={revealed ? () => {
                  const g = prompt('Add a goal:');
                  if (g) setGoals([...goals, { id: Date.now(), text: g }]);
                } : null}
              />

              <SidebarSection 
                title="Seasons" 
                revealed={revealed}
                ghostCount={0}
              >
                <div style={styles.seasonsList}>
                  {Object.entries(SEASONS).map(([key, season]) => (
                    <div 
                      key={key}
                      style={{
                        ...styles.seasonItem,
                        opacity: revealed ? 1 : 0.3,
                        borderLeftColor: season.color,
                      }}
                    >
                      <span style={{color: season.color, fontWeight: 500}}>{season.name}</span>
                      {revealed && (
                        <input
                          type="text"
                          placeholder="Focus..."
                          value={seasonIntentions[key] || ''}
                          onChange={(e) => setSeasonIntentions({...seasonIntentions, [key]: e.target.value})}
                          style={styles.seasonInput}
                        />
                      )}
                    </div>
                  ))}
                </div>
              </SidebarSection>
            </aside>

            {/* Center - Seasons Circle */}
            <div style={styles.centerPanel}>
              <SeasonsCircle 
                events={events} 
                revealed={revealed}
                onAddEvent={() => setShowEventModal(true)}
              />
            </div>

            {/* Right - Chat Panel */}
            <div style={styles.chatPanel}>
              <div style={styles.chatMessages}>
                {messages.map((msg, idx) => (
                  <ChatMessage key={idx} message={msg} />
                ))}
                {isTyping && <TypingIndicator />}
                <div ref={messagesEndRef} />
              </div>
              
              <div style={styles.chatInputArea}>
                {!revealed && phase === PHASES.EXPLORE && (
                  <button style={styles.skipButton} onClick={handleSkip}>
                    Skip to planning →
                  </button>
                )}
                <div style={styles.inputRow}>
                  <textarea
                    style={styles.chatInput}
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleSendMessage();
                      }
                    }}
                    placeholder="Share what's on your mind..."
                    rows={2}
                  />
                  <button 
                    style={{
                      ...styles.sendButton,
                      ...(inputValue.trim() ? {} : styles.sendButtonDisabled)
                    }}
                    onClick={handleSendMessage}
                    disabled={!inputValue.trim()}
                  >
                    ↑
                  </button>
                </div>
              </div>
            </div>
          </main>

          {/* Event Modal */}
          {showEventModal && (
            <EventModal 
              onClose={() => setShowEventModal(false)}
              onAdd={handleAddEvent}
            />
          )}
        </div>
      );
    }

    // ============ SIDEBAR SECTION ============
    function SidebarSection({ title, revealed, items = [], ghostCount = 3, renderItem, onAdd, children }) {
      return (
        <div style={styles.sidebarSection}>
          <div style={styles.sectionHeader}>
            <h3 style={styles.sectionTitle}>{title}</h3>
            {onAdd && <button style={styles.addButton} onClick={onAdd}>+</button>}
          </div>
          
          {children ? children : (
            <div style={styles.sectionContent}>
              {items.length > 0 ? (
                items.map(item => renderItem(item))
              ) : (
                <div style={styles.ghostedItems}>
                  {Array.from({ length: ghostCount }).map((_, i) => (
                    <div 
                      key={i} 
                      style={{
                        ...styles.ghostPill,
                        width: `${60 + Math.random() * 40}px`,
                        animationDelay: `${i * 0.2}s`,
                      }}
                    />
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      );
    }

    // ============ SEASONS CIRCLE ============
    function SeasonsCircle({ events, revealed, onAddEvent }) {
      const size = 380;
      const center = size / 2;
      const outerRadius = 170;
      const innerRadius = 80;
      const monthRadius = 150;

      const currentMonth = new Date().getMonth();

      // Calculate month positions around the circle
      const getMonthPosition = (monthIndex) => {
        // Start from top (12 o'clock) and go clockwise
        // Month 0 (Jan) should be at roughly 1 o'clock position
        const angle = ((monthIndex - 2) / 12) * 2 * Math.PI - Math.PI / 2;
        return {
          x: center + Math.cos(angle) * monthRadius,
          y: center + Math.sin(angle) * monthRadius,
        };
      };

      const getEventPosition = (monthIndex, eventIndex = 0) => {
        const angle = ((monthIndex - 2) / 12) * 2 * Math.PI - Math.PI / 2;
        const radius = innerRadius + 25 + (eventIndex * 12);
        return {
          x: center + Math.cos(angle) * radius,
          y: center + Math.sin(angle) * radius,
        };
      };

      const seasonArcs = [
        { id: 'winter', start: -60, end: 30, color: '#7A9CAD' },
        { id: 'spring', start: 30, end: 120, color: '#7D9B76' },
        { id: 'summer', start: 120, end: 210, color: '#C9A66B' },
        { id: 'fall', start: 210, end: 300, color: '#C4836A' },
      ];

      const describeArc = (startAngle, endAngle, radius) => {
        const start = polarToCartesian(center, center, radius, endAngle);
        const end = polarToCartesian(center, center, radius, startAngle);
        const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
        return [
          "M", start.x, start.y,
          "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y,
          "L", center, center,
          "Z"
        ].join(" ");
      };

      const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {
        const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
        return {
          x: centerX + (radius * Math.cos(angleInRadians)),
          y: centerY + (radius * Math.sin(angleInRadians))
        };
      };

      return (
        <div style={styles.circleContainer}>
          <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
            {/* Season arcs */}
            {seasonArcs.map(season => (
              <path
                key={season.id}
                d={describeArc(season.start, season.end, outerRadius)}
                fill={season.color}
                opacity={revealed ? 0.15 : 0.08}
                style={{ transition: 'opacity 0.5s ease' }}
              />
            ))}

            {/* Inner circle */}
            <circle
              cx={center}
              cy={center}
              r={innerRadius}
              fill="var(--bg-card)"
              stroke="var(--border)"
              strokeWidth="1"
            />

            {/* Year text */}
            <text
              x={center}
              y={center}
              textAnchor="middle"
              dominantBaseline="middle"
              fill="var(--text)"
              style={{ fontFamily: "'Fraunces', serif", fontSize: '2rem' }}
            >
              2026
            </text>

            {/* Month labels */}
            {MONTHS.map((month, idx) => {
              const pos = getMonthPosition(idx);
              const isCurrent = idx === currentMonth;
              return (
                <g key={month}>
                  <text
                    x={pos.x}
                    y={pos.y}
                    textAnchor="middle"
                    dominantBaseline="middle"
                    fill={isCurrent ? 'var(--accent)' : 'var(--text-muted)'}
                    style={{ 
                      fontFamily: "'DM Sans', sans-serif", 
                      fontSize: '0.7rem',
                      fontWeight: isCurrent ? 600 : 400,
                    }}
                  >
                    {month}
                  </text>
                  {isCurrent && (
                    <circle
                      cx={pos.x}
                      cy={pos.y + 12}
                      r="2"
                      fill="var(--accent)"
                    />
                  )}
                </g>
              );
            })}

            {/* Event dots */}
            {events.map((event, idx) => {
              const monthEvents = events.filter(e => e.month === event.month);
              const eventIndex = monthEvents.indexOf(event);
              const pos = getEventPosition(event.month, eventIndex);
              return (
                <circle
                  key={event.id}
                  cx={pos.x}
                  cy={pos.y}
                  r="5"
                  fill="var(--accent)"
                  className="fade-in"
                />
              );
            })}
          </svg>

          {/* Add event button */}
          {revealed && (
            <button style={styles.addEventButton} onClick={onAddEvent}>
              + Add Event
            </button>
          )}
        </div>
      );
    }

    // ============ CHAT MESSAGE ============
    function ChatMessage({ message }) {
      const isAssistant = message.role === 'assistant';
      
      return (
        <div style={{...styles.chatMessage, justifyContent: isAssistant ? 'flex-start' : 'flex-end'}} className="fade-in">
          {isAssistant && (
            <div style={styles.chatAvatar}>
              <span style={styles.chatAvatarText}>T</span>
            </div>
          )}
          <div style={{...styles.chatBubble, ...(isAssistant ? styles.chatBubbleAssistant : styles.chatBubbleUser)}}>
            <div dangerouslySetInnerHTML={{ __html: message.content.replace(/\n/g, '<br/>') }} />
          </div>
        </div>
      );
    }

    // ============ TYPING INDICATOR ============
    function TypingIndicator() {
      return (
        <div style={styles.chatMessage} className="fade-in">
          <div style={styles.chatAvatar}>
            <span style={styles.chatAvatarText}>T</span>
          </div>
          <div style={styles.typingBubble}>
            <span style={{...styles.typingDot, animationDelay: '0s'}}>•</span>
            <span style={{...styles.typingDot, animationDelay: '0.15s'}}>•</span>
            <span style={{...styles.typingDot, animationDelay: '0.3s'}}>•</span>
          </div>
        </div>
      );
    }

    // ============ EVENT MODAL ============
    function EventModal({ onClose, onAdd }) {
      const [title, setTitle] = useState('');
      const [month, setMonth] = useState(new Date().getMonth());
      const [lifeArea, setLifeArea] = useState('fun');

      return (
        <div style={styles.modalOverlay} onClick={onClose}>
          <div style={styles.modal} onClick={e => e.stopPropagation()} className="fade-in">
            <div style={styles.modalHeader}>
              <h3 style={styles.modalTitle}>Add an event</h3>
              <button style={styles.modalClose} onClick={onClose}>×</button>
            </div>
            <form onSubmit={(e) => { 
              e.preventDefault(); 
              if (title) onAdd({ title, month, lifeArea });
            }} style={styles.modalForm}>
              <div style={styles.formField}>
                <label style={styles.formLabel}>What is it?</label>
                <input 
                  type="text" 
                  style={styles.textInput} 
                  value={title} 
                  onChange={(e) => setTitle(e.target.value)} 
                  placeholder="Trip to Italy, birthday, deadline..." 
                  autoFocus
                />
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>When?</label>
                <select 
                  style={styles.selectInput} 
                  value={month} 
                  onChange={(e) => setMonth(parseInt(e.target.value))}
                >
                  {MONTHS.map((m, i) => (
                    <option key={i} value={i}>{m} 2026</option>
                  ))}
                </select>
              </div>
              <div style={styles.formField}>
                <label style={styles.formLabel}>Life Area</label>
                <select 
                  style={styles.selectInput} 
                  value={lifeArea} 
                  onChange={(e) => setLifeArea(e.target.value)}
                >
                  {Object.entries(LIFE_AREAS).map(([key, area]) => (
                    <option key={key} value={key}>{area.icon} {area.name}</option>
                  ))}
                </select>
              </div>
              <button 
                type="submit" 
                style={{...styles.submitButton, ...(!title ? styles.submitButtonDisabled : {})}}
                disabled={!title}
              >
                Add to year
              </button>
            </form>
          </div>
        </div>
      );
    }

    // ============ STYLES ============
    const styles = {
      container: { 
        minHeight: '100vh', 
        display: 'flex', 
        flexDirection: 'column',
        backgroundColor: 'var(--bg-main)',
      },
      
      // Header
      header: {
        padding: '1rem 2rem',
        borderBottom: '1px solid var(--border)',
        backgroundColor: 'var(--bg-card)',
        display: 'flex',
        alignItems: 'baseline',
        gap: '1rem',
      },
      logoContainer: { display: 'flex', alignItems: 'center' },
      logoText: { fontSize: '1.5rem', fontFamily: "'Fraunces', serif", fontWeight: 400, color: 'var(--text)' },
      tagline: { fontSize: '0.85rem', color: 'var(--text-muted)', fontStyle: 'italic' },

      // Main three-column layout
      main: { 
        display: 'grid', 
        gridTemplateColumns: '220px 1fr 360px', 
        flex: 1,
        height: 'calc(100vh - 60px)',
      },

      // Left Sidebar
      sidebar: {
        padding: '1.5rem 1rem',
        borderRight: '1px solid var(--border)',
        backgroundColor: 'var(--bg-card)',
        overflowY: 'auto',
      },
      sidebarSection: {
        marginBottom: '1.5rem',
      },
      sectionHeader: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: '0.75rem',
      },
      sectionTitle: {
        fontSize: '0.7rem',
        textTransform: 'uppercase',
        letterSpacing: '0.1em',
        color: 'var(--text-muted)',
        fontFamily: "'DM Sans', sans-serif",
        fontWeight: 600,
      },
      addButton: {
        width: '20px',
        height: '20px',
        borderRadius: '50%',
        border: '1px solid var(--border)',
        backgroundColor: 'transparent',
        color: 'var(--text-muted)',
        fontSize: '0.875rem',
        cursor: 'pointer',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
      },
      sectionContent: {
        display: 'flex',
        flexWrap: 'wrap',
        gap: '0.5rem',
      },
      ghostedItems: {
        display: 'flex',
        flexWrap: 'wrap',
        gap: '0.5rem',
      },
      ghostPill: {
        height: '28px',
        borderRadius: '14px',
        backgroundColor: 'var(--ghost)',
        animation: 'gentlePulse 3s ease-in-out infinite',
      },
      valueChip: {
        display: 'inline-flex',
        alignItems: 'center',
        gap: '0.375rem',
        padding: '0.375rem 0.75rem',
        backgroundColor: 'var(--accent)',
        color: 'white',
        borderRadius: '14px',
        fontSize: '0.8rem',
      },
      chipRemove: {
        background: 'none',
        border: 'none',
        color: 'white',
        opacity: 0.7,
        cursor: 'pointer',
        fontSize: '0.875rem',
        padding: 0,
        lineHeight: 1,
      },

      // Life Areas in sidebar
      lifeAreasList: {
        display: 'flex',
        flexDirection: 'column',
        gap: '0.25rem',
      },
      lifeAreaItem: {
        display: 'flex',
        alignItems: 'center',
        gap: '0.5rem',
        padding: '0.375rem 0.5rem',
        borderRadius: '6px',
        borderLeft: '2px solid transparent',
        transition: 'all 0.3s ease',
      },
      lifeAreaLabel: {
        fontSize: '0.75rem',
        color: 'var(--text)',
      },

      // Goals in sidebar
      goalItem: {
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        gap: '0.5rem',
        padding: '0.5rem 0.75rem',
        backgroundColor: 'var(--bg-elevated)',
        borderRadius: '8px',
        fontSize: '0.8rem',
        color: 'var(--text)',
        width: '100%',
      },

      // Seasons in sidebar
      seasonsList: {
        display: 'flex',
        flexDirection: 'column',
        gap: '0.5rem',
      },
      seasonItem: {
        padding: '0.5rem',
        borderLeft: '3px solid',
        paddingLeft: '0.75rem',
        transition: 'opacity 0.3s ease',
      },
      seasonInput: {
        width: '100%',
        marginTop: '0.25rem',
        padding: '0.375rem 0.5rem',
        border: '1px solid var(--border)',
        borderRadius: '4px',
        backgroundColor: 'var(--bg-elevated)',
        fontSize: '0.75rem',
        color: 'var(--text)',
      },

      // Center Panel
      centerPanel: {
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        padding: '2rem',
        backgroundColor: 'var(--bg-main)',
      },
      circleContainer: {
        position: 'relative',
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        gap: '1.5rem',
      },
      addEventButton: {
        padding: '0.5rem 1.25rem',
        backgroundColor: 'var(--accent)',
        border: 'none',
        borderRadius: '20px',
        color: 'white',
        fontSize: '0.85rem',
        cursor: 'pointer',
      },

      // Chat Panel
      chatPanel: { 
        backgroundColor: 'var(--bg-card)', 
        borderLeft: '1px solid var(--border)', 
        display: 'flex', 
        flexDirection: 'column',
      },
      chatMessages: { 
        flex: 1, 
        padding: '1.25rem', 
        overflowY: 'auto', 
        display: 'flex', 
        flexDirection: 'column', 
        gap: '0.875rem',
      },
      chatInputArea: { 
        padding: '1rem 1.25rem 1.25rem', 
        borderTop: '1px solid var(--border)',
      },
      skipButton: {
        width: '100%',
        padding: '0.5rem',
        marginBottom: '0.75rem',
        backgroundColor: 'transparent',
        border: '1px solid var(--border)',
        borderRadius: '8px',
        color: 'var(--text-muted)',
        fontSize: '0.8rem',
        cursor: 'pointer',
      },
      inputRow: {
        display: 'flex',
        gap: '0.625rem',
        alignItems: 'flex-end',
      },
      chatInput: {
        flex: 1,
        padding: '0.75rem 1rem',
        backgroundColor: 'var(--bg-elevated)',
        border: '1px solid var(--border)',
        borderRadius: '12px',
        color: 'var(--text)',
        fontSize: '0.875rem',
        fontFamily: "'DM Sans', sans-serif",
        resize: 'none',
      },
      sendButton: {
        width: '40px',
        height: '40px',
        borderRadius: '50%',
        backgroundColor: 'var(--accent)',
        border: 'none',
        color: 'white',
        fontSize: '1rem',
        cursor: 'pointer',
        flexShrink: 0,
      },
      sendButtonDisabled: { 
        backgroundColor: 'var(--border)', 
        cursor: 'not-allowed',
      },

      // Chat Message
      chatMessage: { 
        display: 'flex', 
        gap: '0.625rem', 
        alignItems: 'flex-start',
      },
      chatAvatar: {
        width: '28px',
        height: '28px',
        borderRadius: '50%',
        backgroundColor: 'var(--accent-light)',
        border: '1px solid var(--accent)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        flexShrink: 0,
      },
      chatAvatarText: { 
        fontFamily: "'Fraunces', serif", 
        fontSize: '0.75rem', 
        color: 'var(--accent)',
      },
      chatBubble: { 
        padding: '0.75rem 1rem', 
        borderRadius: '14px', 
        maxWidth: '88%', 
        fontSize: '0.875rem', 
        lineHeight: 1.55,
      },
      chatBubbleAssistant: { 
        backgroundColor: 'var(--bg-elevated)', 
        borderTopLeftRadius: '4px', 
        color: 'var(--text)',
      },
      chatBubbleUser: { 
        backgroundColor: 'var(--accent)', 
        borderTopRightRadius: '4px', 
        color: 'white',
      },
      typingBubble: { 
        padding: '0.75rem 1rem', 
        backgroundColor: 'var(--bg-elevated)', 
        borderRadius: '14px', 
        borderTopLeftRadius: '4px', 
        display: 'flex', 
        gap: '4px',
      },
      typingDot: { 
        color: 'var(--accent)', 
        fontSize: '1.125rem', 
        lineHeight: 1, 
        animation: 'pulse 1s infinite',
      },

      // Modal
      modalOverlay: { 
        position: 'fixed', 
        top: 0, left: 0, right: 0, bottom: 0, 
        backgroundColor: 'rgba(0,0,0,0.4)', 
        display: 'flex', 
        alignItems: 'center', 
        justifyContent: 'center', 
        zIndex: 1000,
      },
      modal: { 
        backgroundColor: 'var(--bg-card)', 
        borderRadius: '16px', 
        padding: '1.5rem', 
        width: '90%', 
        maxWidth: '360px', 
        border: '1px solid var(--border)',
      },
      modalHeader: { 
        display: 'flex', 
        justifyContent: 'space-between', 
        alignItems: 'center', 
        marginBottom: '1.25rem',
      },
      modalTitle: { 
        fontSize: '1.125rem', 
        fontFamily: "'Fraunces', serif", 
        color: 'var(--text)',
      },
      modalClose: { 
        width: '28px', 
        height: '28px', 
        borderRadius: '50%', 
        backgroundColor: 'var(--bg-elevated)', 
        border: 'none', 
        color: 'var(--text-muted)', 
        fontSize: '1rem', 
        cursor: 'pointer',
      },
      modalForm: { 
        display: 'flex', 
        flexDirection: 'column', 
        gap: '1rem',
      },
      formField: { 
        display: 'flex', 
        flexDirection: 'column', 
        gap: '0.375rem',
      },
      formLabel: { 
        fontSize: '0.7rem', 
        color: 'var(--text-muted)', 
        textTransform: 'uppercase', 
        letterSpacing: '0.05em', 
        fontWeight: 500,
      },
      textInput: {
        padding: '0.625rem 0.875rem',
        backgroundColor: 'var(--bg-elevated)',
        border: '1px solid var(--border)',
        borderRadius: '8px',
        color: 'var(--text)',
        fontSize: '0.875rem',
        fontFamily: "'DM Sans', sans-serif",
      },
      selectInput: {
        padding: '0.625rem 0.875rem',
        backgroundColor: 'var(--bg-elevated)',
        border: '1px solid var(--border)',
        borderRadius: '8px',
        color: 'var(--text)',
        fontSize: '0.875rem',
        fontFamily: "'DM Sans', sans-serif",
      },
      submitButton: { 
        padding: '0.75rem', 
        backgroundColor: 'var(--accent)', 
        border: 'none', 
        borderRadius: '10px', 
        color: 'white', 
        fontSize: '0.875rem', 
        fontFamily: "'DM Sans', sans-serif", 
        fontWeight: 500, 
        cursor: 'pointer', 
        marginTop: '0.5rem',
      },
      submitButtonDisabled: { 
        backgroundColor: 'var(--border-dark)', 
        cursor: 'not-allowed',
      },
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TendApp />);
  </script>
</body>
</html>
